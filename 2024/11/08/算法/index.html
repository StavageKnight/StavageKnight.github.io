<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="author" content="Stavage">
    
    <meta name="description" content="My personal blog">
    
    
    
    
    
    
    <title>算法 | Stavage</title>
    <link href="http://example.com" rel="prefetch" />

    
<link rel="stylesheet" href="/css/bootstrap.min.css">
<link rel="stylesheet" href="/css/aos.css">
<link rel="stylesheet" href="/css/style.css">

    
<script src="/js/jquery.min.js"></script>

    
<script src="/js/bootstrap.min.js"></script>

    
<script src="/js/aos.js"></script>

    
<script src="/js/highslide/highslide-full.min.js"></script>

    
<link rel="stylesheet" href="/js/highslide/highslide.css">

    <style type="text/css">
        @media (max-width: 768px) {
            body {
                background-color: #f0f0f0;
                background: url('/imgs/xsbg.gif');
                background-attachment: fixed;
            }
        }
    </style>
    
    <!--<script type="text/javascript">
      if (document.images) {
        var avatar = new Image();
        avatar.src = '/imgs/avatar.jpg'
        var previews = 'preview1.jpg,preview2.jpg,preview3.jpg,preview4.jpg,preview5.jpg,preview6.jpg'.split(',')
        var previewsPreLoad = []
        for(var i = 0; i < length; i++) {
          previewsPreLoad.push(new Image())
          previewsPreLoad[previewsPreLoad.length - 1].src = '/imgs/preview' + previews[i]
        }
      }
    </script>-->
<meta name="generator" content="Hexo 7.3.0"></head>
<body>
    <!-- 背景轮播图功能 -->
    <section class="hidden-xs">
    <ul class="cb-slideshow">
        <li><span>天若</span></li>
        <li><span>有情</span></li>
        <li><span>天亦老</span></li>
        <li><span>我为</span></li>
        <li><span>长者</span></li>
        <li><span>续一秒</span></li>
    </ul>
</section>
    <!-- 欧尼酱功能, 谁用谁知道 -->
    
    <div class="gal-menu gal-dropdown">
    <div class="circle" id="gal">
        <div class="ring">
            <a href="http://example.com" class="menuItem" style="left: 50%; top: 15%;">首页</a>
            
            <a class="menuItem" style="left: 80.3109%; top: 32.5%;">下一页</a>
            
            <a href="/archives" class="menuItem" style="left: 80.3109%; top: 67.5%;">归档</a>
            <a href="/about" class="menuItem" style="left: 50%; top: 85%;">关于</a>
            <a href="/message" class="menuItem" style="left: 19.6891%; top: 67.5%;">留言板</a>

            
            <a class="menuItem" style="left: 19.6891%; top: 32.5%;">上一页</a>
            
        </div>
        <audio id="audio" src="/imgs/oni.mp3"></audio>
    </div>
</div>
    
    <header class="navbar navbar-inverse" id="gal-header">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed"
                    data-toggle="collapse" data-target=".bs-navbar-collapse"
                    aria-expanded="false">
                <span class="fa fa-lg fa-reorder"></span>
            </button>
            <a href="http://example.com">
                
                <style>
                    #gal-header .navbar-brand {
                        height: 54px;
                        line-height: 24px;
                        font-size: 28px;
                        opacity: 1;
                        background-color: rgba(0,0,0,0);
                        text-shadow: 0 0 5px #fff,0 0 10px #fff,0 0 15px #fff,0 0 20px #228DFF,0 0 35px #228DFF,0 0 40px #228DFF,0 0 50px #228DFF,0 0 75px #228DFF;
                    }
                </style>
                <!-- 这里使用文字(navbar_text or config.title) -->
                <div class="navbar-brand">Stavage</div>
                
            </a>
        </div>
        <div class="collapse navbar-collapse bs-navbar-collapse">
            <ul class="nav navbar-nav" id="menu-gal">
                
                
                <li class="">
                    <a href="/">
                        <i class="fa fa-home"></i>首页
                    </a>
                </li>
                
                
                
                <li class="">
                    <a href="/archives">
                        <i class="fa fa-archive"></i>归档
                    </a>
                </li>
                
                
                
                
                <li class="dropdown">
                    <!-- TODO 添加hover dropdown效果 -->
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false" data-hover="dropdown">
                        <i class="fa fa-list"></i>分类
                    </a>
                    <ul class="dropdown-menu">
                        
                        
                        <li>
                            <a href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
                        </li>
                        
                        <li>
                            <a href="/categories/%E5%AD%A6%E4%B9%A0/">学习</a>
                        </li>
                        
                        <li>
                            <a href="/categories/%E5%AD%A6%E4%B9%A0s-d/">学习s&#39;d</a>
                        </li>
                        
                        
                        <li>
                            <a href="/categories">...</a>
                        </li>
                        
                        
                    </ul>
                </li>
                
                
                
                
                
                <li class="dropdown">
                    <!-- TODO 添加hover dropdown效果 -->
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false" data-hover="dropdown">
                        <i class="fa fa-tags"></i>标签
                    </a>
                    <ul class="dropdown-menu">
                        
                        
                        <li>
                            <a href="/tags/Tset/">Tset</a>
                        </li>
                        
                        <li>
                            <a href="/tags/%E6%A8%A1%E6%9D%BF/">模板</a>
                        </li>
                        
                        <li>
                            <a href="/tags/%E4%BB%8B%E7%BB%8D/">介绍</a>
                        </li>
                        
                        
                        <li>
                            <a href="/tags">...</a>
                        </li>
                        
                        
                    </ul>
                </li>
                
                
                
                
                <li class="">
                    <a href="/about">
                        <i class="fa fa-user"></i>关于我
                    </a>
                </li>
                
                
            </ul>
        </div>
    </div>
</header>
    <div id="gal-body">
        <div class="container">
            <div class="row">
                <div class="col-md-8 gal-right" id="mainstay">
                    
<article class="article well article-body" id="article">
    <div class="breadcrumb">
        <i class="fa fa-home"></i>
        <a href="http://example.com">Stavage</a>
        >
        <span>算法</span>
    </div>
    <!-- 大型设备详细文章 -->
    <div class="hidden-xs">
        <div class="title-article">
            <h1>
                <a href="/2024/11/08/%E7%AE%97%E6%B3%95/">算法</a>
            </h1>
        </div>
        <div class="tag-article">
            
            <span class="label label-gal">
                <i class="fa fa-tags"></i>
                
                <a href="/tags/%E6%A8%A1%E6%9D%BF/">模板</a>
                
            </span>
            
            <span class="label label-gal">
                <i class="fa fa-calendar"></i> 2024-11-08
            </span>
            
        </div>
    </div>
    <!-- 小型设备详细文章 -->
    <div class="visible-xs">
        <center>
            <div class="title-article">
                <h4>
                    <a href="/2024/11/08/%E7%AE%97%E6%B3%95/">算法</a>
                </h4>
            </div>
            <p>
                <i class="fa fa-calendar"></i> 2024-11-08
            </p>
            <p>
                
                <i class="fa fa-tags"></i>
                
                <a href="/tags/%E6%A8%A1%E6%9D%BF/">模板</a>
                
                
                
            </p>
        </center>
    </div>
    <div class="content-article">
        <p>[TOC]</p>
<h1 id="基础算法"><a href="#基础算法" class="headerlink" title="基础算法"></a>基础算法</h1><h2 id="龟速乘-快速幂"><a href="#龟速乘-快速幂" class="headerlink" title="龟速乘&amp;快速幂"></a>龟速乘&amp;快速幂</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">zint <span class="title">ksc</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> ans = <span class="number">0</span>;<span class="comment">//快速成是加法</span></span><br><span class="line">	<span class="keyword">while</span> (b &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (b &amp; <span class="number">1</span>) &#123;</span><br><span class="line">			ans = (ans + a) % p;</span><br><span class="line">		&#125;</span><br><span class="line">		b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">		a = (a + a) % p;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ksm</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b,<span class="type">int</span> p)</span><span class="comment">//快速幂</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> ans = <span class="number">1</span>;<span class="comment">//快速幂的乘法</span></span><br><span class="line">	<span class="keyword">while</span> (b &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (b &amp; <span class="number">1</span>) &#123;</span><br><span class="line">			ans = <span class="built_in">ksc</span>(ans, a, p) % p;<span class="comment">//用快速乘代替原来的乘法运算</span></span><br><span class="line">		&#125;</span><br><span class="line">		b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">		a = <span class="built_in">ksc</span>(a, a, p) % p;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="O-1-快速乘"><a href="#O-1-快速乘" class="headerlink" title="O(1)快速乘"></a>O(1)快速乘</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">mul</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> MOD)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x = x % MOD, y = y % MOD;</span><br><span class="line">    <span class="keyword">return</span> ((x * y - (<span class="type">int</span>) (((LD) x * y + <span class="number">0.5</span>) / MOD) * MOD) % MOD + MOD) % MOD;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="模乘优化"><a href="#模乘优化" class="headerlink" title="模乘优化"></a>模乘优化</h2><p>b进制下,求 x mod m,默认大于0</p>
<p>m为k位数(b进制下),x位数小于等于2*k</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//b^n代表b的n次幂,mu=b^2k / m,可以预计算</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">BaRdc</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> b, <span class="type">int</span> mu, <span class="type">int</span> m, <span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> q1 = x / b ^ (k - <span class="number">1</span>);<span class="comment">//右移k-1位,取整,后面同</span></span><br><span class="line">    <span class="type">int</span> q2 = q1 * mu;</span><br><span class="line">    <span class="type">int</span> q3 = q2 / b ^ (k + <span class="number">1</span>);<span class="comment">//移位</span></span><br><span class="line">    <span class="type">int</span> r1 = x % b ^ (k + <span class="number">1</span>);<span class="comment">//取低k位,因为mod m,m是k位的,所以只需看低k位即可</span></span><br><span class="line">    <span class="type">int</span> r2 = (q3 * m) % b ^ (k + <span class="number">1</span>);<span class="comment">//低k位</span></span><br><span class="line">    <span class="type">int</span> r = r1 - r2;<span class="comment">//低k位相减</span></span><br><span class="line">    <span class="keyword">if</span> (r &gt; m) r -= m;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="欧拉筛"><a href="#欧拉筛" class="headerlink" title="欧拉筛"></a>欧拉筛</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e6</span> + <span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> b[N], prime[N];</span><br><span class="line"><span class="type">int</span> cnt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(b, <span class="number">1</span>, <span class="built_in">sizeof</span>(b));</span><br><span class="line">    b[<span class="number">0</span>] = b[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b[i])</span><br><span class="line">            prime[++cnt] = i;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= cnt &amp;&amp; prime[j] * i &lt; N; j++)<span class="comment">//质数的质数倍，保证不做重复运算</span></span><br><span class="line">        &#123;</span><br><span class="line">            b[prime[j] * i] = <span class="number">0</span>;<span class="comment">//标记为0，即为非质数</span></span><br><span class="line">            <span class="keyword">if</span> (i % prime[j] == <span class="number">0</span>) <span class="keyword">break</span>;<span class="comment">//解释为i的最小素因子是prime[j]，但我猜测此时i==prime[j]</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="差分"><a href="#差分" class="headerlink" title="差分"></a>差分</h2><p>一维还原只需要对差分数组进行前缀和，变换只需要在 l 加 c ，r + 1 减 c</p>
<p>二维差分构造</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b[i][j]=a[i][j]+a[i<span class="number">-1</span>][j<span class="number">-1</span>]-a[i<span class="number">-1</span>][j]-a[i][j<span class="number">-1</span>];</span><br></pre></td></tr></table></figure>

<p>还原为二维前缀和</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            a[i][j]=a[i<span class="number">-1</span>][j]+a[i][j<span class="number">-1</span>]-a[i<span class="number">-1</span>][j<span class="number">-1</span>]+b[i][j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>变换为 </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">b[x1][y1]+=c;</span><br><span class="line">b[x2<span class="number">+1</span>][y1]-=c;</span><br><span class="line">b[x1][y2<span class="number">+1</span>]-=c;</span><br><span class="line">b[x2<span class="number">+1</span>][y2<span class="number">+1</span>]+=c;</span><br></pre></td></tr></table></figure>

<h2 id="快读-快写"><a href="#快读-快写" class="headerlink" title="快读&amp;快写"></a>快读&amp;快写</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">qread</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> x = <span class="number">0</span>, y = <span class="number">1</span>;</span><br><span class="line">	<span class="type">char</span> c = <span class="built_in">getchar</span>();</span><br><span class="line">	<span class="keyword">while</span> (c &lt; <span class="string">&#x27;0&#x27;</span> || c &gt; <span class="string">&#x27;9&#x27;</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (c == <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">			y = <span class="number">-1</span>;</span><br><span class="line">		c = <span class="built_in">getchar</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span> (c &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; c &lt;= <span class="string">&#x27;9&#x27;</span>) &#123;</span><br><span class="line">		x = x * <span class="number">10</span> + c - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">		c = <span class="built_in">getchar</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> x * y;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">//读取操作</span></span><br><span class="line"><span class="comment">for (int i = 1; i &lt;= n; i++) &#123;</span></span><br><span class="line"><span class="comment">	arr[i] = readInt();</span></span><br><span class="line"><span class="comment">	r = max(r, arr[i]);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">write</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>),x=-x;</span><br><span class="line">     <span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>);</span><br><span class="line">     <span class="built_in">putchar</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="矩阵乘法"><a href="#矩阵乘法" class="headerlink" title="矩阵乘法"></a>矩阵乘法</h2><p>多个矩阵相乘，其核心为尽可能用少的时间复杂度，可以考虑先算后面再进行前面的运算顺序</p>
<p>且其一般构造结构体进行存取</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> LL;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line">	LL m[MAX][MAX];</span><br><span class="line">&#125;Mit;</span><br></pre></td></tr></table></figure>

<h3 id="矩阵快速幂-乘"><a href="#矩阵快速幂-乘" class="headerlink" title="矩阵快速幂&#x2F;乘"></a>矩阵快速幂&#x2F;乘</h3><p>一般都用于求递推公式，将算出来的矩阵设为P，然后需要n阶单位矩阵I进行快速幂</p>
<p>结果一般用S接，然后计算</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Mit <span class="title">Mul</span><span class="params">(Mit a, Mit b)</span><span class="comment">//快速乘</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Mit c;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; MAX; i++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; MAX; j++) &#123;</span><br><span class="line">            c.m[i][j] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; MAX; k++) &#123;</span><br><span class="line">                a.m[i][k] = (a.m[i][k] % MOD + MOD) % MOD;</span><br><span class="line">                b.m[k][j] = (b.m[k][j] % MOD + MOD) % MOD;</span><br><span class="line">                c.m[i][j] += (a.m[i][k] * b.m[k][j]) % MOD;</span><br><span class="line">            &#125;</span><br><span class="line">            c.m[i][j] = (c.m[i][j] % MOD + MOD) % MOD;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Mit <span class="title">qpow</span><span class="params">(Mit P, Mit I, <span class="type">int</span> n)</span><span class="comment">//快速幂</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Mit m = P, b = I;</span><br><span class="line">    <span class="keyword">while</span> (n &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (n &amp; <span class="number">1</span>) &#123;</span><br><span class="line">            b = <span class="built_in">Mul</span>(b, m);</span><br><span class="line">        &#125;</span><br><span class="line">        n = n &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        m = <span class="built_in">Mul</span>(m, m);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="高精度"><a href="#高精度" class="headerlink" title="高精度"></a>高精度</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> MAX = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">hp</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> num[MAX];</span><br><span class="line">  hp &amp;<span class="keyword">operator</span>=(<span class="type">const</span> <span class="type">char</span> *);</span><br><span class="line">  hp &amp;<span class="keyword">operator</span>=(<span class="type">int</span>);</span><br><span class="line">  <span class="built_in">hp</span>();</span><br><span class="line">  <span class="built_in">hp</span>(<span class="type">int</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 以下运算符可以根据实际需要来选择。</span></span><br><span class="line">  <span class="type">bool</span> <span class="keyword">operator</span>&gt;(<span class="type">const</span> hp &amp;) <span class="type">const</span>;</span><br><span class="line">  <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> hp &amp;) <span class="type">const</span>;</span><br><span class="line">  <span class="type">bool</span> <span class="keyword">operator</span>&lt;=(<span class="type">const</span> hp &amp;) <span class="type">const</span>;</span><br><span class="line">  <span class="type">bool</span> <span class="keyword">operator</span>&gt;=(<span class="type">const</span> hp &amp;) <span class="type">const</span>;</span><br><span class="line">  <span class="type">bool</span> <span class="keyword">operator</span>!=(<span class="type">const</span> hp &amp;) <span class="type">const</span>;</span><br><span class="line">  <span class="type">bool</span> <span class="keyword">operator</span>==(<span class="type">const</span> hp &amp;) <span class="type">const</span>;</span><br><span class="line">  hp <span class="keyword">operator</span>+(<span class="type">const</span> hp &amp;) <span class="type">const</span>;</span><br><span class="line">  hp <span class="keyword">operator</span>-(<span class="type">const</span> hp &amp;) <span class="type">const</span>;</span><br><span class="line">  hp <span class="keyword">operator</span>*(<span class="type">const</span> hp &amp;) <span class="type">const</span>;</span><br><span class="line">  hp <span class="keyword">operator</span>/(<span class="type">const</span> hp &amp;) <span class="type">const</span>;</span><br><span class="line">  hp <span class="keyword">operator</span>%(<span class="type">const</span> hp &amp;) <span class="type">const</span>;</span><br><span class="line">  hp &amp;<span class="keyword">operator</span>+=(<span class="type">const</span> hp &amp;);</span><br><span class="line">  hp &amp;<span class="keyword">operator</span>-=(<span class="type">const</span> hp &amp;);</span><br><span class="line">  hp &amp;<span class="keyword">operator</span>*=(<span class="type">const</span> hp &amp;);</span><br><span class="line">  hp &amp;<span class="keyword">operator</span>/=(<span class="type">const</span> hp &amp;);</span><br><span class="line">  hp &amp;<span class="keyword">operator</span>%=(<span class="type">const</span> hp &amp;);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// num[0]用来保存数字位数。另外，利用10000进制可以节省空间和时间。</span></span><br><span class="line">hp &amp;hp::<span class="keyword">operator</span>=(<span class="type">const</span> <span class="type">char</span> *c)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">memset</span>(num, <span class="number">0</span>, <span class="built_in">sizeof</span>(num));</span><br><span class="line">    <span class="type">int</span> n = <span class="built_in">strlen</span>(c), j = <span class="number">1</span>, k = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (k == <span class="number">10000</span>) j++, k = <span class="number">1</span>;                <span class="comment">// 10000进制，4个数字才算1位。</span></span><br><span class="line">        num[j] += k * (c[n - i] - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        k *= <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    num[<span class="number">0</span>] = j;</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hp &amp;hp::<span class="keyword">operator</span>=(<span class="type">int</span> a)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> s[MAX];</span><br><span class="line">    <span class="built_in">sprintf</span>(s, <span class="string">&quot;%d&quot;</span>, a);</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span> = s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hp::<span class="built_in">hp</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">memset</span>(num, <span class="number">0</span>, <span class="built_in">sizeof</span>(num));</span><br><span class="line">    num[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">&#125;    <span class="comment">// 目的：声明hp时无需显式初始化。</span></span><br><span class="line">hp::<span class="built_in">hp</span>(<span class="type">int</span> n) &#123; *<span class="keyword">this</span> = n; &#125;                            <span class="comment">// 目的：支持“hp a=1;”之类的代码。</span></span><br><span class="line"><span class="comment">// 如果位数不等，大小是可以明显看出来的。如果位数相等，就需要逐位比较。</span></span><br><span class="line"><span class="type">bool</span> hp::<span class="keyword">operator</span>&gt;(<span class="type">const</span> hp &amp;b) <span class="type">const</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (num[<span class="number">0</span>] != b.num[<span class="number">0</span>]) <span class="keyword">return</span> num[<span class="number">0</span>] &gt; b.num[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = num[<span class="number">0</span>]; i &gt;= <span class="number">1</span>; i--)</span><br><span class="line">        <span class="keyword">if</span> (num[i] != b.num[i])</span><br><span class="line">            <span class="keyword">return</span> (num[i] &gt; b.num[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">bool</span> hp::<span class="keyword">operator</span>&lt;(<span class="type">const</span> hp &amp;b) <span class="type">const</span> &#123; <span class="keyword">return</span> b &gt; *<span class="keyword">this</span>; &#125;</span><br><span class="line"><span class="type">bool</span> hp::<span class="keyword">operator</span>&lt;=(<span class="type">const</span> hp &amp;b) <span class="type">const</span> &#123; <span class="keyword">return</span> !(*<span class="keyword">this</span> &gt; b); &#125;</span><br><span class="line"><span class="type">bool</span> hp::<span class="keyword">operator</span>&gt;=(<span class="type">const</span> hp &amp;b) <span class="type">const</span> &#123; <span class="keyword">return</span> !(b &gt; *<span class="keyword">this</span>); &#125;</span><br><span class="line"><span class="type">bool</span> hp::<span class="keyword">operator</span>!=(<span class="type">const</span> hp &amp;b) <span class="type">const</span> &#123; <span class="built_in">return</span> (b &gt; *<span class="keyword">this</span>) || (*<span class="keyword">this</span> &gt; b); &#125;</span><br><span class="line"><span class="type">bool</span> hp::<span class="keyword">operator</span>==(<span class="type">const</span> hp &amp;b) <span class="type">const</span> &#123; <span class="keyword">return</span> !(b &gt; *<span class="keyword">this</span>) &amp;&amp; !(*<span class="keyword">this</span> &gt; b); &#125;</span><br><span class="line"><span class="comment">// 注意：最高位的位置和位数要匹配。</span></span><br><span class="line">hp hp::<span class="keyword">operator</span>+(<span class="type">const</span> hp &amp;b) <span class="type">const</span></span><br><span class="line">&#123;</span><br><span class="line">    hp c;</span><br><span class="line">    c.num[<span class="number">0</span>] = <span class="built_in">max</span>(num[<span class="number">0</span>], b.num[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= c.num[<span class="number">0</span>]; i++) &#123;</span><br><span class="line">        c.num[i] += num[i] + b.num[i];</span><br><span class="line">        <span class="keyword">if</span> (c.num[i] &gt;= <span class="number">10000</span>)                            <span class="comment">// 进位</span></span><br><span class="line">        &#123;</span><br><span class="line">            c.num[i] -= <span class="number">10000</span>;</span><br><span class="line">            c.num[i + <span class="number">1</span>]++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (c.num[c.num[<span class="number">0</span>] + <span class="number">1</span>] &gt; <span class="number">0</span>) c.num[<span class="number">0</span>]++;                <span class="comment">// 9999+1，计算完成后多了一位</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hp hp::<span class="keyword">operator</span>-(<span class="type">const</span> hp &amp;b) <span class="type">const</span></span><br><span class="line">&#123;</span><br><span class="line">    hp c;</span><br><span class="line">    c.num[<span class="number">0</span>] = num[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= c.num[<span class="number">0</span>]; i++) &#123;</span><br><span class="line">        c.num[i] += num[i] - b.num[i];</span><br><span class="line">        <span class="keyword">if</span> (c.num[i] &lt; <span class="number">0</span>)                                    <span class="comment">// 退位</span></span><br><span class="line">        &#123;</span><br><span class="line">            c.num[i] += <span class="number">10000</span>;</span><br><span class="line">            c.num[i + <span class="number">1</span>]--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (c.num[c.num[<span class="number">0</span>]] == <span class="number">0</span> &amp;&amp; c.num[<span class="number">0</span>] &gt; <span class="number">1</span>) c.num[<span class="number">0</span>]--;    <span class="comment">// 100000000-99999999</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hp &amp;hp::<span class="keyword">operator</span>+=(<span class="type">const</span> hp &amp;b) &#123; <span class="keyword">return</span> *<span class="keyword">this</span> = *<span class="keyword">this</span> + b; &#125;</span><br><span class="line">hp &amp;hp::<span class="keyword">operator</span>-=(<span class="type">const</span> hp &amp;b) &#123; <span class="keyword">return</span> *<span class="keyword">this</span> = *<span class="keyword">this</span> - b; &#125;</span><br><span class="line">hp hp::<span class="keyword">operator</span>*(<span class="type">const</span> hp &amp;b) <span class="type">const</span></span><br><span class="line">&#123;</span><br><span class="line">    hp c;</span><br><span class="line">    c.num[<span class="number">0</span>] = num[<span class="number">0</span>] + b.num[<span class="number">0</span>] + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= num[<span class="number">0</span>]; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= b.num[<span class="number">0</span>]; j++) &#123;</span><br><span class="line">            c.num[i + j - <span class="number">1</span>] += num[i] * b.num[j];            <span class="comment">// 和小学竖式的算法一模一样</span></span><br><span class="line">            c.num[i + j] += c.num[i + j - <span class="number">1</span>] / <span class="number">10000</span>;            <span class="comment">// 进位</span></span><br><span class="line">            c.num[i + j - <span class="number">1</span>] %= <span class="number">10000</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (c.num[c.num[<span class="number">0</span>]] == <span class="number">0</span> &amp;&amp; c.num[<span class="number">0</span>] &gt; <span class="number">1</span>) c.num[<span class="number">0</span>]--;    <span class="comment">// 99999999*0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hp &amp;hp::<span class="keyword">operator</span>*=(<span class="type">const</span> hp &amp;b) &#123; <span class="keyword">return</span> *<span class="keyword">this</span> = *<span class="keyword">this</span> * b; &#125;</span><br><span class="line">hp hp::<span class="keyword">operator</span>/(<span class="type">const</span> hp &amp;b) <span class="type">const</span></span><br><span class="line">&#123;</span><br><span class="line">    hp c, d;</span><br><span class="line">    c.num[<span class="number">0</span>] = num[<span class="number">0</span>] + b.num[<span class="number">0</span>] + <span class="number">1</span>;</span><br><span class="line">    d.num[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = num[<span class="number">0</span>]; i &gt;= <span class="number">1</span>; i--) &#123;</span><br><span class="line">        <span class="comment">// 以下三行的含义是：d=d*10000+num[i];</span></span><br><span class="line">        <span class="built_in">memmove</span>(d.num + <span class="number">2</span>, d.num + <span class="number">1</span>, <span class="built_in">sizeof</span>(d.num) - <span class="built_in">sizeof</span>(<span class="type">int</span>) * <span class="number">2</span>);</span><br><span class="line">        d.num[<span class="number">0</span>]++;</span><br><span class="line">        d.num[<span class="number">1</span>] = num[i];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 以下循环的含义是：c.num[i]=d/b; d%=b;</span></span><br><span class="line">        <span class="keyword">while</span> (d &gt;= b) &#123;</span><br><span class="line">            d -= b;</span><br><span class="line">            c.num[i]++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (c.num[c.num[<span class="number">0</span>]] == <span class="number">0</span> &amp;&amp; c.num[<span class="number">0</span>] &gt; <span class="number">1</span>) c.num[<span class="number">0</span>]--;    <span class="comment">// 99999999/99999999</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line">hp hp::<span class="keyword">operator</span>%(<span class="type">const</span> hp &amp;b) <span class="type">const</span></span><br><span class="line">&#123;</span><br><span class="line">    hp c, d;</span><br><span class="line">    c.num[<span class="number">0</span>] = num[<span class="number">0</span>] + b.num[<span class="number">0</span>] + <span class="number">1</span>;</span><br><span class="line">    d.num[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = num[<span class="number">0</span>]; i &gt;= <span class="number">1</span>; i--) &#123;</span><br><span class="line">        <span class="comment">// 以下三行的含义是：d=d*10000+num[i];</span></span><br><span class="line">        <span class="built_in">memmove</span>(d.num + <span class="number">2</span>, d.num + <span class="number">1</span>, <span class="built_in">sizeof</span>(d.num) - <span class="built_in">sizeof</span>(<span class="type">int</span>) * <span class="number">2</span>);</span><br><span class="line">        d.num[<span class="number">0</span>]++;</span><br><span class="line">        d.num[<span class="number">1</span>] = num[i];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 以下循环的含义是：c.num[i]=d/b; d%=b;</span></span><br><span class="line">        <span class="keyword">while</span> (d &gt;= b) &#123;</span><br><span class="line">            d -= b;</span><br><span class="line">            c.num[i]++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (c.num[c.num[<span class="number">0</span>]] == <span class="number">0</span> &amp;&amp; c.num[<span class="number">0</span>] &gt; <span class="number">1</span>) c.num[<span class="number">0</span>]--;    <span class="comment">// 99999999/99999999</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> d;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hp &amp;hp::<span class="keyword">operator</span>/=(<span class="type">const</span> hp &amp;b) &#123; <span class="keyword">return</span> *<span class="keyword">this</span> = *<span class="keyword">this</span> / b; &#125;</span><br><span class="line">hp &amp;hp::<span class="keyword">operator</span>%=(<span class="type">const</span> hp &amp;b) &#123; <span class="keyword">return</span> *<span class="keyword">this</span> = *<span class="keyword">this</span> % b; &#125;</span><br><span class="line">ostream &amp;<span class="keyword">operator</span>&lt;&lt;(ostream &amp;o, hp &amp;n)</span><br><span class="line">&#123;</span><br><span class="line">    o &lt;&lt; n.num[n.num[<span class="number">0</span>]];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = n.num[<span class="number">0</span>] - <span class="number">1</span>; i &gt;= <span class="number">1</span>; i--) &#123;</span><br><span class="line">        o.<span class="built_in">width</span>(<span class="number">4</span>);</span><br><span class="line">        o.<span class="built_in">fill</span>(<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        o &lt;&lt; n.num[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">istream &amp;<span class="keyword">operator</span>&gt;&gt;(istream &amp;in, hp &amp;n)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> s[MAX];</span><br><span class="line">    in &gt;&gt; s;</span><br><span class="line">    n = s;</span><br><span class="line">    <span class="keyword">return</span> in;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如果卡时常可以尝试二分优化除法和取模"><a href="#如果卡时常可以尝试二分优化除法和取模" class="headerlink" title="如果卡时常可以尝试二分优化除法和取模"></a>如果卡时常可以尝试二分优化除法和取模</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">hp hp::<span class="keyword">operator</span> / (<span class="type">const</span> hp&amp; b) <span class="type">const</span></span><br><span class="line">&#123;</span><br><span class="line">	hp c, d;</span><br><span class="line">	c.num[<span class="number">0</span>] = num[<span class="number">0</span>]+b.num[<span class="number">0</span>]<span class="number">+1</span>;</span><br><span class="line">	d.num[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=num[<span class="number">0</span>];i&gt;=<span class="number">1</span>;i--)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 以下三行的含义是：d=d*10000+num[i];</span></span><br><span class="line">		<span class="built_in">memmove</span>(d.num<span class="number">+2</span>, d.num<span class="number">+1</span>, <span class="built_in">sizeof</span>(d.num)-<span class="built_in">sizeof</span>(<span class="type">int</span>)*<span class="number">2</span>);</span><br><span class="line">		d.num[<span class="number">0</span>]++;</span><br><span class="line">		d.num[<span class="number">1</span>]=num[i];</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 以下循环的含义是：c.num[i]=d/b; d%=b; 利用二分查找求c.num[i]的上界。</span></span><br><span class="line">		<span class="comment">// 注意，这里是二分优化后除法和朴素除法的区别！</span></span><br><span class="line">		<span class="type">int</span> left=<span class="number">0</span>, right=<span class="number">9999</span>, mid;</span><br><span class="line">		<span class="keyword">while</span> (left &lt; right)</span><br><span class="line">		&#123;</span><br><span class="line">			mid = (left+right)/<span class="number">2</span>;</span><br><span class="line">			<span class="keyword">if</span> (b*<span class="built_in">hp</span>(mid) &lt;= d) left=mid<span class="number">+1</span>;</span><br><span class="line">			<span class="keyword">else</span> right=mid;</span><br><span class="line">		&#125;</span><br><span class="line">		c.num[i]=right<span class="number">-1</span>;</span><br><span class="line">		d=d-b*<span class="built_in">hp</span>(right<span class="number">-1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span> (c.num[c.num[<span class="number">0</span>]]==<span class="number">0</span>&amp;&amp;c.num[<span class="number">0</span>]&gt;<span class="number">1</span>) c.num[<span class="number">0</span>]--;	<span class="comment">// 99999999/99999999</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> c;			<span class="comment">// 求余数就改成return d;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="位运算"><a href="#位运算" class="headerlink" title="位运算"></a>位运算</h2><p>计算每一位可以用&gt;&gt;运算将数位后移到个位，进行与1位于运算可算出最后一位是否为1</p>
<p>树状数组 lowbit操作返回最后一位1，eg：10-&gt;1010，return 10-&gt;2</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//位运算&gt;&gt;</span></span><br><span class="line"><span class="keyword">while</span> (a[i]) &#123;</span><br><span class="line">            ans[i] += a[i] &amp; <span class="number">1</span>;</span><br><span class="line">            a[i] = a[i] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//lowbit</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">lowbit</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> x &amp; -x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> (x) &#123;</span><br><span class="line">			x = x - <span class="built_in">lowbit</span>(x);</span><br><span class="line">			ans++;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>

<h2 id="离散化"><a href="#离散化" class="headerlink" title="离散化"></a>离散化</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; alls; <span class="comment">// 存储所有待离散化的值</span></span><br><span class="line">	<span class="comment">// 二分求出x对应的离散化的值</span></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="type">int</span> l = <span class="number">0</span>, r = alls.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">while</span> (l &lt; r)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">if</span> (alls[mid] &gt;= x) r = mid;</span><br><span class="line">			<span class="keyword">else</span> l = mid + <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> r + <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="comment">//main主函数</span></span><br><span class="line"><span class="built_in">sort</span>(alls.<span class="built_in">begin</span>(), alls.<span class="built_in">end</span>()); <span class="comment">// 将所有值排序</span></span><br><span class="line">alls.<span class="built_in">erase</span>(<span class="built_in">unique</span>(alls.<span class="built_in">begin</span>(), alls.<span class="built_in">end</span>()), alls.<span class="built_in">end</span>());	<span class="comment">// 去掉重复元素</span></span><br></pre></td></tr></table></figure>

<p>更加易写但难以理解的离散化：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">work</span><span class="params">(<span class="type">int</span> c[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) p[i] = i;</span><br><span class="line">	<span class="built_in">sort</span>(p + <span class="number">1</span>, p + n + <span class="number">1</span>, [&amp;](<span class="type">int</span> x, <span class="type">int</span> y) &#123;</span><br><span class="line">		<span class="keyword">return</span> a[x] &lt; a[y];</span><br><span class="line">		&#125;);<span class="comment">//对下标进行排序</span></span><br><span class="line">	<span class="comment">/*相当于bool cmp(int x, int y) &#123;</span></span><br><span class="line"><span class="comment">				return a[x] &lt; a[y];</span></span><br><span class="line"><span class="comment">			&#125;*/</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) a[p[i]] = i; <span class="comment">//离散化处理</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="二分"><a href="#二分" class="headerlink" title="二分"></a>二分</h2><h3 id="整数"><a href="#整数" class="headerlink" title="整数"></a>整数</h3><p>模板一：(用于check检验后答案为*******oxxxxxxx（其中o为答案，x为剩余区间）)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">check</span><span class="params">(<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> l = <span class="number">0</span>, r = <span class="number">1e9</span>;</span><br><span class="line">	<span class="keyword">while</span> (l &lt; r) &#123;</span><br><span class="line">		<span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">check</span>(mid)) &#123;</span><br><span class="line">			r = mid;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			l = mid + <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	cout &lt;&lt; l &lt;&lt; endl;<span class="comment">//有可能在l视情况定</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>模板二：(用于check检验后答案为xxxxxo*****（其中o为答案，x为剩余区间）)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">check</span><span class="params">(<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> l = <span class="number">0</span>, r = <span class="number">1e9</span>;</span><br><span class="line">	<span class="keyword">while</span> (l &lt; r) &#123;</span><br><span class="line">		<span class="type">int</span> mid = l + r + <span class="number">1</span> &gt;&gt; <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">check</span>(mid)) &#123;</span><br><span class="line">			l = mid;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			r = mid - <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	cout &lt;&lt; l &lt;&lt; endl;<span class="comment">//有可能在l视情况定</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="浮点数"><a href="#浮点数" class="headerlink" title="浮点数"></a>浮点数</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">double</span> x;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">check</span><span class="params">(<span class="type">double</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (k * k * k) &lt; x;<span class="comment">//k即为二分结果，要求三次方根，即为k的三次方</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    l = <span class="number">-10000</span>;</span><br><span class="line">    r = <span class="number">10000</span>;</span><br><span class="line">    <span class="keyword">while</span> (r - l &gt; <span class="number">1e-8</span>)<span class="comment">//这里1e-8为精度，一般比要求多2</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">double</span> mid = (l + r) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">check</span>(mid)) l = mid;</span><br><span class="line">        <span class="keyword">else</span> r = mid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.6lf\n&quot;</span>, l);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三分"><a href="#三分" class="headerlink" title="三分"></a>三分</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LL <span class="title">check</span><span class="params">(<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> l = <span class="number">0</span>, r = <span class="number">1e9</span>;</span><br><span class="line">    <span class="keyword">while</span> (l &lt;= r) &#123;</span><br><span class="line">        <span class="type">int</span> midl = l + (r - l) / <span class="number">3</span>;</span><br><span class="line">        <span class="type">int</span> midr = r - (r - l) / <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">check</span>(midl) &lt;= <span class="built_in">check</span>(midr)) &#123;</span><br><span class="line">            r = midr - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            l = midl + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; (LL) <span class="built_in">min</span>(<span class="built_in">check</span>(l), <span class="built_in">check</span>(r)) &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="双指针"><a href="#双指针" class="headerlink" title="双指针"></a>双指针</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>; i &lt; n; i ++ )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">while</span> (j &lt; i &amp;&amp; <span class="built_in">check</span>(i, j)) j ++ ;</span><br><span class="line">		<span class="comment">//check表示题目的判断条件，没必要一定写函数，一般都是一个for里面套一个while，for里面接具体逻辑</span></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h2 id="归并排序求逆序对数量"><a href="#归并排序求逆序对数量" class="headerlink" title="归并排序求逆序对数量"></a>归并排序求逆序对数量</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">merge_sort</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (l == r) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">	ans = (<span class="built_in">merge_sort</span>(l, mid) + <span class="built_in">merge_sort</span>(mid + <span class="number">1</span>, r)) % MOD;</span><br><span class="line">	<span class="type">int</span> k = <span class="number">0</span>, i = l, j = mid + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span> (i &lt;= mid &amp;&amp; j &lt;= r) &#123;</span><br><span class="line">		<span class="keyword">if</span> (b[i] &lt;= b[j]) p[++k] = b[i++];</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			ans = (ans + mid - i + <span class="number">1</span>) % MOD;</span><br><span class="line">			p[++k] = b[j++];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span> (i &lt;= mid) p[++k] = b[i++];</span><br><span class="line">	<span class="keyword">while</span> (j &lt;= r) p[++k] = b[j++];</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = l, j = <span class="number">1</span>; i &lt;= r; i++, j++) b[i] = p[j];</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="康托展开"><a href="#康托展开" class="headerlink" title="康托展开"></a>康托展开</h2><p>时间复杂度O(n^2)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">cantor</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> *a)</span><span class="comment">//n为排列长度，a为排列结果数组</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> i, j;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">1</span>, s;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        s = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (j = i + <span class="number">1</span>; j &lt;= n; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (a[j] &lt; a[i]) &#123;</span><br><span class="line">                ++s;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ans += s * f[n - i];<span class="comment">//f为阶乘数组</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>逆康托</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;<span class="type">char</span>&gt; vec; <span class="comment">//存需要排列的字符</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">rev_cantor</span><span class="params">(<span class="type">int</span> k)</span> <span class="comment">//输出序号为 k 的字符序列</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n = vec.<span class="built_in">size</span>(), len = <span class="number">0</span>;</span><br><span class="line">    string ans = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    k--; <span class="comment">// 算的时候是按 12345 是第0位</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line">        <span class="type">int</span> t = k / f[n - i]; <span class="comment">// 第 i 位需要 第 t + 1 大的数</span></span><br><span class="line">        k %= f[n - i];        <span class="comment">//剩下的几位需要提供的排列数</span></span><br><span class="line">        ans += vec[t] ; <span class="comment">//  vec[t] 就是第 t + 1 大的数</span></span><br><span class="line">        vec.<span class="built_in">erase</span>(vec.<span class="built_in">begin</span>() + t);</span><br><span class="line"><span class="comment">//用过就删了，不用vector用暴力也可以，就是说枚举，然后一个一个的比较大小，并记录有几个没用过的字符且字典序比它小</span></span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>线段树维护康托展开，时间复杂度O(nlogn)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAXN 1000100</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod 998244353</span></span><br><span class="line"><span class="type">int</span> T[MAXN &lt;&lt; <span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> query[MAXN], f[MAXN], N, K, i, j, q;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">push_up</span><span class="params">(<span class="type">int</span> rt)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    T[rt] = T[rt &lt;&lt; <span class="number">1</span>] + T[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> rt, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == p &amp;&amp; r == p) &#123;</span><br><span class="line">        T[rt]++;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (p &lt;= mid) <span class="built_in">update</span>(rt &lt;&lt; <span class="number">1</span>, l, mid, p); <span class="keyword">else</span> <span class="built_in">update</span>(rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>, mid + <span class="number">1</span>, r, p);</span><br><span class="line">    <span class="built_in">push_up</span>(rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">que</span><span class="params">(<span class="type">int</span> rt, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> ql, <span class="type">int</span> qr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (ql &gt; qr) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (ql &lt;= l &amp;&amp; qr &gt;= r) <span class="keyword">return</span> T[rt];</span><br><span class="line">    <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>, res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (ql &lt;= mid) res += <span class="built_in">que</span>(rt &lt;&lt; <span class="number">1</span>, l, mid, ql, qr);</span><br><span class="line">    <span class="keyword">if</span> (qr &gt; mid) res += <span class="built_in">que</span>(rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>, mid + <span class="number">1</span>, r, ql, qr);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">work_contor</span><span class="params">(<span class="type">int</span> *now)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> k, l, t = <span class="number">0</span>, res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (k = <span class="number">1</span>; k &lt;= N; ++k, t = <span class="number">0</span>) &#123;</span><br><span class="line">        res = (<span class="number">1ll</span> * res + <span class="number">1ll</span> * (now[k] - <span class="built_in">que</span>(<span class="number">1</span>, <span class="number">1</span>, N, <span class="number">1</span>, now[k] - <span class="number">1</span>) - <span class="number">1</span>) * f[N - k]) % Mod;</span><br><span class="line">        <span class="built_in">update</span>(<span class="number">1</span>, <span class="number">1</span>, N, now[k]);</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; (res + <span class="number">1</span>) % Mod &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin &gt;&gt; N;</span><br><span class="line">    f[<span class="number">1</span>] = f[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">2</span>; i &lt;= N; i++) f[i] = <span class="number">1ll</span> * f[i - <span class="number">1</span>] * i % Mod;</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">1</span>; j &lt;= N; j++) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;query[j]);</span><br><span class="line">    <span class="built_in">work_contor</span>(query);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="原根"><a href="#原根" class="headerlink" title="原根"></a>原根</h2><p>求最小原根</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n, m;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; factor;</span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">get_factor</span><span class="params">(<span class="type">int</span> n)</span><span class="comment">//因子分解</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; res;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i * i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (n % i == <span class="number">0</span>) &#123;</span><br><span class="line">            res.<span class="built_in">push_back</span>(i);</span><br><span class="line">            <span class="keyword">if</span> (i != n / i) &#123;</span><br><span class="line">                res.<span class="built_in">push_back</span>(n / i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ksm</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (b) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>) ans = ans * a % c;</span><br><span class="line">        b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">        a = a * a % c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="type">int</span> phi_m = n - <span class="number">1</span>;</span><br><span class="line">    factor = <span class="built_in">get_factor</span>(phi_m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="type">bool</span> flag = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; factor.<span class="built_in">size</span>(); ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (factor[j] != phi_m &amp;&amp; <span class="built_in">ksm</span>(i, factor[j], n) == <span class="number">1</span>) &#123;</span><br><span class="line">                flag = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">            cout &lt;&lt; i &lt;&lt; endl;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>求所有原根</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e6</span> + <span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> a[N], ans[N], n, r, t;</span><br><span class="line"><span class="type">int</span> prime[N], b[N], phi[N];</span><br><span class="line"><span class="type">int</span> cnt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span><span class="comment">//欧拉筛法</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    phi[<span class="number">1</span>] = <span class="number">1</span>;<span class="comment">//第一种情况</span></span><br><span class="line">    <span class="built_in">memset</span>(b, <span class="number">1</span>, <span class="built_in">sizeof</span>(b));</span><br><span class="line">    b[<span class="number">0</span>] = b[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b[i]) &#123;</span><br><span class="line">            prime[++cnt] = i;</span><br><span class="line">            phi[i] = i - <span class="number">1</span>;<span class="comment">//第四种情况</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; prime[j] * i &lt; N &amp;&amp; j &lt;= cnt; j++) &#123;</span><br><span class="line">            b[prime[j] * i] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % prime[j] == <span class="number">0</span>) &#123;</span><br><span class="line">                phi[prime[j] * i] = phi[i] * prime[j];<span class="comment">//第二种情况</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            phi[prime[j] * i] = phi[i] * (prime[j] - <span class="number">1</span>);<span class="comment">//第三种情况</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">gcd</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (b == <span class="number">0</span>) ? a : <span class="built_in">gcd</span>(b, a % b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ksm</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (b) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>)</span><br><span class="line">            ans = ans * a % c;</span><br><span class="line">        a = a * a % c;</span><br><span class="line">        b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">check</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n % <span class="number">2</span> == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">if</span> (!b[n])</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; prime[i] * prime[i] &lt;= n; i++)</span><br><span class="line">        <span class="keyword">if</span> (n % prime[i] == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">while</span> (n % prime[i] == <span class="number">0</span>)</span><br><span class="line">                n /= prime[i];</span><br><span class="line">            <span class="keyword">if</span> (n &gt; <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">return</span> prime[i];</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">solve</span><span class="params">(<span class="type">int</span> g, <span class="type">int</span> mo)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">gcd</span>(g, mo) != <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= r; i++)</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">ksm</span>(g, phi[mo] / a[i], mo) == <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getg</span><span class="params">(<span class="type">int</span> mo)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n = phi[mo];</span><br><span class="line">    r = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; prime[i] * prime[i] &lt;= n; i++)</span><br><span class="line">        <span class="keyword">if</span> (n % prime[i] == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">while</span> (n % prime[i] == <span class="number">0</span>)</span><br><span class="line">                n /= prime[i];</span><br><span class="line">            a[++r] = prime[i];</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">1</span>)</span><br><span class="line">        a[++r] = n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt; mo; i++)</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">solve</span>(i, mo))</span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n) != EOF) &#123;</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;3&quot;</span>);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> ch = (n % <span class="number">2</span> == <span class="number">1</span>) ? <span class="built_in">check</span>(n) : <span class="built_in">check</span>(n / <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">if</span> (ch == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;-1&quot;</span>);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> g = <span class="built_in">getg</span>(n);</span><br><span class="line">        <span class="type">int</span> l = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= phi[n]; i++)</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">gcd</span>(i, phi[n]) == <span class="number">1</span>)</span><br><span class="line">                ans[++l] = <span class="built_in">ksm</span>(g, i, n);</span><br><span class="line">        <span class="built_in">sort</span>(ans + <span class="number">1</span>, ans + <span class="number">1</span> + l);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= l; i++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, ans[i]);</span><br><span class="line">            <span class="keyword">if</span> (i == l)</span><br><span class="line">                <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot; &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="数论"><a href="#数论" class="headerlink" title="数论"></a>数论</h1><h2 id="区间筛"><a href="#区间筛" class="headerlink" title="区间筛"></a>区间筛</h2><p>切记区间筛的范围为[a,b)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> LL;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e6</span>;</span><br><span class="line"><span class="type">bool</span> b[N + <span class="number">5</span>];<span class="comment">//a到b的素数判断</span></span><br><span class="line"><span class="type">bool</span> bprime[N + <span class="number">5</span>];<span class="comment">//0到sqrt(b)的素数判断数组</span></span><br><span class="line">LL prime[N + <span class="number">5</span>];<span class="comment">//a到b的素数数组</span></span><br><span class="line">LL isprime[N + <span class="number">5</span>];<span class="comment">//0到sqrt(b)的素数数组</span></span><br><span class="line">LL p;</span><br><span class="line">LL cnt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(LL l, LL r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(b, <span class="number">1</span>, <span class="built_in">sizeof</span>(b));</span><br><span class="line">	<span class="built_in">memset</span>(bprime, <span class="number">1</span>, <span class="built_in">sizeof</span>(bprime));</span><br><span class="line">	<span class="keyword">for</span> (LL i = <span class="number">2</span>; i * i &lt; r; i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (bprime[i]) &#123;</span><br><span class="line">			isprime[++cnt] = i;</span><br><span class="line">			<span class="keyword">for</span> (LL j = <span class="built_in">max</span>(<span class="number">2LL</span>, (l + i - <span class="number">1</span>) / i) * i; j &lt;= r; j += i) &#123;</span><br><span class="line">				b[j - l + <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">			<span class="comment">//2LL是2的长整型形式</span></span><br><span class="line">			<span class="comment">// max用于把((a+i-1)/i)*i)和最小素数2进行比较，一般是((a+i-1)/i)*i)，但是但a是1就是2了，它保证删除的都是素数的倍数</span></span><br><span class="line">			<span class="comment">// ((a+i-1)/i)*i)当a为1时，如果没有最大值判定，那么j就是1，会把所有数字删掉</span></span><br><span class="line">			<span class="comment">// 右移回到a，b区间进行判断，判断成功左移回来赋值false</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= cnt &amp;&amp; i * isprime[j] &lt;= N; j++) &#123;<span class="comment">//正常欧拉筛写法</span></span><br><span class="line">			bprime[i * isprime[j]] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">if</span> (i % isprime[j] == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (LL i = <span class="number">1</span>; i &lt;= r - l; i++) &#123;<span class="comment">//找到了所有a到b的素数，把素数放进素数表中</span></span><br><span class="line">		<span class="keyword">if</span> (b[i]) prime[++p] = i + l - <span class="number">1</span>;<span class="comment">//注意这里如果l是1的话会把1算作素数</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="区间计数"><a href="#区间计数" class="headerlink" title="区间计数"></a>区间计数</h2><p>一般使用差分数组计算</p>
<h2 id="区间合并"><a href="#区间合并" class="headerlink" title="区间合并"></a>区间合并</h2><p>（将带使用区间存入segs数组中）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">merge</span><span class="params">(vector&lt;PII&gt; &amp;segs)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		vector&lt;PII&gt; res;</span><br><span class="line"> </span><br><span class="line">		<span class="built_in">sort</span>(segs.<span class="built_in">begin</span>(), segs.<span class="built_in">end</span>());<span class="comment">//sort排序pair优先排序左端</span></span><br><span class="line"> </span><br><span class="line">		<span class="type">int</span> st = <span class="number">-2e9</span>, ed = <span class="number">-2e9</span>;<span class="comment">//边界</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">auto</span> seg : segs)</span><br><span class="line">			<span class="keyword">if</span> (ed &lt; seg.first)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span> (st != <span class="number">-2e9</span>) res.<span class="built_in">push_back</span>(&#123;st, ed&#125;);</span><br><span class="line">				st = seg.first, ed = seg.second;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> ed = <span class="built_in">max</span>(ed, seg.second);</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">if</span> (st != <span class="number">-2e9</span>) res.<span class="built_in">push_back</span>(&#123;st, ed&#125;);</span><br><span class="line"> </span><br><span class="line">		segs = res;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">typedef pair&lt;int, int&gt; PII;</span></span><br><span class="line"><span class="comment">vector&lt;PII&gt; vis;</span></span><br><span class="line"><span class="comment">int main()</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    vis.push_back(&#123; l,r &#125;);</span></span><br><span class="line"><span class="comment">    merge(vis);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h2 id="约数"><a href="#约数" class="headerlink" title="约数"></a>约数</h2><p>将一个数质因子分解为$$ p1^{a1}<em>p2^{a2}</em>…*pk^{ak} $$</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="约数个数"><a href="#约数个数" class="headerlink" title="约数个数"></a>约数个数</h2><p>约数的个数为(a1+1)<em>(a2+1)</em>..*(ak+1)</p>
<p>记得头文件，bits中没有</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> LL;</span><br><span class="line">unordered_map&lt;LL, LL&gt;sva;<span class="comment">//内部自带哈希，但其头文件不在万能头文件中</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MOD = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> n;</span><br><span class="line">	cin &gt;&gt; n;</span><br><span class="line">	<span class="keyword">while</span> (n--) &#123;</span><br><span class="line">		<span class="type">int</span> a;</span><br><span class="line">		cin &gt;&gt; a;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= a / i; i++) &#123;<span class="comment">//质因子分解过程</span></span><br><span class="line">			<span class="keyword">while</span> (a % i == <span class="number">0</span>) &#123;</span><br><span class="line">				a /= i;</span><br><span class="line">				sva[i]++;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (a &gt; <span class="number">1</span>) sva[a]++;</span><br><span class="line">	&#125;</span><br><span class="line">	LL res = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">auto</span> tmp : sva) &#123;</span><br><span class="line">		res = (res * (tmp.second + <span class="number">1</span>)) % MOD;</span><br><span class="line">	&#125;</span><br><span class="line">	cout &lt;&lt; res &lt;&lt; endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="素数检验"><a href="#素数检验" class="headerlink" title="素数检验"></a>素数检验</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LL <span class="title">Rand</span><span class="params">()</span> </span>&#123;<span class="comment">//决定了程序的性能</span></span><br><span class="line">    <span class="type">static</span> LL x = (<span class="built_in">srand</span>((<span class="type">int</span>)<span class="built_in">time</span>(<span class="number">0</span>)), <span class="built_in">rand</span>());</span><br><span class="line">    x += <span class="number">1000003</span>;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">1000000007</span>)</span><br><span class="line">        x -= <span class="number">1000000007</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Witness</span><span class="params">(LL a, LL n)</span> </span>&#123;</span><br><span class="line">    LL t = <span class="number">0</span>, u = n - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (!(u &amp; <span class="number">1</span>))</span><br><span class="line">        u &gt;&gt;= <span class="number">1</span>, t++;</span><br><span class="line">    LL x = <span class="built_in">ksm</span>(a, u, n), y;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">while</span> (t--) &#123;</span><br><span class="line">        y = x * x % n;</span><br><span class="line">        <span class="keyword">if</span> (y == <span class="number">1</span> &amp;&amp; x != <span class="number">1</span> &amp;&amp; x != n - <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        x = y;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> x != <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">MillerRabin</span><span class="params">(LL n, LL s)</span> </span>&#123;<span class="comment">//s为检验次数</span></span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">2</span> || n == <span class="number">3</span> || n == <span class="number">5</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (n % <span class="number">2</span> == <span class="number">0</span> || n % <span class="number">3</span> == <span class="number">0</span> || n % <span class="number">5</span> == <span class="number">0</span> || n == <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">while</span> (s--) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">Witness</span>(<span class="built_in">Rand</span>() % (n - <span class="number">1</span>) + <span class="number">1</span>, n))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">qread</span>():</span><br><span class="line">    x = <span class="number">0</span></span><br><span class="line">    y = <span class="number">1</span></span><br><span class="line">    c = <span class="built_in">input</span>()</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> c.isdigit():</span><br><span class="line">        <span class="keyword">if</span> c == <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">            y = -<span class="number">1</span></span><br><span class="line">        c = <span class="built_in">input</span>()</span><br><span class="line">    x = <span class="built_in">int</span>(c) * y</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">if</span> x &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;-&#x27;</span>, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        x = -x</span><br><span class="line">    <span class="keyword">if</span> x &gt; <span class="number">9</span>:</span><br><span class="line">        write(x // <span class="number">10</span>)</span><br><span class="line">    <span class="built_in">print</span>(x % <span class="number">10</span>, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ksc</span>(<span class="params">a, b, c</span>):</span><br><span class="line">    ans = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> b:</span><br><span class="line">        <span class="keyword">if</span> b &amp; <span class="number">1</span>:</span><br><span class="line">            ans = (ans + a) % c</span><br><span class="line">        b &gt;&gt;= <span class="number">1</span></span><br><span class="line">        a = (a + a) % c</span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ksm</span>(<span class="params">a, b, c</span>):</span><br><span class="line">    ans = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> b:</span><br><span class="line">        <span class="keyword">if</span> b &amp; <span class="number">1</span>:</span><br><span class="line">            ans = ksc(ans, a, c)</span><br><span class="line">        b &gt;&gt;= <span class="number">1</span></span><br><span class="line">        a = ksc(a, a, c)</span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Rand</span>():</span><br><span class="line">    <span class="keyword">global</span> x</span><br><span class="line">    x += <span class="number">1000003</span></span><br><span class="line">    <span class="keyword">if</span> x &gt; <span class="number">1000000007</span>:</span><br><span class="line">        x -= <span class="number">1000000007</span></span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Witness</span>(<span class="params">a, n</span>):</span><br><span class="line">    t = <span class="number">0</span></span><br><span class="line">    u = n - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> u &amp; <span class="number">1</span>:</span><br><span class="line">        u &gt;&gt;= <span class="number">1</span></span><br><span class="line">        t += <span class="number">1</span></span><br><span class="line">    x = ksm(a, u, n)</span><br><span class="line">    <span class="keyword">while</span> t:</span><br><span class="line">        y = x * x % n</span><br><span class="line">        <span class="keyword">if</span> y == <span class="number">1</span> <span class="keyword">and</span> x != <span class="number">1</span> <span class="keyword">and</span> x != n - <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        x = y</span><br><span class="line">        t -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> x != <span class="number">1</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">MillerRabin</span>(<span class="params">n, s</span>):</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">2</span> <span class="keyword">or</span> n == <span class="number">3</span> <span class="keyword">or</span> n == <span class="number">5</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">if</span> n % <span class="number">2</span> == <span class="number">0</span> <span class="keyword">or</span> n % <span class="number">3</span> == <span class="number">0</span> <span class="keyword">or</span> n % <span class="number">5</span> == <span class="number">0</span> <span class="keyword">or</span> n == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">while</span> s:</span><br><span class="line">        <span class="keyword">if</span> Witness(random.randint(<span class="number">1</span>, n - <span class="number">1</span>), n):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        s -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    y=<span class="number">10</span>**<span class="number">30</span>+<span class="number">50</span></span><br><span class="line">    <span class="built_in">print</span>(y)</span><br><span class="line">    x = qread()</span><br><span class="line">    write(x)</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> MillerRabin(x, <span class="number">10</span>):</span><br><span class="line">        x += <span class="number">1</span></span><br><span class="line">    write(x)</span><br></pre></td></tr></table></figure>

<h2 id="Pollard-Rho算法分解质因数"><a href="#Pollard-Rho算法分解质因数" class="headerlink" title="Pollard Rho算法分解质因数"></a>Pollard Rho算法分解质因数</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> LL;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> S = <span class="number">20</span>;<span class="comment">//随机算法判定次数，S越大，判错概率越小</span></span><br><span class="line"><span class="function">LL <span class="title">ksc</span><span class="params">(LL a, LL b, LL p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    LL ans = <span class="number">0</span>;<span class="comment">//快速成是加法</span></span><br><span class="line">    <span class="keyword">while</span> (b &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>) &#123;</span><br><span class="line">            ans = (ans + a) % p;</span><br><span class="line">        &#125;</span><br><span class="line">        b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">        a = (a + a) % p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">LL <span class="title">ksm</span><span class="params">(LL a, LL b, LL p)</span><span class="comment">//快速幂</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    LL ans = <span class="number">1</span>;<span class="comment">//快速幂的乘法</span></span><br><span class="line">    <span class="keyword">while</span> (b &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>) &#123;</span><br><span class="line">            ans = <span class="built_in">ksc</span>(ans, a, p) % p;<span class="comment">//用快速乘代替原来的乘法运算</span></span><br><span class="line">        &#125;</span><br><span class="line">        b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">        a = <span class="built_in">ksc</span>(a, a, p) % p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//一定是合数返回true,不一定返回false</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">check</span><span class="params">(LL a, LL n, LL x, LL t)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    LL ret = <span class="built_in">ksm</span>(a, x, n);</span><br><span class="line">    LL last = ret;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= t; i++) &#123;</span><br><span class="line">        ret = <span class="built_in">ksc</span>(ret, ret, n);</span><br><span class="line">        <span class="keyword">if</span> (ret == <span class="number">1</span> &amp;&amp; last != <span class="number">1</span> &amp;&amp; last != n - <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">true</span>;<span class="comment">//合数</span></span><br><span class="line">        last = ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (ret != <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Miller_Rabin()算法素数判定</span></span><br><span class="line"><span class="comment">//是素数返回true.(可能是伪素数，但概率极小)</span></span><br><span class="line"><span class="comment">//合数返回false;</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Miller_Rabin</span><span class="params">(LL n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt; <span class="number">2</span>)<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">2</span>)<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> ((n &amp; <span class="number">1</span>) == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;<span class="comment">//偶数</span></span><br><span class="line">    LL x = n - <span class="number">1</span>;</span><br><span class="line">    LL t = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ((x &amp; <span class="number">1</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        x &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">        t++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; S; i++) &#123;</span><br><span class="line">        LL a = <span class="built_in">rand</span>() % (n - <span class="number">1</span>) + <span class="number">1</span>;<span class="comment">//rand()需要stdlib.h头文件</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">check</span>(a, n, x, t))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;<span class="comment">//合数</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//pollard_rho 算法进行质因数分解</span></span><br><span class="line"></span><br><span class="line">LL factor[<span class="number">100</span>];<span class="comment">//质因数分解结果（刚返回时是无序的）</span></span><br><span class="line"><span class="type">int</span> tol;<span class="comment">//质因数的个数。数组小标从0开始</span></span><br><span class="line"></span><br><span class="line"><span class="function">LL <span class="title">gcd</span><span class="params">(LL a, LL b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (a == <span class="number">0</span>)<span class="keyword">return</span> <span class="number">1</span>;<span class="comment">//???????</span></span><br><span class="line">    <span class="keyword">if</span> (a &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="built_in">gcd</span>(-a, b);</span><br><span class="line">    <span class="keyword">while</span> (b) &#123;</span><br><span class="line">        LL t = a % b;</span><br><span class="line">        a = b;</span><br><span class="line">        b = t;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">LL <span class="title">Pollard_rho</span><span class="params">(LL x, LL c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    LL i = <span class="number">1</span>, k = <span class="number">2</span>;      <span class="comment">//i和k分别表示x0和y的前进距离，距离不同却相等说明有环</span></span><br><span class="line">    LL x0 = <span class="built_in">rand</span>() % x;</span><br><span class="line">    LL y = x0;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        i++;</span><br><span class="line">        x0 = (<span class="built_in">ksc</span>(x0, x0, x) + c) % x;</span><br><span class="line">        LL d = <span class="built_in">gcd</span>(y - x0, x);</span><br><span class="line">        <span class="keyword">if</span> (d != <span class="number">1</span> &amp;&amp; d != x) <span class="keyword">return</span> d;</span><br><span class="line">        <span class="keyword">if</span> (y == x0) <span class="keyword">return</span> x;</span><br><span class="line">        <span class="keyword">if</span> (i == k) &#123;</span><br><span class="line">            y = x0;</span><br><span class="line">            k += k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//对n进行素因子分解</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">findfac</span><span class="params">(LL n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Miller_Rabin</span>(n))<span class="comment">//素数</span></span><br><span class="line">    &#123;</span><br><span class="line">        factor[tol++] = n;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    LL p = n;</span><br><span class="line">    <span class="keyword">while</span> (p &gt;= n)p = <span class="built_in">Pollard_rho</span>(p, <span class="built_in">rand</span>() % (n - <span class="number">1</span>) + <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">findfac</span>(p);</span><br><span class="line">    <span class="built_in">findfac</span>(n / p);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LL num;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> t;</span><br><span class="line">    cin &gt;&gt; t;</span><br><span class="line">    <span class="keyword">while</span> (t--) &#123;</span><br><span class="line">        tol = <span class="number">0</span>;</span><br><span class="line">        cin &gt;&gt; num;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">Miller_Rabin</span>(num)) &#123;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;Prime&quot;</span> &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">findfac</span>(num);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; tol; i++)</span><br><span class="line">                cout &lt;&lt; factor[i] &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="整除分块"><a href="#整除分块" class="headerlink" title="整除分块"></a>整除分块</h2><p>求$$\sum_{i&#x3D;1}^{n} \left \lfloor \frac{n}{i} \right \rfloor$$</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>  ans = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>, r; l &lt;= n; l = r + <span class="number">1</span>) &#123;</span><br><span class="line">	r = n / (n / l);</span><br><span class="line">	ans += n / l * (r - l + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>求$$\sum_{i&#x3D;1}^{n} f(i)\left \lfloor \frac{n}{i} \right \rfloor$$</p>
<p>需要预处理出f(x)的前缀和数组，再进行分块求和</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>, r; l &lt;= n; l = r + <span class="number">1</span>) &#123;</span><br><span class="line">		r = n / (n / l);</span><br><span class="line">		ans += (sum[r] - sum[l - <span class="number">1</span>]) * (n / l);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h2 id="莫比乌斯函数计算"><a href="#莫比乌斯函数计算" class="headerlink" title="莫比乌斯函数计算"></a>莫比乌斯函数计算</h2><h3 id="求单个值"><a href="#求单个值" class="headerlink" title="求单个值"></a>求单个值</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n;</span><br><span class="line">cin &gt;&gt; n;</span><br><span class="line"><span class="type">int</span> ans = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i * i &lt;= n; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (n % i == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (n % (i * i) == <span class="number">0</span>) &#123;</span><br><span class="line">            cout &lt;&lt; <span class="number">0</span> &lt;&lt; endl;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (n % i == <span class="number">0</span>) n /= i;</span><br><span class="line">        ans *= (<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (n) ans *= (<span class="number">-1</span>);</span><br><span class="line">cout &lt;&lt; ans &lt;&lt; endl;</span><br></pre></td></tr></table></figure>

<h3 id="筛法求值"><a href="#筛法求值" class="headerlink" title="筛法求值"></a>筛法求值</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e4</span> + <span class="number">5</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> max1 = <span class="number">1e4</span>;</span><br><span class="line"><span class="type">int</span> b[N], prime[N], mo[N];</span><br><span class="line"><span class="type">int</span> cnt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(b, <span class="number">1</span>, <span class="built_in">sizeof</span>(b));</span><br><span class="line">    b[<span class="number">0</span>] = b[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    mo[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= max1; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b[i]) &#123;</span><br><span class="line">            prime[++cnt] = i;</span><br><span class="line">            mo[i] = <span class="number">-1</span>;<span class="comment">//质数的莫比乌斯函数值为-1</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= cnt &amp;&amp; prime[j] * i &lt;= max1; j++)<span class="comment">//质数的质数倍，保证不做重复运算</span></span><br><span class="line">        &#123;</span><br><span class="line">            b[prime[j] * i] = <span class="number">0</span>;<span class="comment">//标记为0，即为非质数</span></span><br><span class="line">            <span class="keyword">if</span> (i % prime[j] == <span class="number">0</span>) <span class="keyword">break</span>;<span class="comment">//解释为i的最小素因子是prime[j]，但我猜测此时i==prime[j]</span></span><br><span class="line">            mo[prime[j] * i] = -mo[i];<span class="comment">//由于prime[j]是质数且i不是prime[j]整数倍，所以就会多出一个质数，即变为相反</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="欧拉函数计算"><a href="#欧拉函数计算" class="headerlink" title="欧拉函数计算"></a>欧拉函数计算</h2><h3 id="求单个值-1"><a href="#求单个值-1" class="headerlink" title="求单个值"></a>求单个值</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a;</span><br><span class="line"><span class="keyword">while</span> (cin &gt;&gt; a) &#123;</span><br><span class="line">	<span class="type">int</span> ans = a;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i * i &lt;= a; i++) &#123;<span class="comment">//寻找素因子</span></span><br><span class="line">		<span class="keyword">if</span> (a % i == <span class="number">0</span>) &#123;</span><br><span class="line">			ans = ans / i * (i - <span class="number">1</span>);<span class="comment">//由于使用公式会出现小数，所以对原公式进行变形</span></span><br><span class="line">			<span class="keyword">while</span> (a % i == <span class="number">0</span>) a /= i;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (a &gt; <span class="number">1</span>) ans = ans / a * (a - <span class="number">1</span>);</span><br><span class="line">	cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="筛法求值-1"><a href="#筛法求值-1" class="headerlink" title="筛法求值"></a>筛法求值</h3><p>基于欧拉筛</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e6</span> + <span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> prime[N], b[N], phi[N];</span><br><span class="line"><span class="type">int</span> cnt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span><span class="comment">//欧拉筛法</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	phi[<span class="number">1</span>] = <span class="number">1</span>;<span class="comment">//第一种情况</span></span><br><span class="line">	<span class="built_in">memset</span>(b, <span class="number">1</span>, <span class="built_in">sizeof</span>(b));</span><br><span class="line">	b[<span class="number">0</span>] = b[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt; N; i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (b[i]) &#123;</span><br><span class="line">			prime[++cnt] = i;</span><br><span class="line">			phi[i] = i - <span class="number">1</span>;<span class="comment">//第四种情况</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; prime[j] * i &lt; N &amp;&amp; j &lt;= cnt; j++) &#123;</span><br><span class="line">			b[prime[j] * i] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">if</span> (i % prime[j] == <span class="number">0</span>) &#123;</span><br><span class="line">				phi[prime[j] * i] = phi[i] * prime[j];<span class="comment">//第二种情况</span></span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			phi[prime[j] * i] = phi[i] * (prime[j] - <span class="number">1</span>);<span class="comment">//第三种情况</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="和式的变换"><a href="#和式的变换" class="headerlink" title="和式的变换"></a>和式的变换</h2><p>和式的变换主要有几个核心公式</p>
<p>1.交换律，结合律</p>
<p>$$2. \sum_{i&#x3D;1}^{n}\sum_{j&#x3D;1}^{m}\sum_{d\mid gcd(i,j))}d&#x3D;\sum_{i&#x3D;1}^{n}\sum_{j&#x3D;1}^{m}\sum_{d&#x3D;1}^{n}\left [ d \mid i\right] \left [ d\mid j \right ]d$$</p>
<p>$$3.\sum_{i&#x3D;1}^{n}\sum_{j&#x3D;1}^{m}\left [ gcd(i,j)&#x3D;k \right ]&#x3D;\sum_{ik&#x3D;1}^{n}\sum_{jk&#x3D;1}^{m}\left [ gcd(ik,jk)&#x3D;k \right ]&#x3D;\sum_{i&#x3D;1}^{\frac{n}{k}}\sum_{j&#x3D;1}^{\frac{m}{k}}\left [ gcd(i,j)&#x3D;1 \right ]$$</p>
<p>$$4.\sum_{i&#x3D;1}^{n}\sum_{j&#x3D;1}^{m}A(i)B(j)&#x3D;\sum_{j&#x3D;1}^{m}\sum_{i&#x3D;1}^{n}A(i)B(j)$$</p>
<p>$$5. \sum_{i&#x3D;1}^{n}\sum_{j&#x3D;1}^{m}A(i)B(j)&#x3D;\sum_{i&#x3D;1}^{n}A(i)\sum_{j&#x3D;1}^{m}B(j)$$</p>
<p>其中[ ]为示性函数，符合条件的为1</p>
<p>常见变换式：</p>
<p>$$1.\left [ gcd(i,j)&#x3D;1 \right ]&#x3D;\sum_{d\mid gcd(i,j))}\mu (d)$$</p>
<p>同时这个式子也是莫比乌斯反演的常用式子</p>
<p>$$2.d\mid gcd(i,j)\rightarrow \left [ d\mid i \right ]\left [ d\mid j \right ]$$</p>
<p>$$3.\sum_{i&#x3D;1}^{n}\left [ d\mid i \right ]\rightarrow \left \lfloor \frac{n}{d} \right \rfloor$$</p>
<p>$$4.\sum_{i&#x3D;1}^{n}\sum_{j&#x3D;1}^{m}\left [ gcd(i,j)&#x3D;k \right ]&#x3D;\sum_{i&#x3D;1}^{\frac{n}{k}}\sum_{j&#x3D;1}^{\frac{m}{k}}\left [ gcd(i,j)&#x3D;1 \right ]$$</p>
<p>其中n&#x2F;k和m&#x2F;k为下取整但在代码中int会下取整所以没有标明</p>
<p>$$5.\sum_{k&#x3D;1}^{n}\sum_{d&#x3D;1}^{\frac{n}{k}}\mu (d)\left \lfloor \frac{n}{kd} \right \rfloor\left \lfloor \frac{m}{kd} \right \rfloor\rightarrow \sum_{k&#x3D;1}^{n}\sum_{T&#x3D;1}^{n}\mu (\frac{T}{k})\left \lfloor \frac{n}{T} \right \rfloor\left \lfloor \frac{m}{T} \right \rfloor$$</p>
<p>大部分不做这个变换而是在向函数传参时传n&#x2F;k为n</p>
<h2 id="莫比乌斯反演"><a href="#莫比乌斯反演" class="headerlink" title="莫比乌斯反演"></a>莫比乌斯反演</h2><h3 id="狄利克雷卷积"><a href="#狄利克雷卷积" class="headerlink" title="狄利克雷卷积"></a>狄利克雷卷积</h3><p>$$(f*g)(n)&#x3D;\sum_{d \mid n}^{}f(d)g(\frac{n}{d})&#x3D;\sum_{d\mid n}^{}f(\frac{n}{d})g(d)$$</p>
<p>三个常用函数</p>
<p>1.元函数</p>
<p>$$\varepsilon (n)&#x3D;\left [ n&#x3D;1 \right ]$$</p>
<p>2.常数函数</p>
<p>$$1(n)&#x3D;1$$</p>
<p>3.恒等函数</p>
<p>$$id(n)&#x3D;n$$</p>
<p>常用的卷积关系</p>
<p>$$1.\sum_{d\mid n}^{}\mu (d)&#x3D;\left [ n&#x3D;1 \right ]\Leftrightarrow \mu *1&#x3D;\varepsilon$$</p>
<p>$$2.\sum_{d\mid n}^{}\varphi (d)&#x3D;n\Leftrightarrow \varphi *1&#x3D;id$$</p>
<p>$$3.\sum_{d\mid n}^{}\mu (d)\frac{n}{d}&#x3D;\varphi (n)\Leftrightarrow \mu * id&#x3D;\varphi$$</p>
<h3 id="莫比乌斯反演-1"><a href="#莫比乌斯反演-1" class="headerlink" title="莫比乌斯反演"></a>莫比乌斯反演</h3><p>公式为：</p>
<p>$$f(n)&#x3D;\sum_{d \mid n}g(d)\Leftrightarrow g(n)&#x3D;\sum_{d \mid n}^{}\mu (d)f(\frac{n}{d})$$</p>
<p>但是经常使用的为</p>
<p>$$\left [ gcd(i,j)&#x3D;1 \right ]&#x3D;\sum_{d\mid gcd(i,j))}\mu (d)$$</p>
<h3 id="欧拉反演"><a href="#欧拉反演" class="headerlink" title="欧拉反演"></a>欧拉反演</h3><p>欧拉反演只是莫比乌斯反演的一种特殊情况，求</p>
<p>$$\sum_{i&#x3D;1}^{n} \sum_{j&#x3D;1}^{m}gcd(i,j)$$</p>
<p>经过欧拉反演可以得出</p>
<p>$$\sum_{i&#x3D;1}^{n} \sum_{j&#x3D;1}^{m}\sum_{d&#x3D;1}^{n}[d\mid i][d\mid j]\varphi (d)$$</p>
<p>这比经过莫比乌斯反演得出的式子简洁许多</p>
<p>欧拉反演的式子：</p>
<p>$$\sum_{d\mid n}^{n}\varphi (d)&#x3D;n$$</p>
<h3 id="二项式反演"><a href="#二项式反演" class="headerlink" title="二项式反演"></a>二项式反演</h3><p>一般在使用二项式反演时，为已知一个的具体表达式，求另一个</p>
<p>设 $$f(n)$$ 为至少（或至多）选定 $$n$$ 个的方案数， $$g(n)$$为恰好选定 $$n$$ 个的方案数</p>
<p><strong>这类是g为恰好，f为至多</strong></p>
<p>$$1.f(n)&#x3D;\sum_{i&#x3D;0}^{n}\binom{n}{i}g(i)\Leftrightarrow g(n)&#x3D;\sum_{i&#x3D;0}^{n}(-1)^{n-i}\binom{n}{i}f(i)$$</p>
<p>$$2.f(n)&#x3D;\sum_{i&#x3D;0}^{n}(-1)^{i}\binom{n}{i}g(i)\Leftrightarrow g(n)&#x3D;\sum_{i&#x3D;0}^{n}(-1)^{i}\binom{n}{i}f(i)$$</p>
<p><strong>这类是g为恰好，f为至少</strong></p>
<p>$$3.f(n)&#x3D;\sum_{i&#x3D;n}^{m}\binom{i}{n}g(i)\Leftrightarrow g(n)&#x3D;\sum_{i&#x3D;n}^{m}(-1)^{i-n}\binom{i}{n}f(i)$$</p>
<p>$$4.f(n)&#x3D;\sum_{i&#x3D;n}^{m}(-1)^{i}\binom{i}{n}g(i)\Leftrightarrow g(n)&#x3D;\sum_{i&#x3D;n}^{m}(-1)^{i}\binom{i}{n}f(i)$$</p>
<p>$$5.f(n,m)&#x3D;\sum_{i&#x3D;0}^{n}\sum_{j&#x3D;0}^{m}\binom{n}{i}\binom{m}{j}g(i,j)\Leftrightarrow g(n,m)&#x3D;\sum_{i&#x3D;0}^{n}\sum_{j&#x3D;0}^{m}(-1)^{n+m-i-j}\binom{n}{i}\binom{m}{j}f(i,j)$$</p>
<p>$$6.f(n,m)&#x3D;\sum_{i&#x3D;0}^{n}\sum_{j&#x3D;0}^{m}(-1)^{i+j}\binom{n}{i}\binom{m}{j}g(i,j)\Leftrightarrow g(n,m)&#x3D;\sum_{i&#x3D;0}^{n}\sum_{j&#x3D;0}^{m}(-1)^{i+j}\binom{n}{i}\binom{m}{j}f(i,j)$$</p>
<p>$$7.f(n,m)&#x3D;\sum_{i&#x3D;n}^{?}\sum_{j&#x3D;m}^{?}\binom{i}{n}\binom{j}{m}g(i,j)\Leftrightarrow g(n,m)&#x3D;\sum_{i&#x3D;n}^{?}\sum_{j&#x3D;m}^{?}(-1)^{i+j-n-m}\binom{i}{n}\binom{j}{m}f(i,j)$$</p>
<p>$$8.f(n,m)&#x3D;\sum_{i&#x3D;n}^{?}\sum_{j&#x3D;m}^{?}(-1)^{i+j}\binom{i}{n}\binom{j}{m}g(i,j)\Leftrightarrow g(n,m)&#x3D;\sum_{i&#x3D;n}^{?}\sum_{j&#x3D;m}^{?}(-1)^{i+j-}\binom{i}{n}\binom{j}{m}f(i,j)$$</p>
<h2 id="杜教筛"><a href="#杜教筛" class="headerlink" title="杜教筛"></a>杜教筛</h2><p>杜教筛的核心是狄利克雷卷积，运用狄利克雷卷积把积性函数的前缀和等运算优化到小于线性的时间复杂度  </p>
<p>主要根据三个常用积性函数，构造g  </p>
<p>杜教筛最好在初始化时，初始化2&#x2F;3大小的前缀和，否则大概T</p>
<p>*<em>公式：$\ g(1)<em>S(n) &#x3D; \sum_{i&#x3D;1}^{n}{(f</em>g)(i)}-\sum_{i&#x3D;2}^{n}{g(i)<em>S(\frac{n}{i})} $</em></em>  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//特别注意Sphi和Smo均使用map存储，使用int一般使用杜教筛范围都在1e8-1e9间</span></span><br><span class="line"><span class="comment">//欧拉函数前n项和</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getphi</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt; N) <span class="keyword">return</span> sumphi[n];<span class="comment">//筛好的前缀和</span></span><br><span class="line">    <span class="keyword">if</span> (Sphi.<span class="built_in">count</span>(n)) <span class="keyword">return</span> Sphi[n];<span class="comment">//记忆化</span></span><br><span class="line">    <span class="type">int</span> ans = <span class="number">1LL</span> * n * (n + <span class="number">1</span>) / <span class="number">2</span>;<span class="comment">//f * g的前缀和</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">2</span>, r; l &lt;= n; l = r + <span class="number">1</span>) &#123;<span class="comment">//数论分块</span></span><br><span class="line">        r = n / (n / l);</span><br><span class="line">        ans -= (r - l + <span class="number">1</span>) * <span class="built_in">getphi</span>(n / l);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Sphi[n] = ans;<span class="comment">//记忆化</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//莫比乌斯函数前n项和</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getmo</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt; N) <span class="keyword">return</span> summo[n];</span><br><span class="line">    <span class="keyword">if</span> (Smo.<span class="built_in">count</span>(n)) <span class="keyword">return</span> Smo[n];</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">1LL</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">2</span>, r; l &lt;= n; l = r + <span class="number">1</span>) &#123;</span><br><span class="line">        r = n / (n / l);</span><br><span class="line">        ans -= (r - l + <span class="number">1</span>) * <span class="built_in">getmo</span>(n / l);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Smo[n] = ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//一般形式</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">GetSum</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123; <span class="comment">// 算 f 前缀和的函数</span></span><br><span class="line">    <span class="keyword">if</span> (n &lt; N) <span class="keyword">return</span> <span class="built_in">f_sum</span>(n);<span class="comment">//f的前缀和</span></span><br><span class="line">    <span class="keyword">if</span> (S.<span class="built_in">count</span>(n)) <span class="keyword">return</span> S[n];<span class="comment">//记忆化,S为map定义</span></span><br><span class="line">    <span class="type">int</span> ans = <span class="built_in">f_g_sum</span>(n); <span class="comment">// 算 f * g 的前缀和</span></span><br><span class="line">    <span class="comment">// 以下这个 for 循环是数论分块</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">2</span>, r; l &lt;= n; l = r + <span class="number">1</span>) &#123; <span class="comment">// 注意从 2 开始</span></span><br><span class="line">        r = (n / (n / l));</span><br><span class="line">        ans -= (<span class="built_in">g_sum</span>(r) - <span class="built_in">g_sum</span>(l - <span class="number">1</span>)) * <span class="built_in">GetSum</span>(n / l);</span><br><span class="line">        <span class="comment">// g_sum 是 g 的前缀和</span></span><br><span class="line">        <span class="comment">// 递归 GetSum 求解</span></span><br><span class="line">    &#125; <span class="keyword">return</span> S[n] = ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="逆元"><a href="#逆元" class="headerlink" title="逆元"></a>逆元</h2><p>逆元常用的有两种计算方法：</p>
<p>扩展欧几里得和费马小定理，其中exgcd在下文中有写。费马小定理前提为a与MOD互质，则逆元为ksm(a,MOD-2,MOD);</p>
<h3 id="线性时间计算逆元"><a href="#线性时间计算逆元" class="headerlink" title="线性时间计算逆元"></a>线性时间计算逆元</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        inv[i] = MOD - (MOD / i * inv[MOD % i] % MOD) % MOD;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="线性时间计算阶乘逆元"><a href="#线性时间计算阶乘逆元" class="headerlink" title="线性时间计算阶乘逆元"></a>线性时间计算阶乘逆元</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//先计算出n!的逆元</span></span><br><span class="line"> <span class="keyword">for</span> (<span class="type">int</span> i = n - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        inv[i] = inv[i + <span class="number">1</span>] * (i + <span class="number">1</span>) % MOD;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-n的LCM"><a href="#1-n的LCM" class="headerlink" title="1-n的LCM"></a>1-n的LCM</h3><p>对于1-n中所有数的lcm,其应该等于1-n中每个质数p的以p为底数对于n的对数次幂的累积 $\ lcm &#x3D; \prod p^{log_{p}{n}} $，log下取整</p>
<h2 id="GCD和EXGCD"><a href="#GCD和EXGCD" class="headerlink" title="GCD和EXGCD"></a>GCD和EXGCD</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">gcd</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (b == <span class="number">0</span>) <span class="keyword">return</span> a;</span><br><span class="line">	<span class="keyword">else</span> <span class="built_in">return</span>(<span class="built_in">gcd</span>(b, a % b));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">exgcd</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> &amp;x, <span class="type">int</span> &amp;y, <span class="type">int</span> &amp;d)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (b == <span class="number">0</span>) &#123;</span><br><span class="line">        x = <span class="number">1</span>;</span><br><span class="line">        y = <span class="number">0</span>;</span><br><span class="line">        d = a;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">exgcd</span>(b, a % b, x, y, d);</span><br><span class="line">    <span class="type">int</span> t;</span><br><span class="line">    t = x;</span><br><span class="line">    x = y;</span><br><span class="line">    y = t - (a / b) * y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//逆元算法</span></span><br><span class="line"><span class="keyword">if</span> (d == <span class="number">1</span>) cout &lt;&lt; (x + b) % b &lt;&lt; endl;</span><br><span class="line"><span class="keyword">else</span> cout &lt;&lt; <span class="string">&quot;没有\n&quot;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="线性同余方程"><a href="#线性同余方程" class="headerlink" title="线性同余方程"></a>线性同余方程</h2><p>一般使用扩展欧几里得算法，对于ax+by&#x3D;d有解，d当且仅当是gcd(a,b)的倍数</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">最小正整数解为：</span><br><span class="line"><span class="type">int</span> t = b / d * x % m;</span><br><span class="line"><span class="type">int</span> ans = (t % (m / d) + (m / d)) % (m / d);</span><br></pre></td></tr></table></figure>



<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//求解ax同余与b（mod m）</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">exgcd</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span>&amp; x, <span class="type">int</span>&amp; y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!b) &#123;</span><br><span class="line">		x = <span class="number">1</span>, y = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">return</span> a;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> d = <span class="built_in">exgcd</span>(b, a % b, y, x);</span><br><span class="line">	y -= a / b * x;</span><br><span class="line">	<span class="keyword">return</span> d;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> a, b, m;</span><br><span class="line">	<span class="type">int</span> x, y;</span><br><span class="line">	cin &gt;&gt; a &gt;&gt; b &gt;&gt; m;</span><br><span class="line">	<span class="type">int</span> d = <span class="built_in">exgcd</span>(a, m, x, y);</span><br><span class="line">	<span class="keyword">if</span> (b % d != <span class="number">0</span>) cout &lt;&lt; <span class="string">&quot;impossible&quot;</span> &lt;&lt; endl;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		cout &lt;&lt; b / d * x % m &lt;&lt; endl;<span class="comment">//x的值，证明没看懂</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h2 id="扩展中国剩余定理-（线性同余方程组）"><a href="#扩展中国剩余定理-（线性同余方程组）" class="headerlink" title="扩展中国剩余定理 （线性同余方程组）"></a>扩展中国剩余定理 （线性同余方程组）</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n, M, ans;</span><br><span class="line"><span class="type">int</span> a[N], m[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ksc</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (b) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>) ans = (ans + a) % c;</span><br><span class="line">        b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">        a = (a + a) % c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">exgcd</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> &amp;x, <span class="type">int</span> &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!b) &#123;</span><br><span class="line">        x = <span class="number">1</span>, y = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> d = <span class="built_in">exgcd</span>(b, a % b, y, x);</span><br><span class="line">    y -= a / b * x;</span><br><span class="line">    <span class="keyword">return</span> d;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">excrt</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    M = m[<span class="number">1</span>], ans = a[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="type">int</span> p = ((a[i] - ans) % m[i] + m[i]) % m[i];</span><br><span class="line">        <span class="type">int</span> x = <span class="number">0</span>, y = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> d = <span class="built_in">exgcd</span>(M, m[i], x, y);</span><br><span class="line">        <span class="keyword">if</span> (p % d) <span class="keyword">return</span> <span class="number">-1</span>;<span class="comment">//无解</span></span><br><span class="line">        x = <span class="built_in">ksc</span>(x, p / d, m[i] / d);</span><br><span class="line">        ans += x * M;</span><br><span class="line">        M *= m[i] / d;</span><br><span class="line">        ans = (ans % M + M) % M;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (ans % M + M) % M;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="BSGS（高次同余方程）"><a href="#BSGS（高次同余方程）" class="headerlink" title="BSGS（高次同余方程）"></a>BSGS（高次同余方程）</h2><p>给定正整数 $a,p$，求满足$a^x\equiv b ( % p)$的最小非负整数$x$</p>
<p>但a，p互质时可以使用bsgs，但a，p不互质时，需使用exbsgs</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">exgcd</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> &amp;x, <span class="type">int</span> &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!b) &#123;</span><br><span class="line">        x = <span class="number">1</span>, y = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> d = <span class="built_in">exgcd</span>(b, a % b, y, x);</span><br><span class="line">    y -= a / b * x;</span><br><span class="line">    <span class="keyword">return</span> d;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">bsgs</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">1</span> % p == b % p) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> k = <span class="built_in">sqrt</span>(p) + <span class="number">1</span>;</span><br><span class="line">    unordered_map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; hash;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>, j = b % p; i &lt; k; ++i) &#123;</span><br><span class="line">        hash[j] = i;</span><br><span class="line">        j = (<span class="type">int</span>) j * a % p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ak = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; k; ++i) ak = (<span class="type">int</span>) ak * a % p;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, j = ak; i &lt;= k; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (hash.<span class="built_in">count</span>(j)) <span class="keyword">return</span> i * k - hash[j];</span><br><span class="line">        j = (<span class="type">int</span>) j * ak % p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -INF;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">exbsgs</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    b = (b % p + p) % p;</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">1</span> % p == b % p) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> x, y;</span><br><span class="line">    <span class="type">int</span> d = <span class="built_in">exgcd</span>(a, p, x, y);</span><br><span class="line">    <span class="keyword">if</span> (d &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b % d) <span class="keyword">return</span> -INF;</span><br><span class="line">        <span class="built_in">exgcd</span>(a / d, p / d, x, y);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">exbsgs</span>(a, (<span class="type">int</span>) b / d * x % (p / d), p / d) + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bsgs</span>(a, b, p);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BSGS(进阶版)<br>$$<br>求解 x^a \equiv b (% p)<br>$$<br>解法一：（BSGS）</p>
<p>设g为p的原根，根据原根的性质存在c，满足$ g^c\equiv x  $成立，同理存在 t ，满足$g^t\equiv b$成立。</p>
<p>所以有： $(g^c)^a \equiv b (%p) &lt;&#x3D;&gt; (g^a)^c \equiv b (%p)$ 由于$g^a$ 已知，所以可以直接使用BSGS求解c，也就是一个特解</p>
<p>解法二：（EXGCD）</p>
<p>设g为p的原根，根据原根的性质存在c，满足$ g^c\equiv x  $成立，同理存在 t ，满足$g^t\equiv b$成立。</p>
<p>所以有$ (g^c)^a \equiv b (%p) $ 根据阶的性质有，$ac \equiv t (% \phi(p))$ ，可以使用exgcd求解c，也是一个特解</p>
<p>求全部解：</p>
<p>我们在已知一个特解$g^c$的情况下，我们要得到全部解</p>
<p>$∵ g^{\phi(p)} \equiv 1 \pmod{p} $</p>
<p>∴ $\forall t \in \mathbb{Z}, x \equiv g^{ca+at\phi(p)} \pmod{p} $</p>
<p>∴ $ \forall t \in \mathbb{Z} \text{且} a \mid t\phi(p), x \equiv g^{c+at\phi(p)} \pmod{p} $</p>
<p>∵ $ a \mid t\phi(p) $</p>
<p>∴ $ \frac{\gcd(a, \phi(p))}{a} \mid t $</p>
<p>∴ $ t &#x3D; \frac{\gcd(a, \phi(p))}{a} \cdot i $</p>
<p>∴ $全部的解为: \forall i \in \mathbb{Z}, x \equiv g^{c + \frac{\gcd(a, \phi(p))}{\phi(p)} \cdot i} \pmod{p} $</p>
<p>$解的个数为 \gcd(a, \phi(p))$</p>
<h2 id="高斯消元"><a href="#高斯消元" class="headerlink" title="高斯消元"></a>高斯消元</h2><h3 id="线性方程组"><a href="#线性方程组" class="headerlink" title="线性方程组"></a>线性方程组</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">200</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> eps = <span class="number">1e-8</span>;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">double</span> a[N][N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">gauss</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> r, c;<span class="comment">//行，列</span></span><br><span class="line">	<span class="keyword">for</span> (c = <span class="number">1</span>, r = <span class="number">1</span>; c &lt;= n; c++) &#123;</span><br><span class="line">		<span class="type">int</span> t = r;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = r; i &lt;= n; i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">fabs</span>(a[i][c]) &gt; <span class="built_in">fabs</span>(a[t][c])) t = i;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">fabs</span>(a[t][c]) &lt; eps) <span class="keyword">continue</span>;<span class="comment">//用于下面判断解的情况</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = c; i &lt;= n + <span class="number">1</span>; i++) <span class="built_in">swap</span>(a[t][i], a[r][i]);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = n + <span class="number">1</span>; i &gt;= c; i--) a[r][i] /= a[r][c];</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = r + <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">fabs</span>(a[i][c]) &gt; eps) &#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> j = n + <span class="number">1</span>; j &gt;= c; j--) a[i][j] -= a[r][j] * a[i][c];<span class="comment">//目的为了把第r的第c个数变为0</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		r++;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (r &lt;= n) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = r; i &lt;= n; i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">fabs</span>(a[i][n + <span class="number">1</span>]) &gt; eps) <span class="keyword">return</span> <span class="number">2</span>;<span class="comment">//无解，出现0 = b情况</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;<span class="comment">//无穷多解</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt;= <span class="number">1</span>; i--) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = i + <span class="number">1</span>; j &lt;= n; j++) a[i][n + <span class="number">1</span>] -= a[i][j] * a[j][n + <span class="number">1</span>];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;<span class="comment">//有单组解</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">for (int i = 1; i &lt;= n; i++) &#123;</span></span><br><span class="line"><span class="comment">		printf(&quot;%.2lf\n&quot;, a[i][n + 1]);</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h3 id="枚举自由变元版"><a href="#枚举自由变元版" class="headerlink" title="枚举自由变元版"></a>枚举自由变元版</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> a[N][N];</span><br><span class="line"><span class="type">int</span> x[N];<span class="comment">//答案数组</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">gauss</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> r, c;<span class="comment">//行，列</span></span><br><span class="line">    <span class="keyword">for</span> (c = <span class="number">0</span>, r = <span class="number">0</span>; c &lt; n; c++) &#123;</span><br><span class="line">        <span class="type">int</span> t = r;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = r; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (a[i][c]) t = i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!a[t][c]) <span class="keyword">continue</span>;<span class="comment">//用于下面判断解的情况</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = c; i &lt;= n; i++) <span class="built_in">swap</span>(a[t][i], a[r][i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = r + <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (a[i][c]) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> j = n; j &gt;= c; j--) a[i][j] ^= a[r][j];<span class="comment">//目的为了把第r的第c个数变为0</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        r++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (r &lt; n) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = r; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (a[i][n]) <span class="keyword">return</span> INF;<span class="comment">//无解，出现0 = b情况</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        return n - r;//无穷多解，返回自由变元数</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>, j; i &lt; n; i++)<span class="comment">//主元非0（一定有，说不定什么时候就因为这个WA了）</span></span><br><span class="line">        <span class="keyword">if</span> (!a[i][i]) &#123;</span><br><span class="line">            <span class="keyword">for</span> (j = i + <span class="number">1</span>; j &lt; n; j++)</span><br><span class="line">                <span class="keyword">if</span> (a[i][j]) <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">if</span> (n == j) <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> r = <span class="number">0</span>; r &lt; n; r++) <span class="built_in">swap</span>(a[r][i], a[r][j]);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="type">int</span> res = INF;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; (<span class="number">1</span> &lt;&lt; (n - r)); j++) &#123;</span><br><span class="line">        <span class="type">int</span> tmp = j;</span><br><span class="line">        <span class="type">int</span> p = n - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (tmp) x[p--] = tmp % <span class="number">2</span>, tmp &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = r - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="type">int</span> tp = a[i][n];<span class="comment">//记录常数项</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = i + <span class="number">1</span>; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (a[i][j]) tp ^= a[i][j] * x[j];<span class="comment">//回代</span></span><br><span class="line">            &#125;</span><br><span class="line">            x[i] = tp;</span><br><span class="line">        &#125;</span><br><span class="line">        tmp = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) tmp += x[i];</span><br><span class="line">        res = <span class="built_in">min</span>(res, tmp);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="异或线性方程组"><a href="#异或线性方程组" class="headerlink" title="异或线性方程组"></a>异或线性方程组</h3><p>异或形式则需把a数组改为int形式，在处理上改为异或</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">200</span>;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> a[N][N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">gauss</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> r, c;<span class="comment">//行，列</span></span><br><span class="line">	<span class="keyword">for</span> (c = <span class="number">1</span>, r = <span class="number">1</span>; c &lt;= n; c++) &#123;</span><br><span class="line">		<span class="type">int</span> t = r;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = r; i &lt;= n; i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (a[i][c]) t = i;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (!a[t][c]) <span class="keyword">continue</span>;<span class="comment">//用于下面判断解的情况</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = c; i &lt;= n + <span class="number">1</span>; i++) <span class="built_in">swap</span>(a[t][i], a[r][i]);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = n + <span class="number">1</span>; i &gt;= c; i--) a[r][i] /= a[r][c];</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = r + <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (a[i][c]) &#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> j = n + <span class="number">1</span>; j &gt;= c; j--) a[i][j] ^= a[r][j];<span class="comment">//目的为了把第r的第c个数变为0</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		r++;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (r &lt;= n) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = r; i &lt;= n; i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (a[i][n + <span class="number">1</span>]) <span class="keyword">return</span> <span class="number">2</span>;<span class="comment">//无解，出现0 = b情况</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;<span class="comment">//无穷多解</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt;= <span class="number">1</span>; i--) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = i + <span class="number">1</span>; j &lt;= n; j++) a[i][n + <span class="number">1</span>] ^= a[i][j] * a[j][n + <span class="number">1</span>];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;<span class="comment">//有单组解</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">for (int i = 1; i &lt;= n; i++) &#123;</span></span><br><span class="line"><span class="comment">		printf(&quot;%d\n&quot;, a[i][n + 1]);</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h3 id="方程数和变量数不相等时"><a href="#方程数和变量数不相等时" class="headerlink" title="方程数和变量数不相等时"></a>方程数和变量数不相等时</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a[N][N], x[N];<span class="comment">//a 是系数矩阵和增广矩阵，x 是最后存放的解</span></span><br><span class="line"><span class="type">int</span> equ, var;<span class="comment">//equ 是系数阵的行数，var 是系数矩阵的列数（变量的个数）</span></span><br><span class="line"><span class="type">int</span> free_num;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">gcd</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> <span class="comment">//最大公约数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> t;</span><br><span class="line">    <span class="keyword">while</span> (b != <span class="number">0</span>) &#123;</span><br><span class="line">        t = b;</span><br><span class="line">        b = a % b;</span><br><span class="line">        a = t;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">lcm</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> <span class="comment">//最小公倍数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a * b / <span class="built_in">gcd</span>(a, b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">gauss</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> k, col = <span class="number">0</span>; <span class="comment">//当前处理的列</span></span><br><span class="line">    <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; equ &amp;&amp; col &lt; var; ++k, ++col) &#123;</span><br><span class="line">        <span class="type">int</span> max_r = k;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = k + <span class="number">1</span>; i &lt; equ; ++i)</span><br><span class="line">            <span class="keyword">if</span> (a[i][col] &gt; a[max_r][col])</span><br><span class="line">                max_r = i;</span><br><span class="line">        <span class="keyword">if</span> (max_r != k) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = k; i &lt; var + <span class="number">1</span>; ++i)</span><br><span class="line">                <span class="built_in">swap</span>(a[k][i], a[max_r][i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (a[k][col] == <span class="number">0</span>) &#123;</span><br><span class="line">            k--;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = k + <span class="number">1</span>; i &lt; equ; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (a[i][col] != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="type">int</span> LCM = <span class="built_in">lcm</span>(a[i][col], a[k][col]);</span><br><span class="line">                <span class="type">int</span> ta = LCM / a[i][col], tb = LCM / a[k][col];</span><br><span class="line">                <span class="keyword">if</span> (a[i][col] * a[k][col] &lt; <span class="number">0</span>)</span><br><span class="line">                    tb = -tb;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> j = col; j &lt; var + <span class="number">1</span>; ++j)</span><br><span class="line">                    a[i][j] = ((a[i][j] * ta) % <span class="number">2</span> - (a[k][j] * tb) % <span class="number">2</span> + <span class="number">2</span>) % <span class="number">2</span>; <span class="comment">//a[i][j]只有0和1两种状态</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = k; i &lt; equ; ++i)<span class="comment">//注意 k 的值，k 代表系数矩阵值都为 0 的那些行的第 1 行</span></span><br><span class="line">        <span class="keyword">if</span> (a[i][col]) <span class="keyword">return</span> <span class="number">-1</span>; <span class="comment">// 无解返回 -1</span></span><br><span class="line">    <span class="comment">//唯一解或者无穷解,k&lt;=var</span></span><br><span class="line">    <span class="comment">//var-k==0 唯一解；var-k&gt;0 无穷多解，自由解的个数=var-k</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; equ; ++i)<span class="comment">//每一行主元素化为非零</span></span><br><span class="line">        <span class="keyword">if</span> (!a[i][i]) &#123;</span><br><span class="line">            <span class="type">int</span> j;</span><br><span class="line">            <span class="keyword">for</span> (j = i + <span class="number">1</span>; j &lt; var; ++j)</span><br><span class="line">                <span class="keyword">if</span> (a[i][j])</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">if</span> (j == var)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; equ; ++k)</span><br><span class="line">                <span class="built_in">swap</span>(a[k][i], a[k][j]);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">// free_num=k;</span></span><br><span class="line">    <span class="keyword">if</span> (var - k &gt; <span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">//无穷多解，先枚举解，然后用下面的回带代码进行回带；</span></span><br><span class="line"><span class="comment">//这里省略了下面的回带的代码；不管唯一解和无穷解都可以回带，只不过无穷解回带时，默认为最后几个自由变元=0 而已。</span></span><br><span class="line">        <span class="keyword">return</span> var - k;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (var - k == <span class="number">0</span>)<span class="comment">//唯一解时</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//下面是回带求解代码，当无穷多解时，最后几行为 0 的解默认为 0；</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = k - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) <span class="comment">//从消完元矩阵的主对角线非 0 的最后 1 行，开始往回带</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> tmp = a[i][var] % <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = i + <span class="number">1</span>; j &lt; var; ++j) <span class="comment">//x[i]取决于 x[i+1]--x[var]啊，所以后面的解对前面的解有影响</span></span><br><span class="line">                <span class="keyword">if</span> (a[i][j] != <span class="number">0</span>)</span><br><span class="line">                    tmp = (tmp - (a[i][j] * x[j]) % <span class="number">2</span> + <span class="number">2</span>) % <span class="number">2</span>;</span><br><span class="line">            <span class="comment">//if (a[i][i]==0) x[i]=tmp; //最后的空行时，即无穷解得</span></span><br><span class="line">            <span class="comment">//else</span></span><br><span class="line">            x[i] = (tmp / a[i][i]) % <span class="number">2</span>; <span class="comment">//上面的正常解</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="高斯消元解模线性方程组"><a href="#高斯消元解模线性方程组" class="headerlink" title="高斯消元解模线性方程组"></a>高斯消元解模线性方程组</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a[N][N];<span class="comment">//增广矩阵</span></span><br><span class="line"><span class="type">int</span> x[N];<span class="comment">//解集</span></span><br><span class="line"><span class="type">bool</span> freeX[N];<span class="comment">//标记是否为自由变元</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">GCD</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123; <span class="keyword">return</span> !b ? a : <span class="built_in">GCD</span>(b, a % b); &#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">LCM</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123; <span class="keyword">return</span> a / <span class="built_in">GCD</span>(a, b) * b; &#125;</span><br><span class="line"><span class="type">int</span> equ, var;<span class="comment">//方程数和变量数</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">gauss</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= var; i++) &#123;</span><br><span class="line">        x[i] = <span class="number">0</span>;</span><br><span class="line">        freeX[i] = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> col = <span class="number">0</span>; <span class="comment">//当前处理的列</span></span><br><span class="line">    <span class="type">int</span> row;<span class="comment">//当前处理的行</span></span><br><span class="line">    <span class="keyword">for</span> (row = <span class="number">0</span>; row &lt; equ &amp;&amp; col &lt; var; row++, col++) &#123; <span class="comment">//枚举当前处理的行</span></span><br><span class="line">        <span class="type">int</span> maxRow = row; <span class="comment">//当前列绝对值最大的行</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = row + <span class="number">1</span>; i &lt; equ; i++) <span class="comment">//寻找当前列绝对值最大的行</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">abs</span>(a[i][col]) &gt; <span class="built_in">abs</span>(a[maxRow][col]))</span><br><span class="line">                maxRow = i;</span><br><span class="line">        <span class="keyword">if</span> (maxRow != row) <span class="comment">//与第row行交换</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = row; j &lt; var + <span class="number">1</span>; j++)</span><br><span class="line">                <span class="built_in">swap</span>(a[row][j], a[maxRow][j]);</span><br><span class="line">        <span class="keyword">if</span> (a[row][col] == <span class="number">0</span>) &#123; <span class="comment">//col列第row行以下全是0，处理当前行的下一列</span></span><br><span class="line">            row--;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = row + <span class="number">1</span>; i &lt; equ; i++) <span class="comment">//枚举要删去的行</span></span><br><span class="line">            <span class="keyword">if</span> (a[i][col] != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="type">int</span> lcm = <span class="built_in">LCM</span>(<span class="built_in">abs</span>(a[i][col]), <span class="built_in">abs</span>(a[row][col]));</span><br><span class="line">                <span class="type">int</span> ta = lcm / <span class="built_in">abs</span>(a[i][col]);</span><br><span class="line">                <span class="type">int</span> tb = lcm / <span class="built_in">abs</span>(a[row][col]);</span><br><span class="line">                <span class="keyword">if</span> (a[i][col] * a[row][col] &lt; <span class="number">0</span>) <span class="comment">//异号情况相加</span></span><br><span class="line">                    tb = -tb;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> j = col; j &lt; var + <span class="number">1</span>; j++)</span><br><span class="line">                    a[i][j] = ((a[i][j] * ta - a[row][j] * tb) % MOD + MOD) % MOD;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = row; i &lt; equ; i++)</span><br><span class="line">        <span class="keyword">if</span> (a[i][col])</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;<span class="comment">//无解</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//无穷解: 在var*(var+1)的增广阵中出现(0,0,...,0)这样的行</span></span><br><span class="line">    <span class="keyword">if</span> (row &lt; var) <span class="comment">//返回自由变元数</span></span><br><span class="line">        <span class="keyword">return</span> var - row;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = var - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="type">int</span> temp = a[i][var];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = i + <span class="number">1</span>; j &lt; var; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (a[i][j] != <span class="number">0</span>)</span><br><span class="line">                temp -= a[i][j] * x[j];</span><br><span class="line">            temp = (temp % MOD + MOD) % MOD; <span class="comment">//取模</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (temp % a[i][i] != <span class="number">0</span>)</span><br><span class="line">            <span class="comment">//外层每次循环都是求a[i][i]，它是每个方程中唯一一个未知的变量</span></span><br><span class="line">            temp += MOD; <span class="comment">//a[i][i]必须为整数，加上周期MOD</span></span><br><span class="line">        x[i] = (temp / a[i][i]) % MOD; <span class="comment">//取模</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Debug"><a href="#Debug" class="headerlink" title="Debug"></a>Debug</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Debug</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; equ; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; var + <span class="number">1</span>; j++)</span><br><span class="line">            cout &lt;&lt; a[i][j] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">        cout &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="高斯消元求行列式"><a href="#高斯消元求行列式" class="headerlink" title="高斯消元求行列式"></a>高斯消元求行列式</h3><h4 id="应用：矩阵树定理"><a href="#应用：矩阵树定理" class="headerlink" title="应用：矩阵树定理"></a>应用：矩阵树定理</h4><p>定义矩阵D，大小为n*n，其中$ d_{i,j}&#x3D; \begin{cases} 0,&amp;\text{i !&#x3D; j} \点i的度,&amp;\text{i&#x3D;&#x3D;j} \end{cases} $</p>
<p>定义矩阵A，为图G的邻接矩阵</p>
<p>定义矩阵C，$ C &#x3D; D-A$</p>
<p>那么G的所有不同生成树的个数等于矩阵C的任意一个 n - 1 阶主子式的行列式的绝对值，其中 n - 1 阶主子式为去掉C中第 i 行以及第 i 列得到的行列式</p>
<p>注意去掉最后一行最后一列变成 n - 1阶主子式，即 n–</p>
<h5 id="First（模数允许计算逆元）"><a href="#First（模数允许计算逆元）" class="headerlink" title="First（模数允许计算逆元）"></a>First（模数允许计算逆元）</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> a[N][N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ksm</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (b) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>) ans = ans * a % c;</span><br><span class="line">        b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">        a = a * a % c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Gauss</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = i + <span class="number">1</span>; j &lt;= n; j++)</span><br><span class="line">            <span class="keyword">if</span> (!a[i][i] &amp;&amp; a[j][i]) &#123;</span><br><span class="line">                ans = -ans;</span><br><span class="line">                <span class="built_in">swap</span>(a[i], a[j]);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="type">int</span> inv = <span class="built_in">ksm</span>(a[i][i], MOD - <span class="number">2</span>, MOD);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = i + <span class="number">1</span>; j &lt;= n; j++) &#123;</span><br><span class="line">            <span class="type">int</span> temp = a[j][i] * inv;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = i; k &lt;= n; k++)</span><br><span class="line">                a[j][k] = a[j][k] - a[i][k] * temp;</span><br><span class="line">        &#125;</span><br><span class="line">        ans = ans * a[i][i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="Second（模数不允许计算逆元）"><a href="#Second（模数不允许计算逆元）" class="headerlink" title="Second（模数不允许计算逆元）"></a>Second（模数不允许计算逆元）</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a[N][N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">gauss</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = i + <span class="number">1</span>; j &lt;= n; ++j) &#123;</span><br><span class="line">            <span class="keyword">while</span> (a[j][i]) &#123;</span><br><span class="line">                <span class="comment">//辗转相除</span></span><br><span class="line">                <span class="type">int</span> t = a[i][i] / a[j][i];</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> k = i; k &lt;= n; ++k) &#123;</span><br><span class="line">                    a[i][k] -= (a[j][k] * t) % MOD;</span><br><span class="line">                    a[i][k] = (a[i][k] % MOD + MOD) % MOD;</span><br><span class="line">                    <span class="built_in">swap</span>(a[i][k], a[j][k]);</span><br><span class="line">                &#125;</span><br><span class="line">                ans *= <span class="number">-1</span>;</span><br><span class="line">                <span class="comment">//行列式交换行</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (a[i][i] == <span class="number">0</span>)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        ans = (ans * a[i][i]) % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (ans % MOD + MOD) % MOD;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="pell方程"><a href="#pell方程" class="headerlink" title="pell方程"></a>pell方程</h2><p>设pell方程的最小正整数解 $ x_1 ,y_1$ 已知，那么可以构造出 $ \left{\begin{matrix}x_1 \ y_1\end{matrix}\right} $ $ \left { \begin{matrix} x_1 &amp; dy_1 \ y_1 &amp;x_1\end{matrix}\right} ^{n-1} $ &#x3D; $ \left { \begin{matrix} x_n \ y_n \end{matrix} \right} $</p>
<h3 id="暴力法求最小解"><a href="#暴力法求最小解" class="headerlink" title="暴力法求最小解"></a>暴力法求最小解</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">pell</span><span class="params">(<span class="type">int</span> &amp;a, <span class="type">int</span> &amp;b, <span class="type">int</span> d)</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//暴力寻找pell方程最小解</span></span><br><span class="line">    b = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        a = (<span class="type">int</span>) <span class="built_in">sqrt</span>(d * b * b + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (a * a - d * b * b == <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        b++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	int d;</span></span><br><span class="line"><span class="comment">    cin &gt;&gt; d;</span></span><br><span class="line"><span class="comment">    int m = (int) sqrt((double) d);</span></span><br><span class="line"><span class="comment">    if (m * m == d) &#123;//d不能为完全平方数</span></span><br><span class="line"><span class="comment">        cout &lt;&lt; &quot;No Solution&quot; &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">        return;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    int a = 0, b = 0;</span></span><br><span class="line"><span class="comment">    pell(a, b, d);//暴力找到最小解</span></span><br><span class="line"><span class="comment">    cout &lt;&lt; a &lt;&lt; &quot; &quot; &lt;&lt; b &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h3 id="连分数法求解"><a href="#连分数法求解" class="headerlink" title="连分数法求解"></a>连分数法求解</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a[<span class="number">200005</span>];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">pell</span><span class="params">(<span class="type">int</span> &amp;x, <span class="type">int</span> &amp;y, <span class="type">int</span> d)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> m = (<span class="type">int</span>) <span class="built_in">sqrt</span>((<span class="type">double</span>) d);</span><br><span class="line">    <span class="keyword">if</span> (m * m == d)<span class="comment">//d不能为完全平方数</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将d以连分数形式存储</span></span><br><span class="line">    <span class="type">int</span> num = <span class="number">0</span>;<span class="comment">//连分数数位</span></span><br><span class="line">    <span class="type">double</span> sq = <span class="built_in">sqrt</span>(d);<span class="comment">//d的高精度根，相当于r0</span></span><br><span class="line">    a[num++] = m;<span class="comment">//存储整数部分</span></span><br><span class="line">    <span class="type">int</span> b = m;<span class="comment">//当前整数部分</span></span><br><span class="line">    <span class="type">int</span> c = <span class="number">1</span>;<span class="comment">//连分数最终展开时的分母</span></span><br><span class="line">    <span class="type">double</span> temp;<span class="comment">//连分数展开时的每一项</span></span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        c = (d - b * b) / c;</span><br><span class="line">        temp = (sq + b) / c;</span><br><span class="line">        a[num++] = (<span class="type">int</span>) (<span class="built_in">double</span> (temp));</span><br><span class="line">        b = a[num - <span class="number">1</span>] * c - b;</span><br><span class="line">    &#125; <span class="keyword">while</span> (a[num - <span class="number">1</span>] != <span class="number">2</span> * a[<span class="number">0</span>]);<span class="comment">//当有一位等于整数两倍时结束</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//将连分数形式化为分子分母形式，即求p、q两个值</span></span><br><span class="line">    <span class="type">int</span> p = <span class="number">1</span>, q = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = num - <span class="number">2</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="type">int</span> temp = p;</span><br><span class="line">        p = q + p * a[i];</span><br><span class="line">        q = temp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((num - <span class="number">1</span>) % <span class="number">2</span>) &#123;<span class="comment">//连分数长度为奇数时</span></span><br><span class="line">        x = <span class="number">2</span> * p * p + <span class="number">1</span>;</span><br><span class="line">        y = <span class="number">2</span> * p * q;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;<span class="comment">//连分数长度为偶数时</span></span><br><span class="line">        x = p;</span><br><span class="line">        y = q;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="迭代公式求前n个解"><a href="#迭代公式求前n个解" class="headerlink" title="迭代公式求前n个解"></a>迭代公式求前n个解</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x[<span class="number">1</span>] = a, y[<span class="number">1</span>] = b;<span class="comment">//第一组解</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++) &#123;<span class="comment">//递推公式</span></span><br><span class="line">    x[i] = x[i - <span class="number">1</span>] * x[<span class="number">1</span>] + d * y[i - <span class="number">1</span>] * y[<span class="number">1</span>];</span><br><span class="line">    y[i] = x[i - <span class="number">1</span>] * y[<span class="number">1</span>] + y[i - <span class="number">1</span>] * x[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="插值"><a href="#插值" class="headerlink" title="插值"></a>插值</h2><h3 id="拉格朗日插值"><a href="#拉格朗日插值" class="headerlink" title="拉格朗日插值"></a>拉格朗日插值</h3><p>给定n个点坐标，求f(k)的值</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n, m, k;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">  <span class="type">int</span> x, y;</span><br><span class="line">&#125; A[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">inv</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">ksm</span>(x, MOD - <span class="number">2</span>, MOD); &#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">lagrange</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> s1 = A[i].y % MOD;</span><br><span class="line">        <span class="type">int</span> s2 = <span class="number">1ll</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i != j) &#123;</span><br><span class="line">                s1 = s1 * (k - A[j].x) % MOD;</span><br><span class="line">                s2 = s2 * (A[i].x - A[j].x) % MOD;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ans += s1 * <span class="built_in">inv</span>(s2) % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (ans % MOD + MOD) % MOD;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="拉格朗日插值公式"><a href="#拉格朗日插值公式" class="headerlink" title="拉格朗日插值公式"></a>拉格朗日插值公式</h3><p>$$<br>f(x)&#x3D;\sum_{i&#x3D;1}^{n} f(x_i) \prod_{i \neq j} \frac{x-x_j}{x_i-x_J}<br>$$</p>
<h3 id="多项式卷积"><a href="#多项式卷积" class="headerlink" title="多项式卷积"></a>多项式卷积</h3><p>$$<br>f(x) &#x3D; g(x) \times h(x) &#x3D; \sum_{i&#x3D;0}^{x} g(i)h(x-i)<br>$$</p>
<p>对应系数：$f_k&#x3D;\sum_{i+j&#x3D;k}g_ih_j&#x3D;\sum_{i&#x3D;0}^{k}a_ib_{k-i}$</p>
<h2 id="多项式"><a href="#多项式" class="headerlink" title="多项式"></a>多项式</h2><h3 id="FFT"><a href="#FFT" class="headerlink" title="FFT"></a>FFT</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">double</span> PI = <span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Complex</span> &#123;</span><br><span class="line">    <span class="type">double</span> x, y;    <span class="comment">//  实部和虚部 x + yi</span></span><br><span class="line">    <span class="built_in">Complex</span>(<span class="type">double</span> _x = <span class="number">0.0</span>, <span class="type">double</span> _y = <span class="number">0.0</span>)&#123; x = _x; y = _y; &#125;</span><br><span class="line">    Complex <span class="keyword">operator</span> - (<span class="type">const</span> Complex&amp; b) <span class="type">const</span> &#123; <span class="keyword">return</span> <span class="built_in">Complex</span>(x - b.x, y - b.y); &#125;</span><br><span class="line">    Complex <span class="keyword">operator</span> + (<span class="type">const</span> Complex&amp; b) <span class="type">const</span> &#123; <span class="keyword">return</span> <span class="built_in">Complex</span>(x + b.x, y + b.y); &#125;</span><br><span class="line">    Complex <span class="keyword">operator</span> * (<span class="type">const</span> Complex&amp; b) <span class="type">const</span> &#123; <span class="keyword">return</span> <span class="built_in">Complex</span>(x * b.x - y * b.y, x * b.y + y * b.x); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//  进行FFT和IFFT前的反转变换</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">change</span><span class="params">(Complex y[], <span class="type">int</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> i, j, k;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>, j = len / <span class="number">2</span>; i &lt; len - <span class="number">1</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; j) &#123;</span><br><span class="line">            <span class="built_in">swap</span>(y[i], y[j]);</span><br><span class="line">        &#125;</span><br><span class="line">        k = len / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">while</span> (j &gt;= k) &#123;</span><br><span class="line">            j -= k;</span><br><span class="line">            k /= <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (j &lt; k) &#123;</span><br><span class="line">            j += k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//  FFT</span></span><br><span class="line"><span class="comment">// len必须为2^k形式，这也就导致了在主函数中进行fft前需要使用while (len &lt; m + n + 1) len &lt;&lt;= 1;而在输出结果时需要len = m + n + 1;更改为正确的数值</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fft</span><span class="params">(Complex y[], <span class="type">int</span> len, <span class="type">int</span> on)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">change</span>(y, len);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="function">Complex <span class="title">wn</span><span class="params">(cos(-on * <span class="number">2</span> * PI / h), sin(-on * <span class="number">2</span> * PI / h))</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">            <span class="function">Complex <span class="title">w</span><span class="params">(<span class="number">1</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = j; k &lt; j + h / <span class="number">2</span>; k++) &#123;</span><br><span class="line">                Complex u = y[k];</span><br><span class="line">                Complex t = w * y[k + h / <span class="number">2</span>];</span><br><span class="line">                y[k] = u + t;</span><br><span class="line">                y[k + h / <span class="number">2</span>] = u - t;</span><br><span class="line">                w = w * wn;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            y[i].x /= len;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="NTT"><a href="#NTT" class="headerlink" title="NTT"></a>NTT</h3><p>NTT使用了特殊模数代替了FFT中浮点的使用</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//一个n项和一个m项求卷积</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> LL;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> p = <span class="number">998244353</span>, G = <span class="number">3</span>, Gi = <span class="number">332748118</span>;<span class="comment">//这里的Gi是G的除法逆元</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">5000007</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> PI = <span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> res, ans[N];</span><br><span class="line"><span class="type">int</span> len = <span class="number">1</span>;<span class="comment">//</span></span><br><span class="line"><span class="type">int</span> L;<span class="comment">//二进制的位数</span></span><br><span class="line"><span class="type">int</span> RR[N];</span><br><span class="line">LL a[N], b[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">qread</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    <span class="type">int</span> x = <span class="number">0</span>, y = <span class="number">1</span>;</span><br><span class="line">    <span class="type">char</span> c = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">while</span> (c &lt; <span class="string">&#x27;0&#x27;</span> || c &gt; <span class="string">&#x27;9&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (c == <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">            y = <span class="number">-1</span>;</span><br><span class="line">        c = <span class="built_in">getchar</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (c &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; c &lt;= <span class="string">&#x27;9&#x27;</span>) &#123;</span><br><span class="line">        x = x * <span class="number">10</span> + c - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        c = <span class="built_in">getchar</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> x * y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">LL <span class="title">ksm</span><span class="params">(LL a, LL b, LL p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    LL ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (b) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>) ans = ans * a % p;</span><br><span class="line">        b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">        a = a * a % p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">LL <span class="title">inv</span><span class="params">(LL x)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">ksm</span>(x, p - <span class="number">2</span>, p); &#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">NTT</span><span class="params">(LL* A, <span class="type">int</span> type)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        <span class="keyword">if</span> (i &lt; RR[i])</span><br><span class="line">            <span class="built_in">swap</span>(A[i], A[RR[i]]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> mid = <span class="number">1</span>; mid &lt; len; mid &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        LL wn = <span class="built_in">ksm</span>(G, (p - <span class="number">1</span>) / (mid * <span class="number">2</span>), p);</span><br><span class="line">        <span class="keyword">if</span> (type == <span class="number">-1</span>) wn = <span class="built_in">ksm</span>(wn, p - <span class="number">2</span>, p);</span><br><span class="line">        <span class="comment">//如果超时了上面if这句话删掉，在下面的if(type == -1)里加上下面这个循环</span></span><br><span class="line">        <span class="comment">/*for (int i = 1; i &lt; len / 2; i ++)</span></span><br><span class="line"><span class="comment">        swap(A[i], A[len - i]); */</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = mid &lt;&lt; <span class="number">1</span>, pos = <span class="number">0</span>; pos &lt; len; pos += j) &#123;</span><br><span class="line">            LL w = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; mid; ++k, w = (w * wn) % p) &#123;</span><br><span class="line">                <span class="type">int</span> x = A[pos + k], y = w * A[pos + mid + k] % p;</span><br><span class="line">                A[pos + k] = (x + y) % p;</span><br><span class="line">                A[pos + k + mid] = (x - y + p) % p;</span><br><span class="line"> </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (type == <span class="number">-1</span>) &#123;</span><br><span class="line">        LL limit_inv = <span class="built_in">inv</span>(len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            A[i] = (A[i] * limit_inv) % p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//多项式乘法</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">poly_mul</span><span class="params">(LL* a, LL* b, <span class="type">int</span> deg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (len = <span class="number">1</span>, L = <span class="number">0</span>; len &lt;= deg; len &lt;&lt;= <span class="number">1</span>) L++;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">        RR[i] = (RR[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>) | ((i &amp; <span class="number">1</span>) &lt;&lt; (L - <span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NTT</span>(a, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">NTT</span>(b, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i) a[i] = a[i] * b[i] % p;</span><br><span class="line">    <span class="built_in">NTT</span>(a, <span class="number">-1</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    n = <span class="built_in">qread</span>(), m = <span class="built_in">qread</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n; ++i) a[i] = (<span class="built_in">qread</span>() + p) % p;<span class="comment">//取模</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; ++i) b[i] = (<span class="built_in">qread</span>() + p) % p;</span><br><span class="line">    <span class="built_in">poly_mul</span>(a, b, n + m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n + m; ++i)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, a[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="FWT"><a href="#FWT" class="headerlink" title="FWT"></a>FWT</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//给定长度为2^n的两个序列分别求or,and,xor的结果</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">50007</span>, P = <span class="number">998244353</span>;</span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span>&amp; x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    (x += y) &gt;= P &amp;&amp; (x -= P);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">sub</span><span class="params">(<span class="type">int</span>&amp; x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    (x -= y) &lt; <span class="number">0</span> &amp;&amp; (x += P);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FWT</span> &#123;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">extend</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> N = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (; N &lt; n; N &lt;&lt;= <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> N;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">FWTor</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; a, <span class="type">bool</span> rev)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = a.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">2</span>, m = <span class="number">1</span>; l &lt;= n; l &lt;&lt;= <span class="number">1</span>, m &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j += l) <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!rev) <span class="built_in">add</span>(a[i + j + m], a[i + j]);</span><br><span class="line">                <span class="keyword">else</span> <span class="built_in">sub</span>(a[i + j + m], a[i + j]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">FWTand</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; a, <span class="type">bool</span> rev)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = a.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">2</span>, m = <span class="number">1</span>; l &lt;= n; l &lt;&lt;= <span class="number">1</span>, m &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j += l) <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!rev) <span class="built_in">add</span>(a[i + j], a[i + j + m]);</span><br><span class="line">                <span class="keyword">else</span> <span class="built_in">sub</span>(a[i + j], a[i + j + m]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">FWTxor</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; a, <span class="type">bool</span> rev)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = a.<span class="built_in">size</span>(), inv2 = (P + <span class="number">1</span>) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">2</span>, m = <span class="number">1</span>; l &lt;= n; l &lt;&lt;= <span class="number">1</span>, m &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j += l) <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">                <span class="type">int</span> x = a[i + j], y = a[i + j + m];</span><br><span class="line">                <span class="keyword">if</span> (!rev) &#123;</span><br><span class="line">                    a[i + j] = (x + y) % P;</span><br><span class="line">                    a[i + j + m] = (x - y + P) % P;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    a[i + j] = <span class="number">1LL</span> * (x + y) * inv2 % P;</span><br><span class="line">                    a[i + j + m] = <span class="number">1LL</span> * (x - y + P) * inv2 % P;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">Or</span><span class="params">(vector&lt;<span class="type">int</span>&gt; a1, vector&lt;<span class="type">int</span>&gt; a2)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = <span class="built_in">max</span>(a<span class="number">1.</span><span class="built_in">size</span>(), a<span class="number">2.</span><span class="built_in">size</span>()), N = <span class="built_in">extend</span>(n);</span><br><span class="line">        a<span class="number">1.</span><span class="built_in">resize</span>(N), <span class="built_in">FWTor</span>(a1, <span class="literal">false</span>);</span><br><span class="line">        a<span class="number">2.</span><span class="built_in">resize</span>(N), <span class="built_in">FWTor</span>(a2, <span class="literal">false</span>);</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">A</span><span class="params">(N)</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; i++) A[i] = <span class="number">1LL</span> * a1[i] * a2[i] % P;</span><br><span class="line">        <span class="built_in">FWTor</span>(A, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> A;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">And</span><span class="params">(vector&lt;<span class="type">int</span>&gt; a1, vector&lt;<span class="type">int</span>&gt; a2)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = <span class="built_in">max</span>(a<span class="number">1.</span><span class="built_in">size</span>(), a<span class="number">2.</span><span class="built_in">size</span>()), N = <span class="built_in">extend</span>(n);</span><br><span class="line">        a<span class="number">1.</span><span class="built_in">resize</span>(N), <span class="built_in">FWTand</span>(a1, <span class="literal">false</span>);</span><br><span class="line">        a<span class="number">2.</span><span class="built_in">resize</span>(N), <span class="built_in">FWTand</span>(a2, <span class="literal">false</span>);</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">A</span><span class="params">(N)</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; i++) A[i] = <span class="number">1LL</span> * a1[i] * a2[i] % P;</span><br><span class="line">        <span class="built_in">FWTand</span>(A, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> A;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">Xor</span><span class="params">(vector&lt;<span class="type">int</span>&gt; a1, vector&lt;<span class="type">int</span>&gt; a2)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = <span class="built_in">max</span>(a<span class="number">1.</span><span class="built_in">size</span>(), a<span class="number">2.</span><span class="built_in">size</span>()), N = <span class="built_in">extend</span>(n);</span><br><span class="line">        a<span class="number">1.</span><span class="built_in">resize</span>(N), <span class="built_in">FWTxor</span>(a1, <span class="literal">false</span>);</span><br><span class="line">        a<span class="number">2.</span><span class="built_in">resize</span>(N), <span class="built_in">FWTxor</span>(a2, <span class="literal">false</span>);</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">A</span><span class="params">(N)</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; i++) A[i] = <span class="number">1LL</span> * a1[i] * a2[i] % P;</span><br><span class="line">        <span class="built_in">FWTxor</span>(A, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> A;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; fwt;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;m);</span><br><span class="line">    n = <span class="number">1</span> &lt;&lt; m;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">a1</span><span class="params">(n)</span>, <span class="title">a2</span><span class="params">(n)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;a1[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;a2[i]);</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; A;</span><br><span class="line">    A = fwt.<span class="built_in">Or</span>(a1, a2);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d%c&quot;</span>, A[i], <span class="string">&quot; \n&quot;</span>[i == n - <span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    A = fwt.<span class="built_in">And</span>(a1, a2);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d%c&quot;</span>, A[i], <span class="string">&quot; \n&quot;</span>[i == n - <span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    A = fwt.<span class="built_in">Xor</span>(a1, a2);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d%c&quot;</span>, A[i], <span class="string">&quot; \n&quot;</span>[i == n - <span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="多项式大全"><a href="#多项式大全" class="headerlink" title="多项式大全"></a>多项式大全</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//#pragma GCC optimize(2)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">3000007</span>;<span class="comment">//N的大小要根据初始化决定，否则造成越界</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> p = <span class="number">998244353</span>, gg = <span class="number">3</span>, ig = <span class="number">332738118</span>, img = <span class="number">86583718</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> mod = <span class="number">998244353</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;<span class="function"><span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> f = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">register</span> <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch &lt; <span class="string">&#x27;0&#x27;</span> || ch &gt; <span class="string">&#x27;9&#x27;</span>) &#123;<span class="keyword">if</span>(ch == <span class="string">&#x27;-&#x27;</span>)f = <span class="number">-1</span>;ch = <span class="built_in">getchar</span>();&#125;</span><br><span class="line">    <span class="keyword">while</span>(ch &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; ch &lt;= <span class="string">&#x27;9&#x27;</span>) &#123;x = x * <span class="number">10</span> + ch - <span class="string">&#x27;0&#x27;</span>;ch = <span class="built_in">getchar</span>();&#125;</span><br><span class="line">    x *= f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qpow</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> res = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(b) &#123;</span><br><span class="line">        <span class="keyword">if</span>(b &amp; <span class="number">1</span>) res = <span class="number">1ll</span> * res * a % mod;</span><br><span class="line">        a = <span class="number">1ll</span> * a * a % mod;</span><br><span class="line">        b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Poly</span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> mul(x, y) (1ll * x * y &gt;= mod ? 1ll * x * y % mod : 1ll * x * y)</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> minus(x, y) (1ll * x - y &lt; 0 ? 1ll * x - y + mod : 1ll * x - y)</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> plus(x, y) (1ll * x + y &gt;= mod ? 1ll * x + y - mod : 1ll * x + y)</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> ck(x) (x &gt;= mod ? x - mod : x)<span class="comment">//取模运算太慢了</span></span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">typedef</span> vector&lt;<span class="type">int</span>&gt; poly;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> G = <span class="number">3</span>;<span class="comment">//根据具体的模数而定，原根可不一定不一样！！！</span></span><br><span class="line">    <span class="comment">//一般模数的原根为 2 3 5 7 10 6</span></span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> inv_G = <span class="built_in">qpow</span>(G, mod - <span class="number">2</span>);</span><br><span class="line">    <span class="type">int</span> RR[N], deer[<span class="number">2</span>][<span class="number">19</span>][N], inv[N];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">const</span> <span class="type">int</span> t)</span> </span>&#123;<span class="comment">//预处理出来NTT里需要的w和wn，砍掉了一个log的时间</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> p = <span class="number">1</span>; p &lt;= t; ++ p) &#123;</span><br><span class="line">            <span class="type">int</span> buf1 = <span class="built_in">qpow</span>(G, (mod - <span class="number">1</span>) / (<span class="number">1</span> &lt;&lt; p));</span><br><span class="line">            <span class="type">int</span> buf0 = <span class="built_in">qpow</span>(inv_G, (mod - <span class="number">1</span>) / (<span class="number">1</span> &lt;&lt; p));</span><br><span class="line">            deer[<span class="number">0</span>][p][<span class="number">0</span>] = deer[<span class="number">1</span>][p][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; (<span class="number">1</span> &lt;&lt; p); ++ i) &#123;</span><br><span class="line">                deer[<span class="number">0</span>][p][i] = <span class="number">1ll</span> * deer[<span class="number">0</span>][p][i - <span class="number">1</span>] * buf0 % mod;<span class="comment">//逆</span></span><br><span class="line">                deer[<span class="number">1</span>][p][i] = <span class="number">1ll</span> * deer[<span class="number">1</span>][p][i - <span class="number">1</span>] * buf1 % mod;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        inv[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i &lt;= (<span class="number">1</span> &lt;&lt; t); ++ i)</span><br><span class="line">            inv[i] = <span class="number">1ll</span> * inv[mod % i] * (mod - mod / i) % mod;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">NTT_init</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;<span class="comment">//快速数论变换预处理</span></span><br><span class="line">        <span class="type">int</span> limit = <span class="number">1</span>, L = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(limit &lt;= n) limit &lt;&lt;= <span class="number">1</span>, L ++ ;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; limit; ++ i)</span><br><span class="line">            RR[i] = (RR[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>) | ((i &amp; <span class="number">1</span>) &lt;&lt; (L - <span class="number">1</span>));</span><br><span class="line">        <span class="keyword">return</span> limit;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">NTT</span><span class="params">(poly &amp;A, <span class="type">int</span> type, <span class="type">int</span> limit)</span> </span>&#123;<span class="comment">//快速数论变换</span></span><br><span class="line">        A.<span class="built_in">resize</span>(limit);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; limit; ++ i)</span><br><span class="line">            <span class="keyword">if</span>(i &lt; RR[i])</span><br><span class="line">                <span class="built_in">swap</span>(A[i], A[RR[i]]);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> mid = <span class="number">2</span>, j = <span class="number">1</span>; mid &lt;= limit; mid &lt;&lt;= <span class="number">1</span>, ++ j) &#123;</span><br><span class="line">            <span class="type">int</span> len = mid &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> pos = <span class="number">0</span>; pos &lt; limit; pos += mid) &#123;</span><br><span class="line">                <span class="type">int</span> *wn = deer[type][j];</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> i = pos; i &lt; pos + len; ++ i, ++ wn) &#123;</span><br><span class="line">                    <span class="type">int</span> tmp = <span class="number">1ll</span> * (*wn) * A[i + len] % mod;</span><br><span class="line">                    A[i + len] = <span class="built_in">ck</span>(A[i] - tmp + mod);</span><br><span class="line">                    A[i] = <span class="built_in">ck</span>(A[i] + tmp);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(type == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; limit; ++ i)</span><br><span class="line">                A[i] = <span class="number">1ll</span> * A[i] * inv[limit] % mod;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">poly <span class="title">poly_mul</span><span class="params">(poly A, poly B)</span> </span>&#123;<span class="comment">//多项式乘法</span></span><br><span class="line">        <span class="type">int</span> deg = A.<span class="built_in">size</span>() + B.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> limit = <span class="built_in">NTT_init</span>(deg);</span><br><span class="line">        <span class="function">poly <span class="title">C</span><span class="params">(limit)</span></span>;</span><br><span class="line">        <span class="built_in">NTT</span>(A, <span class="number">1</span>, limit);</span><br><span class="line">        <span class="built_in">NTT</span>(B, <span class="number">1</span>, limit);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; limit; ++ i)</span><br><span class="line">            C[i] = <span class="number">1ll</span> * A[i] * B[i] % mod;</span><br><span class="line">        <span class="built_in">NTT</span>(C, <span class="number">0</span>, limit);</span><br><span class="line">        C.<span class="built_in">resize</span>(deg);</span><br><span class="line">        <span class="keyword">return</span> C;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">poly <span class="title">poly_inv</span><span class="params">(poly &amp;f, <span class="type">int</span> deg)</span> </span>&#123;<span class="comment">//多项式求逆</span></span><br><span class="line">        <span class="keyword">if</span>(deg == <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">poly</span>(<span class="number">1</span>, <span class="built_in">qpow</span>(f[<span class="number">0</span>], mod - <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">        <span class="function">poly <span class="title">A</span><span class="params">(f.begin(), f.begin() + deg)</span></span>;</span><br><span class="line">        poly B = <span class="built_in">poly_inv</span>(f, (deg + <span class="number">1</span>) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">        <span class="type">int</span> limit = <span class="built_in">NTT_init</span>(deg &lt;&lt; <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">NTT</span>(A, <span class="number">1</span>, limit), <span class="built_in">NTT</span>(B, <span class="number">1</span>, limit);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; limit; ++ i)</span><br><span class="line">            A[i] = B[i] * (<span class="number">2</span> - <span class="number">1ll</span> * A[i] * B[i] % mod + mod) % mod;</span><br><span class="line">        <span class="built_in">NTT</span>(A, <span class="number">0</span>, limit);</span><br><span class="line">        A.<span class="built_in">resize</span>(deg);</span><br><span class="line">        <span class="keyword">return</span> A;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">poly <span class="title">poly_dev</span><span class="params">(poly f)</span> </span>&#123;<span class="comment">//多项式求导</span></span><br><span class="line">        <span class="type">int</span> n = f.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; ++ i) f[i - <span class="number">1</span>] = <span class="number">1ll</span> * f[i] * i % mod;</span><br><span class="line">        <span class="keyword">return</span> f.<span class="built_in">resize</span>(n - <span class="number">1</span>), f;<span class="comment">//f[0] = 0，这里直接扔了,从1开始</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">poly <span class="title">poly_idev</span><span class="params">(poly f)</span> </span>&#123;<span class="comment">//多项式求积分</span></span><br><span class="line">        <span class="type">int</span> n = f.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = n - <span class="number">1</span>; i ; -- i) f[i] = <span class="number">1ll</span> * f[i - <span class="number">1</span>] * inv[i] % mod;</span><br><span class="line">        <span class="keyword">return</span> f[<span class="number">0</span>] = <span class="number">0</span>, f;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">poly <span class="title">poly_ln</span><span class="params">(poly f, <span class="type">int</span> deg)</span> </span>&#123;<span class="comment">//多项式求对数</span></span><br><span class="line">        poly A = <span class="built_in">poly_idev</span>(<span class="built_in">poly_mul</span>(<span class="built_in">poly_dev</span>(f), <span class="built_in">poly_inv</span>(f, deg)));</span><br><span class="line">        <span class="keyword">return</span> A.<span class="built_in">resize</span>(deg), A;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">poly <span class="title">poly_exp</span><span class="params">(poly &amp;f, <span class="type">int</span> deg)</span> </span>&#123;<span class="comment">//多项式求指数</span></span><br><span class="line">        <span class="keyword">if</span>(deg == <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">poly</span>(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        poly B = <span class="built_in">poly_exp</span>(f, (deg + <span class="number">1</span>) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">        B.<span class="built_in">resize</span>(deg);</span><br><span class="line">        poly lnB = <span class="built_in">poly_ln</span>(B, deg);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; deg; ++ i)</span><br><span class="line">            lnB[i] = <span class="built_in">ck</span>(f[i] - lnB[i] + mod);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> limit = <span class="built_in">NTT_init</span>(deg &lt;&lt; <span class="number">1</span>);<span class="comment">//n -&gt; n^2</span></span><br><span class="line">        <span class="built_in">NTT</span>(B, <span class="number">1</span>, limit), <span class="built_in">NTT</span>(lnB, <span class="number">1</span>, limit);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; limit; ++ i)</span><br><span class="line">            B[i] = <span class="number">1ll</span> * B[i] * (<span class="number">1</span> + lnB[i]) % mod;</span><br><span class="line">        <span class="built_in">NTT</span>(B, <span class="number">0</span>, limit);</span><br><span class="line">        B.<span class="built_in">resize</span>(deg);</span><br><span class="line">        <span class="keyword">return</span> B;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">poly <span class="title">poly_sqrt</span><span class="params">(poly &amp;f, <span class="type">int</span> deg)</span> </span>&#123;<span class="comment">//多项式开方</span></span><br><span class="line">        <span class="keyword">if</span>(deg == <span class="number">1</span>) <span class="keyword">return</span> <span class="built_in">poly</span>(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="function">poly <span class="title">A</span><span class="params">(f.begin(), f.begin() + deg)</span></span>;</span><br><span class="line">        poly B = <span class="built_in">poly_sqrt</span>(f, (deg + <span class="number">1</span>) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">        poly IB = <span class="built_in">poly_inv</span>(B, deg);</span><br><span class="line">        <span class="type">int</span> limit = <span class="built_in">NTT_init</span>(deg &lt;&lt; <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">NTT</span>(A, <span class="number">1</span>, limit), <span class="built_in">NTT</span>(IB, <span class="number">1</span>, limit);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; limit; ++ i)</span><br><span class="line">            A[i] = <span class="number">1ll</span> * A[i] * IB[i] % mod;</span><br><span class="line">        <span class="built_in">NTT</span>(A, <span class="number">0</span>, limit);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i =<span class="number">0</span>; i &lt; deg; ++ i)</span><br><span class="line">            A[i] = <span class="number">1ll</span> * (A[i] + B[i]) * inv[<span class="number">2</span>] % mod;</span><br><span class="line">        A.<span class="built_in">resize</span>(deg);</span><br><span class="line">        <span class="keyword">return</span> A;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">poly <span class="title">poly_pow</span><span class="params">(poly f, <span class="type">int</span> k)</span> </span>&#123;<span class="comment">//多项式快速幂</span></span><br><span class="line">        f = <span class="built_in">poly_ln</span>(f, f.<span class="built_in">size</span>());</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;x : f) x = <span class="number">1ll</span> * x * k % mod;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">poly_exp</span>(f, f.<span class="built_in">size</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">poly <span class="title">poly_cos</span><span class="params">(poly f, <span class="type">int</span> deg)</span> </span>&#123;<span class="comment">//多项式三角函数（cos）</span></span><br><span class="line">        <span class="function">poly <span class="title">A</span><span class="params">(f.begin(), f.begin() + deg)</span></span>;</span><br><span class="line">        <span class="function">poly <span class="title">B</span><span class="params">(deg)</span>, <span class="title">C</span><span class="params">(deg)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; deg; ++ i)</span><br><span class="line">            A[i] = <span class="number">1ll</span> * A[i] * img % mod;</span><br><span class="line"></span><br><span class="line">        B = <span class="built_in">poly_exp</span>(A, deg);</span><br><span class="line">        C = <span class="built_in">poly_inv</span>(B, deg);</span><br><span class="line">        <span class="type">int</span> inv2 = <span class="built_in">qpow</span>(<span class="number">2</span>, mod - <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; deg; ++ i)</span><br><span class="line">            A[i] = <span class="number">1ll</span> * (<span class="number">1ll</span> * B[i] + C[i]) % mod * inv2 % mod;</span><br><span class="line">        <span class="keyword">return</span> A;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">poly <span class="title">poly_sin</span><span class="params">(poly f, <span class="type">int</span> deg)</span> </span>&#123;<span class="comment">//多项式三角函数（sin）</span></span><br><span class="line">        <span class="function">poly <span class="title">A</span><span class="params">(f.begin(), f.begin() + deg)</span></span>;</span><br><span class="line">        <span class="function">poly <span class="title">B</span><span class="params">(deg)</span>, <span class="title">C</span><span class="params">(deg)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; deg; ++ i)</span><br><span class="line">            A[i] = <span class="number">1ll</span> * A[i] * img % mod;</span><br><span class="line"></span><br><span class="line">        B = <span class="built_in">poly_exp</span>(A, deg);</span><br><span class="line">        C = <span class="built_in">poly_inv</span>(B, deg);</span><br><span class="line">        <span class="type">int</span> inv2i = <span class="built_in">qpow</span>(img &lt;&lt; <span class="number">1</span>, mod - <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; deg; ++ i)</span><br><span class="line">            A[i] = <span class="number">1ll</span> * (<span class="number">1ll</span> * B[i] - C[i] + mod) % mod * inv2i % mod;</span><br><span class="line">        <span class="keyword">return</span> A;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">poly <span class="title">poly_arcsin</span><span class="params">(poly f, <span class="type">int</span> deg)</span> </span>&#123;</span><br><span class="line">        <span class="function">poly <span class="title">A</span><span class="params">(f.size())</span>, <span class="title">B</span><span class="params">(f.size())</span>, <span class="title">C</span><span class="params">(f.size())</span></span>;</span><br><span class="line">        A = <span class="built_in">poly_dev</span>(f);</span><br><span class="line">        B = <span class="built_in">poly_mul</span>(f, f);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; deg; ++ i)</span><br><span class="line">            B[i] = <span class="built_in">minus</span>(mod, B[i]);</span><br><span class="line">        B[<span class="number">0</span>] = <span class="built_in">plus</span>(B[<span class="number">0</span>], <span class="number">1</span>);</span><br><span class="line">        C = <span class="built_in">poly_sqrt</span>(B, deg);</span><br><span class="line">        C = <span class="built_in">poly_inv</span>(C, deg);</span><br><span class="line">        C = <span class="built_in">poly_mul</span>(A, C);</span><br><span class="line">        C = <span class="built_in">poly_idev</span>(C);</span><br><span class="line">        <span class="keyword">return</span> C;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">poly <span class="title">poly_arctan</span><span class="params">(poly f, <span class="type">int</span> deg)</span> </span>&#123;</span><br><span class="line">        <span class="function">poly <span class="title">A</span><span class="params">(f.size())</span>, <span class="title">B</span><span class="params">(f.size())</span>, <span class="title">C</span><span class="params">(f.size())</span></span>;</span><br><span class="line">        A = <span class="built_in">poly_dev</span>(f);</span><br><span class="line">        B = <span class="built_in">poly_mul</span>(f, f);</span><br><span class="line">        B[<span class="number">0</span>] = <span class="built_in">plus</span>(B[<span class="number">0</span>], <span class="number">1</span>);</span><br><span class="line">        C = <span class="built_in">poly_inv</span>(B, deg);</span><br><span class="line">        C = <span class="built_in">poly_mul</span>(A, C);</span><br><span class="line">        C = <span class="built_in">poly_idev</span>(C);</span><br><span class="line">        <span class="keyword">return</span> C;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> Poly::poly;</span><br><span class="line"><span class="keyword">using</span> Poly::poly_arcsin;</span><br><span class="line"><span class="keyword">using</span> Poly::poly_arctan;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m, x, k, type;</span><br><span class="line">poly f, g;</span><br><span class="line"><span class="type">char</span> s[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Poly::<span class="built_in">init</span>(<span class="number">18</span>);<span class="comment">//2^21 = 2,097,152,根据题目数据多项式项数的大小自由调整，注意大小需要跟deer数组同步(21+1=22),也就是init内的数字比deer数组的第二维少1，根据题目进行调整</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(type);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++ i)</span><br><span class="line">        <span class="built_in">read</span>(x), f.<span class="built_in">push_back</span>(x);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(type == <span class="number">0</span>) g = <span class="built_in">poly_arcsin</span>(f, n);</span><br><span class="line">    <span class="keyword">else</span> g = <span class="built_in">poly_arctan</span>(f, n);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++ i)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, g[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="多项式更快"><a href="#多项式更快" class="headerlink" title="多项式更快"></a>多项式更快</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">namespace poly_base (变换基础)</span></span><br><span class="line"><span class="comment">namespace poly (多项式初等函数)</span></span><br><span class="line"><span class="comment">namespace CDQ_NTT (分治多项式技巧)</span></span><br><span class="line"><span class="comment">namespace poly_evaluation (多点求值)</span></span><br><span class="line"><span class="comment">namespace poly_interpolation (快速插值)</span></span><br><span class="line"><span class="comment">namespace linear_recur (常系数线性齐次递推式 - Fiduccia)</span></span><br><span class="line"><span class="comment">namespace linear_recur_single (常系数线性齐次递推式 - 单点)</span></span><br><span class="line"><span class="comment">namespace miscellaneous (杂项)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// This is a NEW polynomial template for C++11</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EB emplace_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> lg2 std::__lg</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> u64;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">530000</span>, mod = <span class="number">998244353</span>, iv2 = (mod + <span class="number">1</span>) / <span class="number">2</span>, unity = <span class="number">31</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">int</span> vec[N], *pvec;</span><br><span class="line"><span class="keyword">typedef</span> std::pair &lt;<span class="type">int</span>, <span class="type">int</span>&gt; pr;</span><br><span class="line"><span class="keyword">typedef</span> std::vector &lt;<span class="type">int</span>&gt; vector;</span><br><span class="line"></span><br><span class="line">vec inv, fact, finv;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">min</span><span class="params">(<span class="type">const</span> <span class="type">int</span> x, <span class="type">const</span> <span class="type">int</span> y)</span> </span>&#123;<span class="keyword">return</span> x &lt; y ? x : y;&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">max</span><span class="params">(<span class="type">const</span> <span class="type">int</span> x, <span class="type">const</span> <span class="type">int</span> y)</span> </span>&#123;<span class="keyword">return</span> x &lt; y ? y : x;&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> &amp; <span class="title">reduce</span><span class="params">(<span class="type">int</span> &amp;x)</span> </span>&#123;<span class="keyword">return</span> x += x &gt;&gt; <span class="number">31</span> &amp; mod;&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> &amp; <span class="title">neg</span><span class="params">(<span class="type">int</span> &amp;x)</span> </span>&#123;<span class="keyword">return</span> x = (!x - <span class="number">1</span>) &amp; (mod - x);&#125;</span><br><span class="line"><span class="function">u64 <span class="title">PowerMod</span><span class="params">(u64 a, <span class="type">int</span> n, u64 c = <span class="number">1</span>)</span> </span>&#123;<span class="keyword">for</span> (; n; n &gt;&gt;= <span class="number">1</span>, a = a * a % mod) <span class="keyword">if</span> (n &amp; <span class="number">1</span>) c = c * a % mod; <span class="keyword">return</span> c;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> poly_base &#123;</span><br><span class="line">	<span class="type">int</span> l, n; u64 iv; vec w2;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> n = N, <span class="type">bool</span> dont_calc_factorials = <span class="literal">true</span>)</span> </span>&#123;</span><br><span class="line">		<span class="type">int</span> i, t;</span><br><span class="line">		<span class="keyword">for</span> (inv[<span class="number">1</span>] = <span class="number">1</span>, i = <span class="number">2</span>; i &lt; n; ++i) inv[i] = <span class="built_in">u64</span>(mod - mod / i) * inv[mod % i] % mod;</span><br><span class="line">		<span class="keyword">if</span> (!dont_calc_factorials) <span class="keyword">for</span> (*finv = *fact = i = <span class="number">1</span>; i &lt; n; ++i) fact[i] = (u64)fact[i - <span class="number">1</span>] * i % mod, finv[i] = (u64)finv[i - <span class="number">1</span>] * inv[i] % mod;</span><br><span class="line">		t = <span class="built_in">min</span>(n &gt; <span class="number">1</span> ? <span class="built_in">lg2</span>(n - <span class="number">1</span>) : <span class="number">0</span>, <span class="number">21</span>),</span><br><span class="line">		*w2 = <span class="number">1</span>, w2[<span class="number">1</span> &lt;&lt; t] = <span class="built_in">PowerMod</span>(unity, <span class="number">1</span> &lt;&lt; (<span class="number">21</span> - t));</span><br><span class="line">		<span class="keyword">for</span> (i = t; i; --i) w2[<span class="number">1</span> &lt;&lt; (i - <span class="number">1</span>)] = (u64)w2[<span class="number">1</span> &lt;&lt; i] * w2[<span class="number">1</span> &lt;&lt; i] % mod;</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; n; ++i) w2[i] = (u64)w2[i &amp; (i - <span class="number">1</span>)] * w2[i &amp; -i] % mod;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">NTT_init</span><span class="params">(<span class="type">int</span> len)</span> </span>&#123;n = <span class="number">1</span> &lt;&lt; (l = len), iv = mod - (mod - <span class="number">1</span>) / n;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">DIF</span><span class="params">(<span class="type">int</span> *a)</span> </span>&#123;</span><br><span class="line">		<span class="type">int</span> i, *j, *k, len = n &gt;&gt; <span class="number">1</span>, R, *o;</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; l; ++i, len &gt;&gt;= <span class="number">1</span>)</span><br><span class="line">			<span class="keyword">for</span> (j = a, o = w2; j != a + n; j += len &lt;&lt; <span class="number">1</span>, ++o)</span><br><span class="line">				<span class="keyword">for</span> (k = j; k != j + len; ++k)</span><br><span class="line">					R = (u64)*o * k[len] % mod, <span class="built_in">reduce</span>(k[len] = *k - R), <span class="built_in">reduce</span>(*k += R - mod);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">DIT</span><span class="params">(<span class="type">int</span> *a)</span> </span>&#123;</span><br><span class="line">		<span class="type">int</span> i, *j, *k, len = <span class="number">1</span>, R, *o;</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; l; ++i, len &lt;&lt;= <span class="number">1</span>)</span><br><span class="line">			<span class="keyword">for</span> (j = a, o = w2; j != a + n; j += len &lt;&lt; <span class="number">1</span>, ++o)</span><br><span class="line">				<span class="keyword">for</span> (k = j; k != j + len; ++k)</span><br><span class="line">					<span class="built_in">reduce</span>(R = *k + k[len] - mod), k[len] = <span class="built_in">u64</span>(*k - k[len] + mod) * *o % mod, *k = R;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">DNTT</span><span class="params">(<span class="type">int</span> *a)</span> </span>&#123;<span class="built_in">DIF</span>(a);&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">IDNTT</span><span class="params">(<span class="type">int</span> *a)</span> </span>&#123;</span><br><span class="line">		<span class="built_in">DIT</span>(a), std::<span class="built_in">reverse</span>(a + <span class="number">1</span>, a + n);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) a[i] = a[i] * iv % mod;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">DIF</span><span class="params">(<span class="type">int</span> *a, <span class="type">int</span> *b)</span> </span>&#123;<span class="built_in">memcpy</span>(b, a, n &lt;&lt; <span class="number">2</span>), <span class="built_in">DIF</span>(b);&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">DIT</span><span class="params">(<span class="type">int</span> *a, <span class="type">int</span> *b)</span> </span>&#123;<span class="built_in">memcpy</span>(b, a, n &lt;&lt; <span class="number">2</span>), <span class="built_in">DIT</span>(b);&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">DNTT</span><span class="params">(<span class="type">int</span> *a, <span class="type">int</span> *b)</span> </span>&#123;<span class="built_in">memcpy</span>(b, a, n &lt;&lt; <span class="number">2</span>), <span class="built_in">DNTT</span>(b);&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">IDNTT</span><span class="params">(<span class="type">int</span> *a, <span class="type">int</span> *b)</span> </span>&#123;<span class="built_in">memcpy</span>(b, a, n &lt;&lt; <span class="number">2</span>), <span class="built_in">IDNTT</span>(b);&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> poly &#123;</span><br><span class="line">	<span class="keyword">using</span> <span class="keyword">namespace</span> poly_base;</span><br><span class="line"></span><br><span class="line">	vec B1, B2, B3, B4, B5, B6;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Multiplication (use one buffer, 3-dft of length 2n)</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">mul</span><span class="params">(<span class="type">int</span> deg, pvec a, pvec b, pvec c)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!deg) &#123;*c = (u64)*a * *b % mod; <span class="keyword">return</span>;&#125;</span><br><span class="line">		<span class="built_in">NTT_init</span>(<span class="built_in">lg2</span>(deg) + <span class="number">1</span>), <span class="built_in">DNTT</span>(a, c), <span class="built_in">DNTT</span>(b, B1);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) c[i] = (u64)c[i] * B1[i] % mod;</span><br><span class="line">		<span class="built_in">IDNTT</span>(c);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Inversion (use three buffers, 5-dft)</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">inv</span><span class="params">(<span class="type">int</span> deg, pvec a, pvec b)</span> </span>&#123;</span><br><span class="line">		<span class="type">int</span> i, len; <span class="built_in">assert</span>(*a);</span><br><span class="line">		<span class="keyword">if</span> (*b = <span class="built_in">PowerMod</span>(*a, mod - <span class="number">2</span>), deg &lt;= <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">		<span class="built_in">memset</span>(b + <span class="number">1</span>, <span class="number">0</span>, i = <span class="number">8</span> &lt;&lt; <span class="built_in">lg2</span>(deg - <span class="number">1</span>)), <span class="built_in">memset</span>(B1, <span class="number">0</span>, i), *B1 = *a;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (len = <span class="number">0</span>; <span class="number">1</span> &lt;&lt; len &lt; deg; ++len) &#123;</span><br><span class="line">			<span class="built_in">NTT_init</span>(len + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">			<span class="built_in">memcpy</span>(B1 + (n &gt;&gt; <span class="number">1</span>), a + (n &gt;&gt; <span class="number">1</span>), n &lt;&lt; <span class="number">1</span>), <span class="built_in">DIF</span>(b, B2), <span class="built_in">DIF</span>(B1, B3);</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) B3[i] = (u64)B3[i] * B2[i] % mod; <span class="built_in">DIT</span>(B3);</span><br><span class="line">			<span class="keyword">for</span> (i = n &gt;&gt; <span class="number">1</span>; i &lt; n; ++i) B3[i] = B3[n - i] * iv % mod;</span><br><span class="line"></span><br><span class="line">			<span class="built_in">memset</span>(B3, <span class="number">0</span>, n &lt;&lt; <span class="number">1</span>), <span class="built_in">DIF</span>(B3);</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) B3[i] = (u64)B3[i] * B2[i] % mod; <span class="built_in">DIT</span>(B3);</span><br><span class="line">			<span class="keyword">for</span> (i = n &gt;&gt; <span class="number">1</span>; i &lt; n; ++i) b[i] = B3[n - i] * (mod - iv) % mod;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Division and Modulo Operation (use five buffers)</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">div_mod</span><span class="params">(<span class="type">int</span> A, <span class="type">int</span> B, pvec a, pvec b, pvec q, pvec r)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (A &lt; B) &#123;<span class="built_in">memcpy</span>(r, a, (A + <span class="number">1</span>) &lt;&lt; <span class="number">2</span>), <span class="built_in">memset</span>(r + (A + <span class="number">1</span>), <span class="number">0</span>, (B - A) &lt;&lt; <span class="number">2</span>); <span class="keyword">return</span>;&#125;</span><br><span class="line">		<span class="type">int</span> Q = A - B, i, l_ = Q ? <span class="built_in">lg2</span>(Q) + <span class="number">1</span> : <span class="number">0</span>; <span class="built_in">NTT_init</span>(l_);</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= Q &amp;&amp; i &lt;= B; ++i) B4[i] = b[B - i];</span><br><span class="line">		<span class="built_in">memset</span>(B4 + i, <span class="number">0</span>, (n - i) &lt;&lt; <span class="number">2</span>), <span class="built_in">inv</span>(i = Q + <span class="number">1</span>, B4, B5);</span><br><span class="line"></span><br><span class="line">		std::<span class="built_in">reverse_copy</span>(a + B, a + (A + <span class="number">1</span>), B4), <span class="built_in">NTT_init</span>(++l_),</span><br><span class="line">		<span class="built_in">memset</span>(B4 + i, <span class="number">0</span>, (n - i) &lt;&lt; <span class="number">2</span>), <span class="built_in">memset</span>(B5 + i, <span class="number">0</span>, (n - i) &lt;&lt; <span class="number">2</span>),</span><br><span class="line">		<span class="built_in">mul</span>(<span class="number">2</span> * Q, B4, B5, q), std::<span class="built_in">reverse</span>(q, q + (Q + <span class="number">1</span>)),</span><br><span class="line">		<span class="built_in">memset</span>(q + i, <span class="number">0</span>, (n - i) &lt;&lt; <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (!B) <span class="keyword">return</span>;</span><br><span class="line">		<span class="built_in">NTT_init</span>(<span class="built_in">lg2</span>(<span class="number">2</span> * B - <span class="number">1</span>) + <span class="number">1</span>);</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= Q &amp;&amp; i &lt; B; ++i) B2[i] = b[i], B3[i] = q[i];</span><br><span class="line">		<span class="built_in">memset</span>(B2 + i, <span class="number">0</span>, (n - i) &lt;&lt; <span class="number">2</span>), <span class="built_in">memset</span>(B3 + i, <span class="number">0</span>, (n - i) &lt;&lt; <span class="number">2</span>),</span><br><span class="line">		<span class="built_in">mul</span>(<span class="number">2</span> * (B - <span class="number">1</span>), B2, B3, r), <span class="built_in">memset</span>(r + i, <span class="number">0</span>, (n - i) &lt;&lt; <span class="number">2</span>);</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; B; ++i) <span class="built_in">reduce</span>(r[i] = a[i] - r[i]);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Multiplication with std::vector (use two buffers, 3-dft)</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">mul</span><span class="params">(vector &amp;a, vector &amp;b, vector &amp;ret)</span> </span>&#123;</span><br><span class="line">		<span class="type">int</span> A = a.<span class="built_in">size</span>() - <span class="number">1</span>, B = b.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span> (!(A || B)) &#123;ret.<span class="built_in">EB</span>((u64)a[<span class="number">0</span>] * b[<span class="number">0</span>] % mod); <span class="keyword">return</span>;&#125;</span><br><span class="line">		<span class="built_in">NTT_init</span>(<span class="built_in">lg2</span>(A + B) + <span class="number">1</span>),</span><br><span class="line">		<span class="built_in">memcpy</span>(B1, a.<span class="built_in">data</span>(), (A + <span class="number">1</span>) &lt;&lt; <span class="number">2</span>), <span class="built_in">memset</span>(B1 + (A + <span class="number">1</span>), <span class="number">0</span>, (n - A - <span class="number">1</span>) &lt;&lt; <span class="number">2</span>),</span><br><span class="line">		<span class="built_in">memcpy</span>(B2, b.<span class="built_in">data</span>(), (B + <span class="number">1</span>) &lt;&lt; <span class="number">2</span>), <span class="built_in">memset</span>(B2 + (B + <span class="number">1</span>), <span class="number">0</span>, (n - B - <span class="number">1</span>) &lt;&lt; <span class="number">2</span>),</span><br><span class="line">		<span class="built_in">DNTT</span>(B1), <span class="built_in">DNTT</span>(B2);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) B1[i] = (u64)B1[i] * B2[i] % mod;</span><br><span class="line">		<span class="built_in">IDNTT</span>(B1), ret.<span class="built_in">assign</span>(B1, B1 + (A + B + <span class="number">1</span>));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Differential</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">diff</span><span class="params">(<span class="type">int</span> deg, pvec a, pvec b)</span> </span>&#123;<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= deg; ++i) b[i - <span class="number">1</span>] = (u64)a[i] * i % mod;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Integral</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">intg</span><span class="params">(<span class="type">int</span> deg, pvec a, pvec b, <span class="type">int</span> constant = <span class="number">0</span>)</span> </span>&#123;<span class="keyword">for</span> (<span class="type">int</span> i = deg; i; --i) b[i] = (u64)a[i - <span class="number">1</span>] * ::inv[i] % mod; *b = constant;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// f&#x27;[x] / f[x] (use four buffers, 6.5-dft)</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">dif_quo</span><span class="params">(<span class="type">int</span> deg, pvec a, pvec b)</span> </span>&#123;</span><br><span class="line">		<span class="built_in">assert</span>(*a);</span><br><span class="line">		<span class="keyword">if</span> (deg &lt;= <span class="number">1</span>) &#123;*b = <span class="built_in">PowerMod</span>(*a, mod - <span class="number">2</span>, a[<span class="number">1</span>]); <span class="keyword">return</span>;&#125;</span><br><span class="line"></span><br><span class="line">		<span class="type">int</span> i, len = <span class="built_in">lg2</span>(deg - <span class="number">1</span>);</span><br><span class="line">		<span class="built_in">inv</span>((deg + <span class="number">1</span>) / <span class="number">2</span>, a, B4), <span class="built_in">NTT_init</span>(len + <span class="number">1</span>),</span><br><span class="line">		<span class="built_in">memset</span>(B4 + (n &gt;&gt; <span class="number">1</span>), <span class="number">0</span>, n &lt;&lt; <span class="number">1</span>), <span class="built_in">DIF</span>(B4, B2),</span><br><span class="line"></span><br><span class="line">		<span class="built_in">diff</span>(deg, a, B1), <span class="built_in">memcpy</span>(B3, B1, n &lt;&lt; <span class="number">1</span>),</span><br><span class="line">		<span class="built_in">memset</span>(B3 + (n &gt;&gt; <span class="number">1</span>), <span class="number">0</span>, n &lt;&lt; <span class="number">1</span>), <span class="built_in">DIF</span>(B3);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) B3[i] = (u64)B3[i] * B2[i] % mod;</span><br><span class="line">		<span class="built_in">DIT</span>(B3, b), *b = *b * iv % mod;</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; n &gt;&gt; <span class="number">1</span>; ++i) b[i] = b[n - i] * iv % mod;</span><br><span class="line">		<span class="built_in">memset</span>(b + (n &gt;&gt; <span class="number">1</span>), <span class="number">0</span>, n &lt;&lt; <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">DIF</span>(b, B4), <span class="built_in">DIF</span>(a, B3);</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) B3[i] = (u64)B3[i] * B4[i] % mod; <span class="built_in">DIT</span>(B3);</span><br><span class="line">		<span class="keyword">for</span> (i = n &gt;&gt; <span class="number">1</span>; i &lt; n; ++i) B3[i] = (B3[n - i] * iv + mod - B1[i]) % mod;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">memset</span>(B3, <span class="number">0</span>, n &lt;&lt; <span class="number">1</span>), <span class="built_in">DIF</span>(B3);</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) B3[i] = (u64)B3[i] * B2[i] % mod; <span class="built_in">DIT</span>(B3);</span><br><span class="line">		<span class="keyword">for</span> (i = n &gt;&gt; <span class="number">1</span>; i &lt; n; ++i) b[i] = B3[n - i] * (mod - iv) % mod;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Logarithm (use DifQuo)</span></span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">ln</span><span class="params">(<span class="type">int</span> deg, pvec a, pvec b)</span> </span>&#123;<span class="built_in">assert</span>(*a == <span class="number">1</span>), --deg ? (<span class="built_in">dif_quo</span>(deg, a, b), <span class="built_in">intg</span>(deg, b, b)) : <span class="built_in">void</span>(*b = <span class="number">0</span>);&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Exponentiation (use six buffers, 12-dft)</span></span><br><span class="line">	<span class="comment">// WARNING : this implementation of exponentiation is SLOWER than the CDQ_NTT ver.</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">exp</span><span class="params">(<span class="type">int</span> deg, pvec a, pvec b)</span> </span>&#123;</span><br><span class="line">		<span class="type">int</span> i, len; pvec c = B6; <span class="built_in">assert</span>(!*a);</span><br><span class="line">		<span class="keyword">if</span> (*b = <span class="number">1</span>, deg &lt;= <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">		<span class="keyword">if</span> (b[<span class="number">1</span>] = a[<span class="number">1</span>], deg == <span class="number">2</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">memset</span>(b + <span class="number">2</span>, <span class="number">0</span>, i = <span class="number">8</span> &lt;&lt; <span class="built_in">lg2</span>(deg - <span class="number">1</span>)), <span class="built_in">memset</span>(c, <span class="number">0</span>, i), <span class="built_in">memset</span>(B1, <span class="number">0</span>, i),</span><br><span class="line">		*c = <span class="number">1</span>, <span class="built_in">neg</span>(c[<span class="number">1</span>] = b[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (len = <span class="number">1</span>; <span class="number">1</span> &lt;&lt; len &lt; deg; ++len) &#123;</span><br><span class="line">			<span class="built_in">NTT_init</span>(len + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">			<span class="built_in">DIF</span>(c, B2), <span class="built_in">DIF</span>(b, B3);</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) B4[i] = (u64)B3[i] * B2[i] % mod; <span class="built_in">DIT</span>(B4);</span><br><span class="line">			<span class="keyword">for</span> (i = n &gt;&gt; <span class="number">1</span>; i &lt; n; ++i) B4[i] = B4[n - i] * iv % mod;</span><br><span class="line"></span><br><span class="line">			<span class="built_in">memset</span>(B4, <span class="number">0</span>, n &lt;&lt; <span class="number">1</span>), <span class="built_in">DIF</span>(B4);</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) B4[i] = (u64)B4[i] * B2[i] % mod; <span class="built_in">DIT</span>(B4);</span><br><span class="line">			<span class="keyword">for</span> (i = n &gt;&gt; <span class="number">1</span>; i &lt; n; ++i) B4[i] = B4[n - i] * (mod - iv) % mod;</span><br><span class="line"></span><br><span class="line">			<span class="built_in">memcpy</span>(B4, c, n &lt;&lt; <span class="number">1</span>), <span class="built_in">DIF</span>(B4);</span><br><span class="line">			<span class="built_in">diff</span>(n &gt;&gt; <span class="number">1</span>, b, B1), <span class="built_in">DIF</span>(B1, B5);</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) B4[i] = (u64)B4[i] * B5[i] % mod; <span class="built_in">DIT</span>(B4);</span><br><span class="line">			<span class="keyword">for</span> (i = n &gt;&gt; <span class="number">1</span>; i &lt; n; ++i) <span class="built_in">reduce</span>(B5[i] = (a[i] + B4[n - i + <span class="number">1</span>] * (mod - iv) % mod * ::inv[i]) % mod);</span><br><span class="line"></span><br><span class="line">			<span class="built_in">memset</span>(B5, <span class="number">0</span>, n &lt;&lt; <span class="number">1</span>), <span class="built_in">DIF</span>(B5);</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) B5[i] = (u64)B5[i] * B3[i] % mod; <span class="built_in">DIT</span>(B5);</span><br><span class="line">			<span class="keyword">for</span> (i = n &gt;&gt; <span class="number">1</span>; i &lt; n; ++i) b[i] = B5[n - i] * iv % mod;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (<span class="number">2</span> &lt;&lt; len &gt;= deg) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">			<span class="built_in">DIF</span>(b, B3);</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) B3[i] = (u64)B3[i] * B2[i] % mod; <span class="built_in">DIT</span>(B3);</span><br><span class="line">			<span class="keyword">for</span> (i = n &gt;&gt; <span class="number">1</span>; i &lt; n; ++i) B3[i] = B3[n - i] * iv % mod;</span><br><span class="line"></span><br><span class="line">			<span class="built_in">memset</span>(B3, <span class="number">0</span>, n &lt;&lt; <span class="number">1</span>), <span class="built_in">DIF</span>(B3);</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) B3[i] = (u64)B3[i] * B2[i] % mod; <span class="built_in">DIT</span>(B3);</span><br><span class="line">			<span class="keyword">for</span> (i = n &gt;&gt; <span class="number">1</span>; i &lt; n; ++i) c[i] = B3[n - i] * (mod - iv) % mod;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> CDQ_NTT &#123;</span><br><span class="line">	<span class="keyword">using</span> <span class="keyword">namespace</span> poly_base;</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> lim;</span><br><span class="line">	vec f, g, C1;</span><br><span class="line">	<span class="type">int</span> fn[N * <span class="number">2</span>], gn[N * <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">register_g</span><span class="params">(pvec g)</span> </span>&#123;<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; <span class="number">1</span> &lt;&lt; (i - <span class="number">1</span>) &lt;= lim; ++i) <span class="built_in">NTT_init</span>(i), <span class="built_in">DIF</span>(g, gn + (<span class="number">1</span> &lt;&lt; i));&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Standard CDQ-NTT Algorithm, type `UK`</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">(<span class="type">int</span> L, <span class="type">int</span> w)</span> </span>&#123;</span><br><span class="line">		<span class="type">int</span> i, R = L + (<span class="number">1</span> &lt;&lt; w), M;</span><br><span class="line">		<span class="keyword">if</span> (!w) &#123;</span><br><span class="line">			<span class="comment">// something depend on problem</span></span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">solve</span>(L, w - <span class="number">1</span>);</span><br><span class="line">		<span class="keyword">if</span> ((M = (<span class="number">1</span> &lt;&lt; (w - <span class="number">1</span>)) + L) &gt; lim) <span class="keyword">return</span>;</span><br><span class="line">		<span class="built_in">NTT_init</span>(w);</span><br><span class="line">		pvec ga = gn + (<span class="number">1</span> &lt;&lt; w);</span><br><span class="line">		<span class="built_in">memcpy</span>(C1, f + L, <span class="number">2</span> &lt;&lt; w), <span class="built_in">memset</span>(C1 + (<span class="number">1</span> &lt;&lt; (w - <span class="number">1</span>)), <span class="number">0</span>, <span class="number">2</span> &lt;&lt; w),</span><br><span class="line">		<span class="built_in">DIF</span>(C1);</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) C1[i] = (u64)C1[i] * ga[i] % mod;</span><br><span class="line">		<span class="built_in">DIT</span>(C1);</span><br><span class="line">		<span class="keyword">for</span> (i = M; i &lt; R; ++i) f[i] = (f[i] + C1[n - (i - L)] * iv) % mod;</span><br><span class="line">		<span class="built_in">solve</span>(M, w - <span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">(<span class="type">int</span> L, <span class="type">int</span> w)</span> </span>&#123;</span><br><span class="line">		<span class="type">int</span> i, R = L + (<span class="number">1</span> &lt;&lt; w), M;</span><br><span class="line">		<span class="keyword">if</span> (!w) &#123;</span><br><span class="line">			<span class="comment">// something depend on problem</span></span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">solve</span>(L, w - <span class="number">1</span>);</span><br><span class="line">		<span class="keyword">if</span> ((M = (<span class="number">1</span> &lt;&lt; (w - <span class="number">1</span>)) + L) &gt; lim) <span class="keyword">return</span>;</span><br><span class="line">		<span class="built_in">NTT_init</span>(w);</span><br><span class="line">		<span class="keyword">if</span> (L) &#123;</span><br><span class="line">			pvec fa = fn + (<span class="number">1</span> &lt;&lt; w), ga = gn + (<span class="number">1</span> &lt;&lt; w);</span><br><span class="line">			<span class="built_in">memcpy</span>(C1, f + L, <span class="number">2</span> &lt;&lt; w), <span class="built_in">memset</span>(C1 + (<span class="number">1</span> &lt;&lt; (w - <span class="number">1</span>)), <span class="number">0</span>, <span class="number">2</span> &lt;&lt; w),</span><br><span class="line">			<span class="built_in">memcpy</span>(C2, g + L, <span class="number">2</span> &lt;&lt; w), <span class="built_in">memset</span>(C2 + (<span class="number">1</span> &lt;&lt; (w - <span class="number">1</span>)), <span class="number">0</span>, <span class="number">2</span> &lt;&lt; w),</span><br><span class="line">			<span class="built_in">DIF</span>(C1), <span class="built_in">DIF</span>(C2);</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) C1[i] = ((u64)C1[i] * ga[i] + (u64)C2[i] * fa[i]) % mod;</span><br><span class="line">			<span class="built_in">DIT</span>(C1);</span><br><span class="line">			<span class="keyword">for</span> (i = M; i &lt; R; ++i) f[i] = (f[i] + C1[n - (i - L)] * iv) % mod;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="built_in">memcpy</span>(C1, f, <span class="number">2</span> &lt;&lt; w), <span class="built_in">memset</span>(C1 + M, <span class="number">0</span>, <span class="number">2</span> &lt;&lt; w),</span><br><span class="line">			<span class="built_in">memcpy</span>(C2, g, <span class="number">2</span> &lt;&lt; w), <span class="built_in">memset</span>(C2 + M, <span class="number">0</span>, <span class="number">2</span> &lt;&lt; w),</span><br><span class="line">			<span class="built_in">DIF</span>(C1), <span class="built_in">DIF</span>(C2),</span><br><span class="line">			<span class="built_in">memcpy</span>(fn + (<span class="number">1</span> &lt;&lt; (w - <span class="number">1</span>)), C1, <span class="number">2</span> &lt;&lt; w),</span><br><span class="line">			<span class="built_in">memcpy</span>(gn + (<span class="number">1</span> &lt;&lt; (w - <span class="number">1</span>)), C2, <span class="number">2</span> &lt;&lt; w);</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) C1[i] = (u64)C1[i] * C2[i] % mod;</span><br><span class="line">			<span class="built_in">DIT</span>(C1);</span><br><span class="line">			<span class="keyword">for</span> (i = M; i &lt; R; ++i) f[i] = (f[i] + C1[n - i] * iv) % mod;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">solve</span>(M, w - <span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> poly_evaluation &#123;</span><br><span class="line">	<span class="keyword">using</span> <span class="keyword">namespace</span> poly_base;</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> cnt = <span class="number">0</span>, lc[N], rc[N];</span><br><span class="line">	vec Prd_, E1, E2, E3;</span><br><span class="line">	vector g[N], tmp_;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">solve</span><span class="params">(<span class="type">int</span> L, <span class="type">int</span> R)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (L + <span class="number">1</span> == R) <span class="keyword">return</span> L;</span><br><span class="line">		<span class="type">int</span> M = (L + R) / <span class="number">2</span>, id = cnt++, lp = <span class="built_in">solve</span>(L, M), rp = <span class="built_in">solve</span>(M, R);</span><br><span class="line">		<span class="keyword">return</span> poly::<span class="built_in">mul</span>(g[lp], g[rp], g[id]), lc[id] = lp, rc[id] = rp, id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">recursion</span><span class="params">(<span class="type">int</span> id, <span class="type">int</span> L, <span class="type">int</span> R, <span class="type">const</span> vector &amp;poly)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (L + <span class="number">1</span> == R) <span class="keyword">return</span> tmp_.<span class="built_in">EB</span>(poly.<span class="built_in">back</span>());</span><br><span class="line">		<span class="type">int</span> i, n = poly.<span class="built_in">size</span>() - <span class="number">1</span>, M = (L + R) / <span class="number">2</span>, lp = lc[id], rp = rc[id],</span><br><span class="line">			dl = <span class="built_in">min</span>(n, g[lp].<span class="built_in">size</span>() - <span class="number">1</span>), dr = <span class="built_in">min</span>(n, g[rp].<span class="built_in">size</span>() - <span class="number">1</span>);</span><br><span class="line">		<span class="keyword">if</span> (L + <span class="number">2</span> == R) <span class="keyword">return</span></span><br><span class="line">			tmp_.<span class="built_in">EB</span>((poly[n] + (u64)poly[n - <span class="number">1</span>] * g[rp].<span class="built_in">back</span>()) % mod),</span><br><span class="line">			tmp_.<span class="built_in">EB</span>((poly[n] + (u64)poly[n - <span class="number">1</span>] * g[lp].<span class="built_in">back</span>()) % mod);</span><br><span class="line"></span><br><span class="line">		vector ly, ry; ly.<span class="built_in">reserve</span>(dl + <span class="number">1</span>), ry.<span class="built_in">reserve</span>(dr + <span class="number">1</span>);</span><br><span class="line">		<span class="built_in">NTT_init</span>(<span class="built_in">lg2</span>(dl + dr) + <span class="number">1</span>);</span><br><span class="line">		<span class="built_in">memcpy</span>(E1, poly.<span class="built_in">data</span>(), (n + <span class="number">1</span>) &lt;&lt; <span class="number">2</span>), <span class="built_in">DIF</span>(E1, E2), <span class="built_in">memset</span>(E1, <span class="number">0</span>, (n + <span class="number">1</span>) &lt;&lt; <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">memcpy</span>(E1, g[rp].<span class="built_in">data</span>(), (dr + <span class="number">1</span>) &lt;&lt; <span class="number">2</span>), <span class="built_in">DIF</span>(E1, E3), <span class="built_in">memset</span>(E1, <span class="number">0</span>, (dr + <span class="number">1</span>) &lt;&lt; <span class="number">2</span>);</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; poly::n; ++i) E3[i] = (u64)E3[i] * E2[i] % mod;</span><br><span class="line">		<span class="built_in">DIT</span>(E3), std::<span class="built_in">reverse</span>(E3 + <span class="number">1</span>, E3 + poly::n);</span><br><span class="line">		<span class="keyword">for</span> (i = n - dl; i &lt;= n; ++i) ly.<span class="built_in">EB</span>(E3[i] * iv % mod);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">memcpy</span>(E1, g[lp].<span class="built_in">data</span>(), (dl + <span class="number">1</span>) &lt;&lt; <span class="number">2</span>), <span class="built_in">DIF</span>(E1, E3), <span class="built_in">memset</span>(E1, <span class="number">0</span>, (dl + <span class="number">1</span>) &lt;&lt; <span class="number">2</span>);</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; poly::n; ++i) E3[i] = (u64)E3[i] * E2[i] % mod;</span><br><span class="line">		<span class="built_in">DIT</span>(E3), std::<span class="built_in">reverse</span>(E3 + <span class="number">1</span>, E3 + poly::n);</span><br><span class="line">		<span class="keyword">for</span> (i = n - dr; i &lt;= n; ++i) ry.<span class="built_in">EB</span>(E3[i] * iv % mod);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">recursion</span>(lp, L, M, ly), <span class="built_in">recursion</span>(rp, M, R, ry);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function">vector <span class="title">emain</span><span class="params">(<span class="type">int</span> n, pvec f, <span class="type">const</span> vector &amp;pts)</span> </span>&#123;</span><br><span class="line">		<span class="type">int</span> i, id, m = pts.<span class="built_in">size</span>(), q;</span><br><span class="line">		<span class="keyword">if</span> (!m) <span class="keyword">return</span> <span class="built_in">vector</span>();</span><br><span class="line">		<span class="keyword">if</span> (!n) <span class="keyword">return</span> <span class="built_in">vector</span>(m, *f);</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; m; ++i) g[i].<span class="built_in">clear</span>(), g[i].<span class="built_in">EB</span>(<span class="number">1</span>), g[i].<span class="built_in">EB</span>(<span class="built_in">neg</span>(q = pts[i]));</span><br><span class="line"></span><br><span class="line">		id = <span class="built_in">solve</span>(<span class="number">0</span>, cnt = m), <span class="built_in">memcpy</span>(Prd_, g[id].<span class="built_in">data</span>(), (m + <span class="number">1</span>) &lt;&lt; <span class="number">2</span>);</span><br><span class="line">		poly::<span class="built_in">inv</span>(n + <span class="number">1</span>, Prd_, E2), <span class="built_in">memset</span>(Prd_, <span class="number">0</span>, (m + <span class="number">1</span>) &lt;&lt; <span class="number">2</span>);</span><br><span class="line">		<span class="keyword">if</span> (n &gt; <span class="number">0</span>) <span class="built_in">memset</span>(E2 + (n + <span class="number">1</span>), <span class="number">0</span>, (poly::n - n - <span class="number">1</span>) &lt;&lt; <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">		std::<span class="built_in">reverse_copy</span>(f, f + (n + <span class="number">1</span>), E1), poly::<span class="built_in">mul</span>(<span class="number">2</span> * n, E1, E2, E3),</span><br><span class="line">		<span class="built_in">memset</span>(E1, <span class="number">0</span>, (n + <span class="number">1</span>) &lt;&lt; <span class="number">2</span>), <span class="built_in">memset</span>(E2, <span class="number">0</span>, (n + <span class="number">1</span>) &lt;&lt; <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> tmp_.<span class="built_in">clear</span>(), tmp_.<span class="built_in">reserve</span>(m), <span class="built_in">recursion</span>(id, <span class="number">0</span>, m, <span class="built_in">vector</span>(E3 + <span class="built_in">max</span>(n - m + <span class="number">1</span>, <span class="number">0</span>), E3 + (n + <span class="number">1</span>))), tmp_;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> poly_interpolation &#123;</span><br><span class="line">	<span class="keyword">using</span> <span class="keyword">namespace</span> poly_evaluation;</span><br><span class="line"></span><br><span class="line">	vec I1, I2, I3, I4, I5;</span><br><span class="line">	pvec iresult;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">irecursion</span><span class="params">(<span class="type">int</span> id, <span class="type">int</span> L, <span class="type">int</span> R)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (L + <span class="number">1</span> == R) <span class="keyword">return</span>;</span><br><span class="line">		<span class="type">int</span> i, M = (L + R) / <span class="number">2</span>, lp = lc[id], rp = rc[id];</span><br><span class="line">		<span class="built_in">irecursion</span>(lp, L, M), <span class="built_in">irecursion</span>(rp, M, R);</span><br><span class="line">		<span class="built_in">NTT_init</span>(<span class="built_in">lg2</span>(R - L - <span class="number">1</span>) + <span class="number">1</span>);</span><br><span class="line">		<span class="built_in">memcpy</span>(I1, iresult + L, (M - L) &lt;&lt; <span class="number">2</span>), <span class="built_in">memset</span>(I1 + (M - L), <span class="number">0</span>, (poly::n - (M - L)) &lt;&lt; <span class="number">2</span>);</span><br><span class="line">		<span class="built_in">memcpy</span>(I2, iresult + M, (R - M) &lt;&lt; <span class="number">2</span>), <span class="built_in">memset</span>(I2 + (R - M), <span class="number">0</span>, (poly::n - (R - M)) &lt;&lt; <span class="number">2</span>);</span><br><span class="line">		<span class="built_in">memcpy</span>(I3, g[lp].<span class="built_in">data</span>(), (M - L + <span class="number">1</span>) &lt;&lt; <span class="number">2</span>), <span class="built_in">memset</span>(I3 + (M - L + <span class="number">1</span>), <span class="number">0</span>, (poly::n - (M - L + <span class="number">1</span>)) &lt;&lt; <span class="number">2</span>);</span><br><span class="line">		<span class="built_in">memcpy</span>(I4, g[rp].<span class="built_in">data</span>(), (R - M + <span class="number">1</span>) &lt;&lt; <span class="number">2</span>), <span class="built_in">memset</span>(I4 + (R - M + <span class="number">1</span>), <span class="number">0</span>, (poly::n - (R - M + <span class="number">1</span>)) &lt;&lt; <span class="number">2</span>);</span><br><span class="line">		<span class="built_in">DIF</span>(I1), <span class="built_in">DIF</span>(I2), <span class="built_in">DIF</span>(I3), <span class="built_in">DIF</span>(I4);</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) I1[i] = ((u64)I1[i] * I4[i] + (u64)I2[i] * I3[i]) % mod;</span><br><span class="line">		<span class="built_in">DIT</span>(I1), std::<span class="built_in">reverse</span>(I1 + <span class="number">1</span>, I1 + n);</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; R - L; ++i) iresult[L + i] = I1[i] * iv % mod;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">imain</span><span class="params">(<span class="type">int</span> n, pr *pts, pvec ret)</span> </span>&#123;</span><br><span class="line">		<span class="type">int</span> i, id, q;</span><br><span class="line">		<span class="built_in">assert</span>(n &gt; <span class="number">0</span>);</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) g[i].<span class="built_in">clear</span>(), g[i].<span class="built_in">EB</span>(<span class="number">1</span>), g[i].<span class="built_in">EB</span>(<span class="built_in">neg</span>(q = pts[i].first));</span><br><span class="line"></span><br><span class="line">		id = <span class="built_in">solve</span>(<span class="number">0</span>, cnt = n), <span class="built_in">memcpy</span>(Prd_, g[id].<span class="built_in">data</span>(), (n + <span class="number">1</span>) &lt;&lt; <span class="number">2</span>);</span><br><span class="line">		poly::<span class="built_in">inv</span>(n, Prd_, E2), <span class="built_in">memset</span>(Prd_, <span class="number">0</span>, n &lt;&lt; <span class="number">2</span>);</span><br><span class="line">		<span class="keyword">if</span> (n &gt; <span class="number">1</span>) <span class="built_in">memset</span>(E2 + n, <span class="number">0</span>, (poly::n - n) &lt;&lt; <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) E1[i] = <span class="built_in">u64</span>(n - i) * g[id][i] % mod;</span><br><span class="line">		poly::<span class="built_in">mul</span>(<span class="number">2</span> * (n - <span class="number">1</span>), E1, E2, E3),</span><br><span class="line">		<span class="built_in">memset</span>(E1, <span class="number">0</span>, n &lt;&lt; <span class="number">2</span>), <span class="built_in">memset</span>(E2, <span class="number">0</span>, n &lt;&lt; <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">		tmp_.<span class="built_in">clear</span>(), tmp_.<span class="built_in">reserve</span>(n), <span class="built_in">recursion</span>(id, <span class="number">0</span>, n, <span class="built_in">vector</span>(E3, E3 + n));</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) ret[i] = <span class="built_in">PowerMod</span>(tmp_[i], mod - <span class="number">2</span>, pts[i].second);</span><br><span class="line">		iresult = ret, <span class="built_in">irecursion</span>(id, <span class="number">0</span>, n), std::<span class="built_in">reverse</span>(ret, ret + n);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> linear_recur &#123;</span><br><span class="line">	<span class="keyword">using</span> <span class="keyword">namespace</span> poly_base;</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> ld;</span><br><span class="line">	vec f, g, L1, L2, L3;</span><br><span class="line"></span><br><span class="line">	<span class="type">void</span> __builtin_divmod(<span class="type">int</span> d) &#123;</span><br><span class="line">		<span class="type">int</span> i; <span class="built_in">NTT_init</span>(ld);</span><br><span class="line">		std::<span class="built_in">reverse_copy</span>(f + d, f + <span class="number">2</span> * d, L3);</span><br><span class="line">		<span class="built_in">memset</span>(L3 + d, <span class="number">0</span>, (n - d) &lt;&lt; <span class="number">2</span>);</span><br><span class="line">		<span class="built_in">DNTT</span>(L3);</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) L3[i] = (u64)L3[i] * L2[i] % mod;</span><br><span class="line">		<span class="built_in">IDNTT</span>(L3);</span><br><span class="line">		std::<span class="built_in">reverse</span>(L3, L3 + d), <span class="built_in">memset</span>(L3 + d, <span class="number">0</span>, (n - d) &lt;&lt; <span class="number">2</span>);</span><br><span class="line">		<span class="built_in">DNTT</span>(L3);</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) L3[i] = (u64)L3[i] * L1[i] % mod;</span><br><span class="line">		<span class="built_in">IDNTT</span>(L3);</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; d; ++i) <span class="built_in">reduce</span>(f[i] -= L3[i]);</span><br><span class="line">		<span class="built_in">memset</span>(f + d, <span class="number">0</span>, d &lt;&lt; <span class="number">2</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">(<span class="type">int</span> Q, <span class="type">int</span> d)</span> </span>&#123;</span><br><span class="line">		<span class="type">int</span> i, df = <span class="number">1</span>, z = <span class="built_in">lg2</span>(Q); <span class="type">bool</span> alive = <span class="literal">false</span>;</span><br><span class="line">		<span class="built_in">assert</span>(d &gt; <span class="number">0</span>), ld = <span class="built_in">lg2</span>(<span class="number">2</span> * d - <span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span> (d == <span class="number">1</span>) alive = <span class="literal">true</span>, *f = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">NTT_init</span>(ld),</span><br><span class="line">		std::<span class="built_in">reverse_copy</span>(g + <span class="number">1</span>, g + (d + <span class="number">1</span>), L1),</span><br><span class="line">		<span class="built_in">memset</span>(L1 + d, <span class="number">0</span>, (n - d) &lt;&lt; <span class="number">2</span>),</span><br><span class="line">		poly::<span class="built_in">inv</span>(d, L1, L2);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">NTT_init</span>(ld),</span><br><span class="line">		<span class="built_in">memset</span>(L2 + d, <span class="number">0</span>, (n - d) &lt;&lt; <span class="number">2</span>),</span><br><span class="line">		<span class="built_in">memcpy</span>(L1, g, d &lt;&lt; <span class="number">2</span>),</span><br><span class="line">		<span class="built_in">memset</span>(L1 + d, <span class="number">0</span>, (n - d) &lt;&lt; <span class="number">2</span>),</span><br><span class="line">		<span class="built_in">DIF</span>(L1), <span class="built_in">DIF</span>(L2);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (; --z &gt;= <span class="number">0</span>; ) &#123;</span><br><span class="line">			df = df &lt;&lt; <span class="number">1</span> | (Q &gt;&gt; z &amp; <span class="number">1</span>);</span><br><span class="line">			<span class="keyword">if</span> (df &lt; d) <span class="keyword">continue</span>;</span><br><span class="line">			<span class="keyword">if</span> (!alive) alive = <span class="literal">true</span>, f[df &gt;&gt; <span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">			<span class="built_in">NTT_init</span>(ld), <span class="built_in">DNTT</span>(f);</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) f[i] = (u64)f[i] * f[i] % mod;</span><br><span class="line">			<span class="built_in">IDNTT</span>(f);</span><br><span class="line">			<span class="keyword">if</span> (df &amp; <span class="number">1</span>) std::<span class="built_in">copy_backward</span>(f, f + (<span class="number">2</span> * d - <span class="number">1</span>), f + <span class="number">2</span> * d), *f = <span class="number">0</span>;</span><br><span class="line">			__builtin_divmod(d);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> linear_recur_single &#123;</span><br><span class="line">	<span class="keyword">using</span> <span class="keyword">namespace</span> poly;</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> ld;</span><br><span class="line">	vec f, g, L1, L2, L3, L4;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">get</span><span class="params">(<span class="type">int</span> Q, <span class="type">int</span> d)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (Q &lt; d) <span class="keyword">return</span> f[Q];</span><br><span class="line"></span><br><span class="line">		<span class="type">int</span> i, j, ret = <span class="number">0</span>, halves = <span class="number">0</span>;</span><br><span class="line">		<span class="built_in">assert</span>(d &gt; <span class="number">0</span>), ld = <span class="built_in">lg2</span>(<span class="number">2</span> * d - <span class="number">1</span>) + <span class="number">1</span>,</span><br><span class="line"></span><br><span class="line">		<span class="built_in">mul</span>(<span class="number">2</span> * d - <span class="number">1</span>, f, g, L1), <span class="built_in">memset</span>(L1 + d, <span class="number">0</span>, (n - d) &lt;&lt; <span class="number">2</span>),</span><br><span class="line">		<span class="built_in">memcpy</span>(L2, g, (d + <span class="number">1</span>) &lt;&lt; <span class="number">2</span>), <span class="built_in">memset</span>(L2 + (d + <span class="number">1</span>), <span class="number">0</span>, (n - d - <span class="number">1</span>) &lt;&lt; <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (; Q &gt;= d; Q &gt;&gt;= <span class="number">1</span>) &#123;</span><br><span class="line">			<span class="built_in">NTT_init</span>(ld), <span class="built_in">DIF</span>(L1, L4), <span class="built_in">DIF</span>(L2, L3),</span><br><span class="line">			<span class="built_in">NTT_init</span>(ld - <span class="number">1</span>), ++halves;</span><br><span class="line">			<span class="keyword">if</span> (Q &amp; <span class="number">1</span>) &#123;</span><br><span class="line">				<span class="keyword">for</span> (j = i = <span class="number">0</span>; i &lt; n; ++i, j += <span class="number">2</span>)</span><br><span class="line">					L4[i] = ((u64)L4[j] * L3[j + <span class="number">1</span>] + <span class="built_in">u64</span>(mod - L3[j]) * L4[j + <span class="number">1</span>]) % mod;</span><br><span class="line">				<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) L4[i] = (u64)L4[i] * w2[i] % mod;</span><br><span class="line">				<span class="built_in">IDNTT</span>(L4), L4[n] = *L4, <span class="built_in">memcpy</span>(L1, L4 + <span class="number">1</span>, d &lt;&lt; <span class="number">2</span>);</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">for</span> (j = i = <span class="number">0</span>; i &lt; n; ++i, j += <span class="number">2</span>)</span><br><span class="line">					L4[i] = ((u64)L4[j] * L3[j + <span class="number">1</span>] + (u64)L3[j] * L4[j + <span class="number">1</span>]) % mod;</span><br><span class="line">				<span class="built_in">IDNTT</span>(L4, L1);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">for</span> (j = i = <span class="number">0</span>; i &lt; n; ++i, j += <span class="number">2</span>) L3[i] = (u64)L3[j] * L3[j + <span class="number">1</span>] % mod;</span><br><span class="line">			<span class="built_in">IDNTT</span>(L3, L2);</span><br><span class="line">			<span class="keyword">if</span> (*L2 != <span class="number">1</span>) L2[d] = (*L2 ? *L2 : mod) - <span class="number">1</span>, *L2 = <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		poly::<span class="built_in">inv</span>(Q + <span class="number">1</span>, L2, L3);</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= Q; ++i) ret = (ret + (u64)L1[i] * L3[Q - i]) % mod;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">PowerMod</span>(iv2, halves, ret);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> miscellaneous &#123;</span><br><span class="line">	<span class="keyword">using</span> <span class="keyword">namespace</span> poly_base;</span><br><span class="line"></span><br><span class="line">	vec M1, M2, M3, M4;</span><br><span class="line">	vec Ma[<span class="number">200</span>];</span><br><span class="line"></span><br><span class="line">	<span class="comment">// calculate b(x) = a(x + c), poly_base::init need &#x27;false&#x27;</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">translate</span><span class="params">(<span class="type">int</span> deg, pvec a, <span class="type">int</span> c, pvec b)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!deg) &#123;*b = *a; <span class="keyword">return</span>;&#125;</span><br><span class="line">		<span class="type">int</span> i; u64 pc = <span class="number">1</span>; <span class="built_in">NTT_init</span>(<span class="built_in">lg2</span>(deg) + <span class="number">2</span>);</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= deg; ++i) M1[i] = (u64)a[i] * fact[i] % mod;</span><br><span class="line">		<span class="built_in">memset</span>(M1 + i, <span class="number">0</span>, (n - i) &lt;&lt; <span class="number">2</span>);</span><br><span class="line">		<span class="keyword">for</span> (i = deg; i &gt;= <span class="number">0</span>; --i, pc = pc * c % mod) M2[i] = finv[deg - i] * pc % mod;</span><br><span class="line">		<span class="built_in">DIF</span>(M1), <span class="built_in">DIF</span>(M2);</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) M1[i] = (u64)M1[i] * M2[i] % mod;</span><br><span class="line">		<span class="built_in">DIT</span>(M1);</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= deg; ++i) b[i] = M1[n - deg - i] * iv % mod * finv[i] % mod;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// compute a(1), a(z), a(z^2), ..., a(z^(len-1)) to b</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">czt</span><span class="params">(<span class="type">int</span> deg, <span class="type">int</span> len, <span class="type">int</span> z, pvec a, pvec b)</span> </span>&#123;</span><br><span class="line">		<span class="type">int</span> i; u64 iz = <span class="built_in">PowerMod</span>(z, mod - <span class="number">2</span>);</span><br><span class="line">		<span class="keyword">if</span> (!len) <span class="keyword">return</span>;</span><br><span class="line">		<span class="keyword">if</span> (!deg || !z) <span class="keyword">return</span> std::<span class="built_in">fill</span>(b, b + len, *a);</span><br><span class="line">		<span class="built_in">NTT_init</span>(<span class="built_in">lg2</span>(deg + len - <span class="number">1</span>) + <span class="number">1</span>);</span><br><span class="line">		M1[<span class="number">1</span>] = *M1 = M3[<span class="number">1</span>] = *M3 = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">2</span>; i &lt; deg + len; ++i) M1[i] = M1[i - <span class="number">1</span>] * (u64)z % mod, M3[i] = M3[i - <span class="number">1</span>] * iz % mod;</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">2</span>; i &lt; deg + len; ++i) M1[i] = (u64)M1[i] * M1[i - <span class="number">1</span>] % mod, M3[i] = (u64)M3[i] * M3[i - <span class="number">1</span>] % mod;</span><br><span class="line">		<span class="built_in">memset</span>(M1 + i, <span class="number">0</span>, (n - i) &lt;&lt; <span class="number">2</span>);</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= deg; ++i) M2[deg - i] = (u64)M3[i] * a[i] % mod;</span><br><span class="line">		<span class="built_in">memset</span>(M2 + i, <span class="number">0</span>, (n - i) &lt;&lt; <span class="number">2</span>),</span><br><span class="line">		<span class="built_in">DIF</span>(M1), <span class="built_in">DIF</span>(M2);</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) M1[i] = (u64)M1[i] * M2[i] % mod;</span><br><span class="line">		<span class="built_in">DIT</span>(M1);</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; ++i) b[i] = M1[n - deg - i] * iv % mod * M3[i] % mod;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">inline</span> <span class="type">int</span> __builtin_inner(<span class="type">int</span> len, pvec a, pvec b) &#123;</span><br><span class="line">		<span class="type">int</span> i = <span class="number">0</span>; u64 ans = <span class="number">0</span>;</span><br><span class="line">		<span class="meta">#<span class="keyword">define</span> term(k) (u64)a[i + k] * b[i + k]</span></span><br><span class="line">		<span class="keyword">for</span> (; i + <span class="number">15</span> &lt; len; i += <span class="number">16</span>) &#123;</span><br><span class="line">			ans = (ans + <span class="built_in">term</span>(<span class="number">0</span>) + <span class="built_in">term</span>(<span class="number">1</span>) + <span class="built_in">term</span>(<span class="number">2</span>) + <span class="built_in">term</span>(<span class="number">3</span>)</span><br><span class="line">					   + <span class="built_in">term</span>(<span class="number">4</span>) + <span class="built_in">term</span>(<span class="number">5</span>) + <span class="built_in">term</span>(<span class="number">6</span>) + <span class="built_in">term</span>(<span class="number">7</span>)</span><br><span class="line">					   + <span class="built_in">term</span>(<span class="number">8</span>) + <span class="built_in">term</span>(<span class="number">9</span>) + <span class="built_in">term</span>(<span class="number">10</span>) + <span class="built_in">term</span>(<span class="number">11</span>)</span><br><span class="line">					   + <span class="built_in">term</span>(<span class="number">12</span>) + <span class="built_in">term</span>(<span class="number">13</span>) + <span class="built_in">term</span>(<span class="number">14</span>) + <span class="built_in">term</span>(<span class="number">15</span>)</span><br><span class="line">				) % mod;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="meta">#<span class="keyword">undef</span> term</span></span><br><span class="line">		<span class="keyword">for</span> (; i &lt; len; ++i) ans += (u64)a[i] * b[i];</span><br><span class="line">		<span class="keyword">return</span> ans % mod;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// compositional inverse</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">cinv</span><span class="params">(<span class="type">int</span> deg, pvec a, pvec b)</span> </span>&#123;</span><br><span class="line">		<span class="built_in">assert</span>(!*a), *b = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span> (--deg &lt;= <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">		<span class="type">int</span> i, j, k, d, B, *c;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">NTT_init</span>(<span class="built_in">lg2</span>(<span class="number">2</span> * deg - <span class="number">1</span>)),</span><br><span class="line">		<span class="built_in">memcpy</span>(M1, a + <span class="number">1</span>, deg &lt;&lt; <span class="number">2</span>), <span class="built_in">memset</span>(M1 + deg, <span class="number">0</span>, (n - deg) &lt;&lt; <span class="number">2</span>),</span><br><span class="line">		poly::<span class="built_in">inv</span>(deg, M1, M2),</span><br><span class="line"></span><br><span class="line">		<span class="built_in">NTT_init</span>(<span class="built_in">lg2</span>(<span class="number">2</span> * deg - <span class="number">1</span>) + <span class="number">1</span>),</span><br><span class="line">		<span class="built_in">memset</span>(M2 + deg, <span class="number">0</span>, (n - deg) &lt;&lt; <span class="number">2</span>),</span><br><span class="line"></span><br><span class="line">		<span class="built_in">DIF</span>(M2, M1), B = <span class="built_in">sqrt</span>(deg),</span><br><span class="line">		<span class="built_in">memset</span>(*Ma, <span class="number">0</span>, n &lt;&lt; <span class="number">2</span>), **Ma = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">1</span>; j &lt;= B; ++j) &#123;</span><br><span class="line">			<span class="built_in">DIF</span>(Ma[j - <span class="number">1</span>], M3), c = Ma[j];</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) M3[i] = (u64)M3[i] * M1[i] % mod;</span><br><span class="line">			<span class="built_in">DIT</span>(M3), *c = *M3 * iv % mod;</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; deg; ++i) c[i] = M3[n - i] * iv % mod;</span><br><span class="line">			<span class="built_in">memset</span>(c + i, <span class="number">0</span>, (n - i) &lt;&lt; <span class="number">2</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">DIF</span>(Ma[B], M1), <span class="built_in">memset</span>(M3, <span class="number">0</span>, n &lt;&lt; <span class="number">2</span>), *M3 = M4[deg - <span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (d = <span class="number">0</span>; ; ) &#123;</span><br><span class="line">			<span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; B &amp;&amp; d &lt; deg; ++k, ++d)</span><br><span class="line">				b[d + <span class="number">1</span>] = (u64)__builtin_inner(d + <span class="number">1</span>, Ma[k + <span class="number">1</span>], M4 + (deg - d - <span class="number">1</span>)) * inv[d + <span class="number">1</span>] % mod;</span><br><span class="line">			<span class="keyword">if</span> (d &gt;= deg) <span class="keyword">break</span>;</span><br><span class="line">			<span class="built_in">DIF</span>(M3);</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) M3[i] = (u64)M3[i] * M1[i] % mod;</span><br><span class="line">			<span class="built_in">DIT</span>(M3), *M3 = *M3 * iv % mod;</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; deg; ++i) M3[i] = M3[n - i] * iv % mod;</span><br><span class="line">			<span class="built_in">memset</span>(M3 + i, <span class="number">0</span>, (n - i) &lt;&lt; <span class="number">2</span>),</span><br><span class="line">			std::<span class="built_in">reverse_copy</span>(M3, M3 + deg, M4);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="生成函数"><a href="#生成函数" class="headerlink" title="生成函数"></a>生成函数</h2><h3 id="普通生成函数"><a href="#普通生成函数" class="headerlink" title="普通生成函数"></a>普通生成函数</h3><h4 id="单下标序列普通型生成函数"><a href="#单下标序列普通型生成函数" class="headerlink" title="单下标序列普通型生成函数"></a>单下标序列普通型生成函数</h4><p>$$<br>A(x)&#x3D; \sum_{n&#x3D;0}^{\infty} a_{n}x^{n}<br>$$</p>
<p>$$<br>A(x_{1},x_{2})&#x3D; \sum_{n&#x3D;0}^{\infty} a_{n,m}x_{1}^{n}x_{2}^{m}<br>$$</p>
<p>$$<br>\frac{1}{1-x}&#x3D; \sum_{i&#x3D;0}^{\infty} x^{i}<br>$$</p>
<p>$$<br>ln(1+x)&#x3D; \sum_{i&#x3D;0}^{\infty}(-1)^{i} \frac{x^{i+1}}{i+1}<br>$$</p>
<p>$$<br>(1+x)^{n}&#x3D; \sum_{i&#x3D;0}^{\infty} a^{i} \frac{x^{i}}{i!}<br>$$</p>
<p>$$<br>sin(x)&#x3D; \sum_{i&#x3D;0}^{\infty}(-1)^{i} \frac{x^{2i+1}}{(2i+1)!}<br>$$</p>
<p>$$<br>cos(x)&#x3D; \sum_{i&#x3D;0}^{\infty} (-1)^{i} \frac{x^{2i}}{(2i)!}<br>$$</p>
<h3 id="指数型生成函数"><a href="#指数型生成函数" class="headerlink" title="指数型生成函数"></a>指数型生成函数</h3><h4 id="一般形式"><a href="#一般形式" class="headerlink" title="一般形式"></a>一般形式</h4><p>$$<br>G(x)&#x3D; \sum_{i&#x3D;0}^{\infty} a_{i} \frac{x^{i}}{i!}<br>$$</p>
<p>$$<br>F(x)&#x3D; \sum_{i&#x3D;0}^{\infty} b_{i} \frac{x^{i}}{i!}<br>$$</p>
<p>$$<br>F(x) \times G(x) &#x3D; (\sum_{i&#x3D;0}^{\infty}a_{i} \frac{x^{i}}{i!})(\sum_{i&#x3D;0}^{\infty} b_{i} \frac{x^{i}}{i!}) &#x3D; \sum_{n&#x3D;0}^{\infty} (\sum_{i&#x3D;0}^{\infty}\frac{a_i x^{i}}{i!} \times \frac{b_{n-i}x^{n-i}}{(n-i)!})x^{n} &#x3D; \sum_{n&#x3D;0} ^{\infty} (\sum_{i&#x3D;0}^{\infty}\binom{n}{i}a_{i} b_{n-i}) \frac{x^{n}}{n!} F(x) \cdot G(x)<br>$$</p>
<h4 id="指数型生成函数常用公式"><a href="#指数型生成函数常用公式" class="headerlink" title="指数型生成函数常用公式"></a>指数型生成函数常用公式</h4><p>$$<br>e^x &#x3D; \sum_{i&#x3D;0}^{\infty} \frac{x^i}{i!} &#x3D; 1 + x + \frac{x^2}{2!} + \frac{x^3}{3!} + \frac{x^4}{4!} + \cdots + \frac{x^n}{n!} + \cdots<br>$$</p>
<p>$$<br>\frac{e^x + e^{-x}}{2} &#x3D; \sum_{i&#x3D;0}^{\infty} \frac{x^{2i}}{(2i)!}<br>$$</p>
<p>$$<br>\frac{e^x - e^{-x}}{2} &#x3D; \sum_{i&#x3D;0}^{\infty} \frac{x^{2i+1}}{(2i+1)!}<br>$$</p>
<h3 id="二项式定理"><a href="#二项式定理" class="headerlink" title="二项式定理"></a>二项式定理</h3><p>$$<br>(x + 1)^n &#x3D; \sum_{i&#x3D;0}^{n} \binom{n}{i} x^i<br>$$</p>
<p>$$<br>(1 + x)^{-n} &#x3D; \frac{1}{(1 + x)^{n}} &#x3D; \sum_{i&#x3D;0}^{\infty} \binom{i-n}{i} x^i &#x3D; \sum_{i&#x3D;0}^{\infty} (-1)^i \binom{n+i-1}{i} x^i<br>$$</p>
<p>$$<br>(1 - x)^n &#x3D; \sum_{i&#x3D;0}^{\infty} (-1)^i \binom{n}{i} x^i (1 - x)^n &#x3D; \sum_{i&#x3D;0}^{\infty} (-1)^i \binom{n}{i} x^i<br>$$</p>
<p>$$<br>(x + y)^n &#x3D; \sum_{i&#x3D;0}^{n} \binom{n}{i} a^i b^{n-i}<br>$$</p>
<p>$$<br>\frac{1}{(1 - x)^n} &#x3D; \sum_{i&#x3D;0}^{\infty} \binom{n+i-1}{i} x^i<br>$$</p>
<h2 id="博弈论"><a href="#博弈论" class="headerlink" title="博弈论"></a>博弈论</h2><h3 id="巴什博弈"><a href="#巴什博弈" class="headerlink" title="巴什博弈"></a>巴什博弈</h3><p>一堆石子n个，每次最少取一个，最多取m个，先手必胜点为n%(m+1)!&#x3D;0</p>
<h3 id="NIM博弈"><a href="#NIM博弈" class="headerlink" title="NIM博弈"></a>NIM博弈</h3><p>N堆物品，第i堆物品有Ai个。两名玩家轮流行动，每次可以任选一堆，取走任意多个物品，可把一堆取光，但不能不取。取走最后一件物品者获胜，其先手必胜点为所有对取异或不为0</p>
<h3 id="威佐夫博弈"><a href="#威佐夫博弈" class="headerlink" title="威佐夫博弈"></a>威佐夫博弈</h3><p>有两堆各若干个物品，两个人轮流从任意一堆中取出至少一个或者同时从两堆中取出同样多的物品，规定每次至少取一个，至多不限，最后取光者胜利。则是奇异局势先手输，</p>
<p>奇异局势局势的第一个值是未在前面出现过的最小的自然数。</p>
<p>继续分析我们会发现，每种奇异局势的第一个值(这里假设第一堆数目小于第二堆的数目)总是等于当前局势的差值乘上1.618，而1.618 &#x3D; (sqrt(5.0) + 1) &#x2F; 2</p>
<h3 id="sg函数"><a href="#sg函数" class="headerlink" title="sg函数"></a>sg函数</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e4</span> + <span class="number">5</span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">getsg</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(sg, <span class="number">0</span>, <span class="built_in">sizeof</span>(sg));</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= N; i++) &#123;</span><br><span class="line">		<span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="built_in">sizeof</span>(s));</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">2</span>; j &lt;= <span class="number">24</span> &amp;&amp; dp[j] &lt;= i; j++) &#123;这里的df[i]为每次可以取走的个数</span><br><span class="line">			s[sg[i - dp[j]]] = <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt;= N; j++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (!s[j]) &#123;</span><br><span class="line">				sg[i] = j;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="组合数学"><a href="#组合数学" class="headerlink" title="组合数学"></a>组合数学</h2><h3 id="组合数计算"><a href="#组合数计算" class="headerlink" title="组合数计算"></a>组合数计算</h3><h4 id="数据a，b均小于2000"><a href="#数据a，b均小于2000" class="headerlink" title="数据a，b均小于2000"></a>数据a，b均小于2000</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> MOD = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2e3</span> + <span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> c[N][N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt;= i; j++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (!j) c[i][j] = <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">else</span> c[i][j] = (c[i - <span class="number">1</span>][j] + c[i - <span class="number">1</span>][j - <span class="number">1</span>]) % MOD;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> a,b;</span><br><span class="line">    cin &gt;&gt; a &gt;&gt; b;</span><br><span class="line">	cout &lt;&lt; c[a][b] &lt;&lt; endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="数据在1e5以内"><a href="#数据在1e5以内" class="headerlink" title="数据在1e5以内"></a>数据在1e5以内</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> f[N], inf[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ksm</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> m)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (b &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>)  ans = (ans * a) % m;</span><br><span class="line">        b = b &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        a = (a * a) % m;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    f[<span class="number">0</span>] = inf[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; N; i++) &#123;</span><br><span class="line">        f[i] = f[i - <span class="number">1</span>] * i % MOD;</span><br><span class="line">        inf[i] = inf[i - <span class="number">1</span>] * <span class="built_in">ksm</span>(i, MOD - <span class="number">2</span>, MOD) % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">C</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> f[a] * inf[b] % MOD * inf[a - b] % MOD;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="数据达到1e18"><a href="#数据达到1e18" class="headerlink" title="数据达到1e18"></a>数据达到1e18</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> LL;</span><br><span class="line"><span class="function">LL <span class="title">ksm</span><span class="params">(LL a, LL b, LL c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	LL ans = <span class="number">1</span>;<span class="comment">//最后答案在ans</span></span><br><span class="line">	<span class="keyword">while</span> (b &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (b &amp; <span class="number">1</span>)<span class="comment">//b是奇数的话会出现一个a</span></span><br><span class="line">		&#123;</span><br><span class="line">			ans = ans * a % c;</span><br><span class="line">		&#125;</span><br><span class="line">		b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">		a = (a * a) % c;<span class="comment">//b变一半所以a就要平方了</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">LL <span class="title">C</span><span class="params">(LL n, LL m, LL MOD)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (m &gt; n) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	m = <span class="built_in">min</span>(m, n - m);</span><br><span class="line">	LL a = <span class="number">1</span>, b = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span> (m) &#123;</span><br><span class="line">		a = a * n % MOD;</span><br><span class="line">		b = b * m % MOD;</span><br><span class="line">		n--;</span><br><span class="line">		m--;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> a * <span class="built_in">ksm</span>(b, MOD - <span class="number">2</span>, MOD) % MOD;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">LL <span class="title">lucas</span><span class="params">(LL n, LL m, LL p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (m == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">C</span>(n % p, m % p, p) * <span class="built_in">lucas</span>(n / p, m / p, p) % p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	LL a, b;</span><br><span class="line">	cin &gt;&gt; a &gt;&gt; b &gt;&gt; m;</span><br><span class="line">	cout &lt;&lt; <span class="built_in">lucas</span>(a, b) &lt;&lt; endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="扩展卢卡斯定理"><a href="#扩展卢卡斯定理" class="headerlink" title="扩展卢卡斯定理"></a>扩展卢卡斯定理</h4><p>用于p为非质数</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">ksm</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (b) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>) ans = ans * a % c;</span><br><span class="line">        b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">        a = a * a % c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">cal</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> p, <span class="type">int</span> pa)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!n) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= pa; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i % p) &#123;</span><br><span class="line">            ans = ans * i % pa;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ans = <span class="built_in">ksm</span>(ans, n / pa, pa);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n % pa; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i % p) &#123;</span><br><span class="line">            ans = ans * i % pa;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans * <span class="built_in">cal</span>(n / p, p, pa) % pa;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">cnt_p</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> m, <span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = p; i &lt;= n; i *= p) &#123;</span><br><span class="line">        cnt += n / i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = p; i &lt;= m; i *= p) &#123;</span><br><span class="line">        cnt -= m / i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = p; i &lt;= n - m; i *= p) &#123;</span><br><span class="line">        cnt -= (n - m) / i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cnt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> x, y;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">exgcd</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!b) &#123;</span><br><span class="line">        x = <span class="number">1</span>, y = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">exgcd</span>(b, a % b);</span><br><span class="line">    <span class="type">int</span> tmp = x;</span><br><span class="line">    x = y;</span><br><span class="line">    y = tmp - a / b * y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">inv</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">exgcd</span>(a, p);</span><br><span class="line">    x = (x % p + p) % p;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">C</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> m, <span class="type">int</span> p, <span class="type">int</span> pa)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> a = <span class="built_in">cal</span>(n, p, pa), b = <span class="built_in">cal</span>(m, p, pa), c = <span class="built_in">cal</span>(n - m, p, pa), cnt = <span class="built_in">cnt_p</span>(n, m, p);</span><br><span class="line">    <span class="keyword">return</span> a * <span class="built_in">inv</span>(b, pa) % pa * <span class="built_in">inv</span>(c, pa) % pa * <span class="built_in">ksm</span>(p, cnt, pa) % pa;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a[<span class="number">10</span>], b[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">CRT</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> m = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        m *= a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="type">int</span> mi = m / a[i];</span><br><span class="line">        <span class="type">int</span> Mi = <span class="built_in">inv</span>(mi, a[i]);</span><br><span class="line">        ans = (ans + b[i] * mi % m * Mi % m) % m;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">exLucas</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> m, <span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> k = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i * i &lt;= p; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (p % i == <span class="number">0</span>) &#123;</span><br><span class="line">            a[++k] = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span> (p % i == <span class="number">0</span>) &#123;</span><br><span class="line">                a[k] *= i;</span><br><span class="line">                p /= i;</span><br><span class="line">            &#125;</span><br><span class="line">            b[k] = <span class="built_in">C</span>(n, m, i, a[k]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (p &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        a[++k] = p;</span><br><span class="line">        b[k] = <span class="built_in">C</span>(n, m, p, p);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">CRT</span>(k);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="高精度组合数"><a href="#高精度组合数" class="headerlink" title="高精度组合数"></a>高精度组合数</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span><span class="number">+10</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> primes[N],co;</span><br><span class="line"><span class="type">bool</span> st[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">p</span><span class="params">(<span class="type">int</span> n)</span>  <span class="comment">//筛选出所有互质的数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	co=<span class="number">0</span>;	</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(!st[i]) primes[co++]=i;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;primes[j]&lt;=n/i;j++)</span><br><span class="line">		&#123;</span><br><span class="line">			st[primes[j]*i]=<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">if</span>(i % primes[j]==<span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">calc</span><span class="params">(<span class="type">int</span> n,<span class="type">int</span> pr)</span>   <span class="comment">//计算每一个数的阶乘具有多少个primes[i]</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> s=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(n&gt;<span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		s+=n/pr;</span><br><span class="line">		n/=pr;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">mul</span><span class="params">(vector&lt;<span class="type">int</span>&gt; a,<span class="type">int</span> b)</span> <span class="comment">//高精度乘法</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	vector&lt;<span class="type">int</span>&gt; c;</span><br><span class="line">	<span class="type">int</span> t=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;a.<span class="built_in">size</span>();i++)</span><br><span class="line">	&#123;</span><br><span class="line">		t+=a[i]*b;</span><br><span class="line">		c.<span class="built_in">push_back</span>(t%<span class="number">10</span>);</span><br><span class="line">		t/=<span class="number">10</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span>(t)</span><br><span class="line">	&#123;</span><br><span class="line">		c.<span class="built_in">push_back</span>(t%<span class="number">10</span>);</span><br><span class="line">		t/=<span class="number">10</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">		<span class="type">int</span> a,b; </span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;a,&amp;b);</span><br><span class="line">		<span class="built_in">p</span>(a);</span><br><span class="line">		<span class="type">int</span> num[N];</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;co;i++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="type">int</span> pr = primes[i];</span><br><span class="line">			num[i] = <span class="built_in">calc</span>(a,pr) - <span class="built_in">calc</span>(b,pr) - <span class="built_in">calc</span>(a-b,pr); </span><br><span class="line">		&#125;</span><br><span class="line">		vector&lt;<span class="type">int</span>&gt; ans;</span><br><span class="line">		ans.<span class="built_in">push_back</span>(<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;co;i++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">while</span>(num[i]--) ans = <span class="built_in">mul</span>(ans,primes[i]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=ans.<span class="built_in">size</span>()<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--) <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,ans[i]);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="多重集的排列组合"><a href="#多重集的排列组合" class="headerlink" title="多重集的排列组合"></a>多重集的排列组合</h3><ol>
<li>排列数</li>
<li><ol>
<li>排列数 r &#x3D; n 则$\ N &#x3D; \frac{n!}{n_{1}!n_{2}!n_{3}!****n_{k}!}$</li>
<li>排列数（r &lt;&#x3D; 每一个$\ n_{i} $） 则  $ N&#x3D;k^r$</li>
</ol>
</li>
<li>组合数 （r &lt;&#x3D; 每一个$\ n_{i} $）$\ N &#x3D; C(k+r-1,r) $</li>
</ol>
<h1 id="群论"><a href="#群论" class="headerlink" title="群论"></a>群论</h1><h3 id="两种模型"><a href="#两种模型" class="headerlink" title="两种模型"></a>两种模型</h3><h4 id="旋转同构"><a href="#旋转同构" class="headerlink" title="旋转同构"></a>旋转同构</h4><p>仅适用于二维</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n, M, ans;</span><br><span class="line"><span class="type">int</span> a[N], m[N];</span><br><span class="line"><span class="function"><span class="type">int</span></span></span><br><span class="line"><span class="function"><span class="title">ksc</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (b) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>) ans = (ans + a) % c;</span><br><span class="line">        b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">        a = (a + a) % c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">exgcd</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> &amp;x, <span class="type">int</span> &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!b) &#123;</span><br><span class="line">        x = <span class="number">1</span>, y = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> d = <span class="built_in">exgcd</span>(b, a % b, y, x);</span><br><span class="line">    y -= a / b * x;</span><br><span class="line">    <span class="keyword">return</span> d;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">excrt</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    M = m[<span class="number">1</span>], ans = a[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> p = ((a[i] - ans) % m[i] + m[i]) % m[i];</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> x = <span class="number">0</span>, y = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> d = <span class="built_in">exgcd</span>(M, m[i], x, y);</span><br><span class="line">        <span class="keyword">if</span> (p % d) <span class="keyword">return</span> <span class="number">-1</span>;<span class="comment">//无解    </span></span><br><span class="line">        x = <span class="built_in">ksc</span>(x, p / d, m[i] / d);</span><br><span class="line">        ans += x * M;</span><br><span class="line">        M *= m[i] / d;</span><br><span class="line">        ans = (ans % M + M) % M;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (ans % M + M) % M;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>循环个数为gcd(n,k)，其中n为项链长度，旋转需要移动的k步，根据Polya定理有：<br>$$<br>ans&#x3D;\frac{1}{n}\sum_{i&#x3D;0}^{n-1} k^{gcd(i,n)}<br>$$</p>
<h4 id="翻转同构"><a href="#翻转同构" class="headerlink" title="翻转同构"></a>翻转同构</h4><p>翻转置换群大小为n（偶数时两种情况）</p>
<p>eg：若一个项链可以通过另一个项链翻转得到，那么认为这两个项链为同一种项链</p>
<p>分奇偶讨论：</p>
<ol>
<li><p>奇数</p>
<p>一定要有一个点在对称轴上，所以一共n条对称轴，共 $$ \frac{n+1}{2} $$ 个循环</p>
</li>
<li><p>偶数</p>
<ol>
<li><p>按边对称（即没有点在对称轴上）</p>
<p>共有$$ \frac{n}{2} $$ 条对称轴， 形成$$ \frac{n}{2} $$个循环</p>
</li>
<li><p>按点对称（即两个点在对称轴上）</p>
<p>共有$$ \frac{n}{2} $$条对称轴，形成$$ \frac{n + 2}{2} $$个循环</p>
</li>
</ol>
</li>
</ol>
<h3 id="对称同构"><a href="#对称同构" class="headerlink" title="对称同构"></a>对称同构</h3><p>即为旋转同构+翻转同构，Polya定理代码如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//一定要手写求幂，pow函数在3^34时出错</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> LL;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">double</span> LD;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int LL</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> double LD</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> endl <span class="string">&quot;\n&quot;</span></span></span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; PII;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> PI = <span class="built_in">acosl</span>(<span class="number">-1.0</span>);</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> eps = <span class="number">1e-8</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">gcd</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!b) <span class="keyword">return</span> a;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">gcd</span>(b, a % b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ksm</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (b) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>) ans = ans * a;</span><br><span class="line">        b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">        a = a * a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n, m;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">0</span>) &#123;</span><br><span class="line">        cout &lt;&lt; <span class="number">0</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        ans += <span class="built_in">ksm</span>(m, <span class="built_in">gcd</span>(n, i));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (n &amp; <span class="number">1</span>) &#123;</span><br><span class="line">        ans += <span class="built_in">ksm</span>(m, (n + <span class="number">1</span>) / <span class="number">2</span>) * n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        ans += <span class="built_in">ksm</span>(m, n / <span class="number">2</span>) * n / <span class="number">2</span>;</span><br><span class="line">        ans += <span class="built_in">ksm</span>(m, (n + <span class="number">2</span>) / <span class="number">2</span>) * n / <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ans /= (<span class="number">2</span> * n);</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>), cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="type">int</span> _;</span><br><span class="line"><span class="comment">//    cin&gt;&gt;_;</span></span><br><span class="line">    _ = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (_--) &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="置换群快速幂"><a href="#置换群快速幂" class="headerlink" title="置换群快速幂"></a>置换群快速幂</h3><p>结论一：长度为l的循环T，若l是k的倍数，那么$$ T^{k} $$为k个循环的乘积，且这k个循环分别是原循环T中下标$$ mod k&#x3D;0,1,2,…,$$（即$$ mod k$$的结果分组，每组为一个循环）</p>
<p>结论二：长度为l的循环T，若$$ gcd(l,k)&#x3D;1$$ ,那么 $$ T^{k} $$为一个循环</p>
<p>结论三：长度为l的循环T，$$ T^{k} $$是$$ gcd(l,k)$$个循环的乘积，每个循环为原循环T中下标 $$ mod k&#x3D;0,1,2,…,$$(按结果分组，每组一个循环，仅仅是由这些元素组成，并不是说还是这个顺序)</p>
<p>定理：设 $$ a&#x3D;T,a^{‘}&#x3D;T^{k},且gcd(l,k)&#x3D;1,则 a^{‘}[i]&#x3D;a[(k+1)<em>i % l]$$ (下标范围0 ≤ i ≤ l-1) ，我认为应该是 $$ a^{‘}[i]&#x3D;a[k</em>i % l] $$</p>
<h1 id="计算几何"><a href="#计算几何" class="headerlink" title="计算几何"></a>计算几何</h1><h2 id="自适应辛普森积分"><a href="#自适应辛普森积分" class="headerlink" title="自适应辛普森积分"></a>自适应辛普森积分</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">double</span> <span class="title">f</span><span class="params">(<span class="type">double</span> x)</span><span class="comment">//原函数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> ;<span class="comment">//这里写原函数f(x)表达式</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">simpson</span><span class="params">(<span class="type">double</span> l, <span class="type">double</span> r)</span> <span class="comment">//Simpson公式</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">double</span> mid = (l + r) / <span class="number">2</span>;</span><br><span class="line">	<span class="keyword">return</span> (<span class="built_in">f</span>(l) + <span class="number">4</span> * <span class="built_in">f</span>(mid) + <span class="built_in">f</span>(r)) * (r - l) / <span class="number">6</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">asr</span><span class="params">(<span class="type">double</span> l, <span class="type">double</span> r, <span class="type">double</span> eps, <span class="type">double</span> tmp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">double</span> mid = (l + r) / <span class="number">2</span>;</span><br><span class="line">	<span class="type">double</span> ll = <span class="built_in">simpson</span>(l, mid), rr = <span class="built_in">simpson</span>(mid, r);</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">fabs</span>(ll + rr - tmp) &lt;= <span class="number">15</span> * eps) <span class="keyword">return</span> ll + rr + (ll + rr - tmp) / <span class="number">15.0</span>;     <span class="comment">//确认精度</span></span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">asr</span>(l, mid, eps / <span class="number">2</span>, ll) + <span class="built_in">asr</span>(mid, r, eps / <span class="number">2</span>, rr);     <span class="comment">//精度不够则递归调用</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    asr(l, r, eps, simpson(l, r))</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h2 id="基础函数及宏定义变量"><a href="#基础函数及宏定义变量" class="headerlink" title="基础函数及宏定义变量"></a>基础函数及宏定义变量</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">5007</span>, M = <span class="number">50007</span>, INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> DINF = <span class="number">1e18</span>, eps = <span class="number">1e-8</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> PI = <span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span> &#123;<span class="comment">//二维点</span></span><br><span class="line">  <span class="type">double</span> x, y;</span><br><span class="line">  <span class="built_in">Point</span>(<span class="type">double</span> x = <span class="number">0</span>, <span class="type">double</span> y = <span class="number">0</span>) : <span class="built_in">x</span>(x), <span class="built_in">y</span>(y) &#123;&#125;<span class="comment">//构造函数</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">typedef</span> Point Vector;</span><br><span class="line"><span class="comment">//向量 + 向量 = 向量，点 + 向量 = 向量</span></span><br><span class="line">Vector <span class="keyword">operator</span>+(Vector A, Vector B) &#123; <span class="keyword">return</span> <span class="built_in">Vector</span>(A.x + B.x, A.y + B.y); &#125;</span><br><span class="line"><span class="comment">//点 - 点 = 向量(向量BC = C - B)</span></span><br><span class="line">Vector <span class="keyword">operator</span>-(Point A, Point B) &#123; <span class="keyword">return</span> <span class="built_in">Vector</span>(A.x - B.x, A.y - B.y); &#125;</span><br><span class="line"><span class="comment">//向量 * 数 = 向量</span></span><br><span class="line">Vector <span class="keyword">operator</span>*(Vector A, <span class="type">double</span> p) &#123; <span class="keyword">return</span> <span class="built_in">Vector</span>(A.x * p, A.y * p); &#125;</span><br><span class="line"><span class="comment">//向量 / 数= 向量</span></span><br><span class="line">Vector <span class="keyword">operator</span>/(Vector A, <span class="type">double</span> p) &#123; <span class="keyword">return</span> <span class="built_in">Vector</span>(A.x / p, A.y / p); &#125;</span><br><span class="line"><span class="comment">//点/向量的比较函数</span></span><br><span class="line"><span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> Point &amp;a, <span class="type">const</span> Point &amp;b) &#123; <span class="keyword">return</span> a.x &lt; b.x || (a.x == b.x &amp;&amp; a.y &lt; b.y); &#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Line</span> &#123;<span class="comment">//直线定义</span></span><br><span class="line">  Vector v;</span><br><span class="line">  Point p;</span><br><span class="line">  <span class="built_in">Line</span>() &#123;&#125;</span><br><span class="line">  <span class="built_in">Line</span>(Vector v, Point p) : <span class="built_in">v</span>(v), <span class="built_in">p</span>(p) &#123;&#125;</span><br><span class="line">  <span class="function">Point <span class="title">get_point_in_line</span><span class="params">(<span class="type">double</span> t)</span></span></span><br><span class="line"><span class="function">  </span>&#123;<span class="comment">//返回直线上一点P = p + v * t</span></span><br><span class="line">      <span class="keyword">return</span> p + v * t;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//单位弧度rad</span></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">Polar_angle</span><span class="params">(Vector A)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">atan2</span>(A.y, A.x); &#125;</span><br><span class="line"><span class="comment">//角度转弧度</span></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">torad</span><span class="params">(<span class="type">double</span> deg)</span> </span>&#123; <span class="keyword">return</span> deg / <span class="number">180</span> * PI; &#125;</span><br><span class="line"><span class="comment">//判断相等</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">sgn</span><span class="params">(<span class="type">double</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//也是dcmp</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">fabs</span>(x) &lt; eps)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//重载等于运算符</span></span><br><span class="line"><span class="type">bool</span> <span class="keyword">operator</span>==(<span class="type">const</span> Point &amp;a, <span class="type">const</span> Point &amp;b) &#123; <span class="keyword">return</span> !<span class="built_in">sgn</span>(a.x - b.x) &amp;&amp; !<span class="built_in">sgn</span>(a.y - b.y); &#125;</span><br><span class="line"><span class="comment">//点积(满足交换律)</span></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">Dot</span><span class="params">(Vector A, Vector B)</span> </span>&#123; <span class="keyword">return</span> A.x * B.x + A.y * B.y; &#125;</span><br><span class="line"><span class="comment">//向量的叉积(不满足交换律)</span></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">Cross</span><span class="params">(Vector A, Vector B)</span> </span>&#123; <span class="keyword">return</span> A.x * B.y - B.x * A.y; &#125;</span><br><span class="line"><span class="comment">//计算两点距离距离</span></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">dis</span><span class="params">(Vector a, Vector b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sqrt</span>((a.x - b.x) * (a.x - b.x) * <span class="number">1.0</span> + (a.y - b.y) * (a.y - b.y));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//极角排序</span></span><br><span class="line"><span class="comment">//1.atan2排序，atan2(y,x)函数返回点(x,y)与原点连线与x轴正方向之间的夹角，[-pi,pi]</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp1</span><span class="params">(Point A, Point B)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">sgn</span>(<span class="built_in">atan2</span>(A.y, A.x) - <span class="built_in">atan2</span>(B.y, B.x)) != <span class="number">0</span>) <span class="keyword">return</span> <span class="built_in">atan2</span>(A.y, A.x) &lt; <span class="built_in">atan2</span>(B.y, B.x);</span><br><span class="line">    <span class="keyword">return</span> A.x &lt; B.x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//2.叉积排序（需要选定基准点P）</span></span><br><span class="line">Point Pole;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Compare</span><span class="params">(Point A, Point B)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">sgn</span>(<span class="built_in">Cross</span>(A - Pole, B - Pole)) == <span class="number">0</span>) <span class="keyword">return</span> A.x &lt; B.x;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Cross</span>(A - Pole, B - Pole) &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//3. 象限排序 原因：叉积排序是不能排序360度的。</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Quadrant</span><span class="params">(Point A)</span><span class="comment">//返回所在象限</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (A.x &gt; <span class="number">0</span> &amp;&amp; A.y &gt;= <span class="number">0</span>)<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (A.x &lt;= <span class="number">0</span> &amp;&amp; A.y &gt; <span class="number">0</span>)<span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (A.x &lt; <span class="number">0</span> &amp;&amp; A.y &lt;= <span class="number">0</span>)<span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">if</span> (A.x &gt;= <span class="number">0</span> &amp;&amp; A.y &lt; <span class="number">0</span>)<span class="keyword">return</span> <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp2</span><span class="params">(Point A, Point B)</span> <span class="comment">//以原点为极点，先按照象限排序</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Quadrant</span>(A) == <span class="built_in">Quadrant</span>(B))</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">cmp1</span>(A, B);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">Quadrant</span>(A) &lt; <span class="built_in">Quadrant</span>(B);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//判断向量bc是不是向ab的逆时针方向（左边）</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">ToLeftTest</span><span class="params">(Point a, Point b, Point c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Cross</span>(b - a, c - b) &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//取模（模长，求长度）</span></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">Length</span><span class="params">(Vector A)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">sqrt</span>(<span class="built_in">Dot</span>(A, A)); &#125;</span><br><span class="line"><span class="comment">//计算两向量夹角</span></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">Angle</span><span class="params">(Vector A, Vector B)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">acos</span>(<span class="built_in">Dot</span>(A, B) / <span class="built_in">Length</span>(A) / <span class="built_in">Length</span>(B)); &#125;</span><br><span class="line"><span class="comment">// 三角形面积叉乘公式</span></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">Area</span><span class="params">(Point A, Point B, Point C)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">Cross</span>(B - A, C - A) / <span class="number">2</span>; &#125;</span><br><span class="line"><span class="comment">//计算两向量构成的平行四边形有向面积</span></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">Area2</span><span class="params">(Point A, Point B, Point C)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">Cross</span>(B - A, C - A); &#125;</span><br><span class="line"><span class="comment">//计算向量逆时针旋转九十度之后的单位法线（法向量）</span></span><br><span class="line"><span class="function">Vector <span class="title">Normal</span><span class="params">(Vector A)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">double</span> L = <span class="built_in">Length</span>(A);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Vector</span>(-A.y / L, A.x / L);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Vector <span class="title">Format</span><span class="params">(<span class="type">const</span> Vector &amp;A)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">double</span> L = <span class="built_in">Length</span>(A);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Vector</span>(A.x / L, A.y / L);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//计算向量逆时针旋转后的向量</span></span><br><span class="line"><span class="function">Vector <span class="title">Rotate</span><span class="params">(Vector A, <span class="type">double</span> rad)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Vector</span>(A.x * <span class="built_in">cos</span>(rad) - A.y * <span class="built_in">sin</span>(rad), A.x * <span class="built_in">sin</span>(rad) + A.y * <span class="built_in">cos</span>(rad));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//点绕着 p 点逆时针旋转 angle</span></span><br><span class="line"><span class="function">Point <span class="title">rotate</span><span class="params">(Point p, <span class="type">double</span> angle)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Point v = (*<span class="keyword">this</span>) - p;<span class="comment">//这里this不能用，为当前点绕p点的当前点</span></span><br><span class="line">    <span class="type">double</span> c = <span class="built_in">cos</span>(angle), s = <span class="built_in">sin</span>(angle);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Point</span>(p.x + v.x * c - v.y * s, p.y + v.x * s + v.y * c);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Point rotate(Point q, Point p, double angle) &#123;</span></span><br><span class="line"><span class="comment">    Point v = q - p;//这里this不能用，为当前点绕p点的当前点</span></span><br><span class="line"><span class="comment">    double c = cos(angle), s = sin(angle);</span></span><br><span class="line"><span class="comment">    return Point(p.x + v.x * c - v.y * s, p.y + v.x * s + v.y * c);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//将点A绕点B顺时针旋转theta(弧度)</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> Point <span class="title">turn_PP</span><span class="params">(Point a, Point b, <span class="type">double</span> theta)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">double</span> x = (a.x - b.x) * <span class="built_in">cos</span>(theta) + (a.y - b.y) * <span class="built_in">sin</span>(theta) + b.x;</span><br><span class="line">    <span class="type">double</span> y = -(a.x - b.x) * <span class="built_in">sin</span>(theta) + (a.y - b.y) * <span class="built_in">cos</span>(theta) + b.y;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Point</span>(x, y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="复数部分"><a href="#复数部分" class="headerlink" title="复数部分"></a>复数部分</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> complex&lt;<span class="type">double</span>&gt; Point;</span><br><span class="line"><span class="keyword">typedef</span> Point Vector;<span class="comment">//复数定义向量后，自动拥有构造函数、加减法和数量积</span></span><br><span class="line"><span class="type">const</span> <span class="type">double</span> eps = <span class="number">1e-9</span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">sgn</span><span class="params">(<span class="type">double</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">fabs</span>(x) &lt; eps)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">Length</span><span class="params">(Vector A)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">abs</span>(A);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">Dot</span><span class="params">(Vector A, Vector B)</span></span>&#123;<span class="comment">//conj(a+bi)返回共轭复数a-bi</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">real</span>(<span class="built_in">conj</span>(A)*B);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">Cross</span><span class="params">(Vector A, Vector B)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">imag</span>(<span class="built_in">conj</span>(A)*B);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Vector <span class="title">Rotate</span><span class="params">(Vector A, <span class="type">double</span> rad)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> A*<span class="built_in">exp</span>(<span class="built_in">Point</span>(<span class="number">0</span>, rad));<span class="comment">//exp(p)返回以e为底复数的指数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="二维计算几何基础"><a href="#二维计算几何基础" class="headerlink" title="二维计算几何基础"></a>二维计算几何基础</h2><h3 id="点与线"><a href="#点与线" class="headerlink" title="点与线"></a>点与线</h3><h4 id="判断点和直线关系relation"><a href="#判断点和直线关系relation" class="headerlink" title="判断点和直线关系relation"></a>判断点和直线关系relation</h4><p>1 在左侧<br>-1 在右侧<br>0 在直线上 &#x2F;&#x2F;直线上两点s和e<br>A, B:直线上一点,C:待判断关系的点</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">relation</span><span class="params">(Point A, Point B, Point C)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 1 left -1 right 0 in</span></span><br><span class="line">    <span class="type">int</span> c = <span class="built_in">sgn</span>(<span class="built_in">Cross</span>((B - A), (C - A)));</span><br><span class="line">    <span class="keyword">if</span>(c &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(c &gt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="计算两直线交点-Get-line-intersection"><a href="#计算两直线交点-Get-line-intersection" class="headerlink" title="计算两直线交点 Get_line_intersection"></a>计算两直线交点 Get_line_intersection</h4><p>调用前要确保两直线p + tv 和 Q + tw之间有唯一交点，当且仅当Corss(v, w) !&#x3D; 0;（t是参数）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Point <span class="title">Get_line_intersection</span><span class="params">(Point P,Vector v,Point Q,Vector w)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Vector u = P - Q;</span><br><span class="line">	<span class="type">double</span> t = <span class="built_in">Cross</span>(w, u) / <span class="built_in">Cross</span>(v, w);</span><br><span class="line">	<span class="keyword">return</span> P + v * t;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="计算点到直线的距离-Distance-point-to-line"><a href="#计算点到直线的距离-Distance-point-to-line" class="headerlink" title="计算点到直线的距离 Distance_point_to_line"></a>计算点到直线的距离 Distance_point_to_line</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">double</span> <span class="title">Distance_point_to_line</span><span class="params">(Point P, Point A, Point B)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Vector v1 = B - A, v2 = P - A;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">fabs</span>(<span class="built_in">Cross</span>(v1, v2) / <span class="built_in">Length</span>(v1));<span class="comment">//如果不取绝对值，那么得到的是有向距离</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="计算点到线段的距离-Distance-point-to-segment"><a href="#计算点到线段的距离-Distance-point-to-segment" class="headerlink" title="计算点到线段的距离 Distance_point_to_segment"></a>计算点到线段的距离 Distance_point_to_segment</h4><p>垂线距离或者PA或者PB距离</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">double</span> <span class="title">Distance_point_to_segment</span><span class="params">(Point P, Point A, Point B)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(A == B) <span class="keyword">return</span> <span class="built_in">Length</span>(P - A);<span class="comment">//（如果重合那么就是两个点之间的距离，直接转成向量求距离即可）</span></span><br><span class="line">    Vector v1 = B - A, v2 = P - A, v3 = P - B;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">sgn</span>(<span class="built_in">Dot</span>(v1, v2)) &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="built_in">Length</span>(v2);<span class="comment">//A点左边</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">sgn</span>(<span class="built_in">Dot</span>(v1, v3)) &gt; <span class="number">0</span>)<span class="keyword">return</span> <span class="built_in">Length</span>(v3);<span class="comment">//B点右边</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">fabs</span>(<span class="built_in">Cross</span>(v1, v2) / <span class="built_in">Length</span>(v1));<span class="comment">//垂线的距离</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="求点在直线上的投影点-Get-line-projection"><a href="#求点在直线上的投影点-Get-line-projection" class="headerlink" title="求点在直线上的投影点 Get_line_projection"></a>求点在直线上的投影点 Get_line_projection</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Point <span class="title">Get_line_projection</span><span class="params">(Point P, Point A, Point B)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Vector v = B - A;</span><br><span class="line">    <span class="keyword">return</span> A + v * (<span class="built_in">Dot</span>(v, P - A) / <span class="built_in">Dot</span>(v, v));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="计算点-P-到直线-AB-的垂足-FootPoint"><a href="#计算点-P-到直线-AB-的垂足-FootPoint" class="headerlink" title="计算点 P 到直线 AB 的垂足 FootPoint"></a>计算点 P 到直线 AB 的垂足 FootPoint</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> Point <span class="title">FootPoint</span><span class="params">(Point p, Point a, Point b)</span></span>&#123;</span><br><span class="line">    Vector x = p - a, y = p - b, z = b - a;</span><br><span class="line">    <span class="type">double</span> len1 = <span class="built_in">Dot</span>(x, z) / <span class="built_in">Length</span>(z), len2 = - <span class="number">1.0</span> * <span class="built_in">Dot</span>(y, z) / <span class="built_in">Length</span>(z);<span class="comment">//分别计算AP,BP在AB,BA上的投影</span></span><br><span class="line">    <span class="keyword">return</span> a + z * (len1 / (len1 + len2));<span class="comment">//点A加上向量AF</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="计算点到直线的对称点-Symmetry-PL"><a href="#计算点到直线的对称点-Symmetry-PL" class="headerlink" title="计算点到直线的对称点 Symmetry_PL"></a>计算点到直线的对称点 Symmetry_PL</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> Point <span class="title">Symmetry_PL</span><span class="params">(Point p, Point a, Point b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> p + (<span class="built_in">FootPoint</span>(p, a, b) - p) * <span class="number">2</span>; </span><br><span class="line">    <span class="comment">//实际上就是求垂足之后延长一倍得到的向量，与原来的点加起来就行了</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="判断点是否在线段上-OnSegment"><a href="#判断点是否在线段上-OnSegment" class="headerlink" title="判断点是否在线段上 OnSegment"></a>判断点是否在线段上 OnSegment</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">OnSegment</span><span class="params">(Point p, Point a1, Point a2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sgn</span>(<span class="built_in">Cross</span>(a1-p, a2-p)) == <span class="number">0</span> &amp;&amp; <span class="built_in">sgn</span>(<span class="built_in">Dot</span>(a1-p, a2-p)) &lt;= <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="判断点是否在一条线段上-不含端点-on-segment"><a href="#判断点是否在一条线段上-不含端点-on-segment" class="headerlink" title="判断点是否在一条线段上(不含端点) on_segment"></a>判断点是否在一条线段上(不含端点) on_segment</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">on_segment</span><span class="params">(Point P, Point a1, Point a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sgn</span>(<span class="built_in">Cross</span>(a1-P, a2-P)) == <span class="number">0</span> &amp;&amp; <span class="built_in">sgn</span>(<span class="built_in">Dot</span>(a1 - P, a2 - P)) &lt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="判断两线段是否相交（不算在端点处相交）segment-proper-intersection"><a href="#判断两线段是否相交（不算在端点处相交）segment-proper-intersection" class="headerlink" title="判断两线段是否相交（不算在端点处相交）segment_proper_intersection"></a>判断两线段是否相交（不算在端点处相交）segment_proper_intersection</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">segment_proper_intersection</span><span class="params">(Point a1, Point a2, Point b1, Point b2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">double</span> c1 = <span class="built_in">Cross</span>(a2 - a1, b1 - a1), c2 = <span class="built_in">Cross</span>(a2 - a1, b2 - a1);</span><br><span class="line">    <span class="type">double</span> c3 = <span class="built_in">Cross</span>(b2 - b1, a1 - b1), c4 = <span class="built_in">Cross</span>(b2 - b1, a2 - b1);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sgn</span>(c1) * <span class="built_in">sgn</span>(c2) &lt; <span class="number">0</span> &amp;&amp; <span class="built_in">sgn</span>(c3) * <span class="built_in">sgn</span>(c4) &lt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="判断两线段是否相交（包含端点处相交）-Segment-proper-intersection"><a href="#判断两线段是否相交（包含端点处相交）-Segment-proper-intersection" class="headerlink" title="判断两线段是否相交（包含端点处相交） Segment_proper_intersection"></a>判断两线段是否相交（包含端点处相交） Segment_proper_intersection</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Segment_proper_intersection</span><span class="params">(Point a1, Point a2, Point b1, Point b2)</span></span>&#123;</span><br><span class="line">    <span class="type">double</span> c1 = <span class="built_in">Cross</span>(a2-a1, b1-a1), c2 = <span class="built_in">Cross</span>(a2-a1, b2-a1);</span><br><span class="line">    <span class="type">double</span> c3 = <span class="built_in">Cross</span>(b2-b1, a1-b1), c4 = <span class="built_in">Cross</span>(b2-b1, a2-b1);</span><br><span class="line">    <span class="comment">//if判断控制是否允许线段在端点处相交，根据需要添加</span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">sgn</span>(c1) || !<span class="built_in">sgn</span>(c2) || !<span class="built_in">sgn</span>(c3) || !<span class="built_in">sgn</span>(c4))&#123;</span><br><span class="line">        <span class="type">bool</span> f1 = <span class="built_in">OnSegment</span>(b1, a1, a2);</span><br><span class="line">        <span class="type">bool</span> f2 = <span class="built_in">OnSegment</span>(b2, a1, a2);</span><br><span class="line">        <span class="type">bool</span> f3 = <span class="built_in">OnSegment</span>(a1, b1, b2);</span><br><span class="line">        <span class="type">bool</span> f4 = <span class="built_in">OnSegment</span>(a2, b1, b2);</span><br><span class="line">        <span class="type">bool</span> f = (f1|f2|f3|f4);</span><br><span class="line">        <span class="keyword">return</span> f;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">sgn</span>(c1)*<span class="built_in">sgn</span>(c2) &lt; <span class="number">0</span> &amp;&amp; <span class="built_in">sgn</span>(c3)*<span class="built_in">sgn</span>(c4) &lt; <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="两向量的关系-parallel"><a href="#两向量的关系-parallel" class="headerlink" title="两向量的关系 parallel"></a>两向量的关系 parallel</h4><p>直线v和直线Line(s, e);</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">parallel</span><span class="params">(Line v)</span></span>&#123; </span><br><span class="line"> 	<span class="keyword">return</span> <span class="built_in">sgn</span>((e−s)^(v.e−v.s)) == <span class="number">0</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="两直线关系-linecrossline"><a href="#两直线关系-linecrossline" class="headerlink" title="两直线关系 linecrossline"></a>两直线关系 linecrossline</h4><p>0 平行<br>1 重合<br>2 相交 </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">linecrossline</span><span class="params">(Line v)</span></span>&#123; </span><br><span class="line">	<span class="keyword">if</span>((*<span class="keyword">this</span>).<span class="built_in">parallel</span>(v)) </span><br><span class="line"> 	<span class="keyword">return</span> v.<span class="built_in">relation</span>(s)==<span class="number">3</span>; </span><br><span class="line">	<span class="keyword">return</span> <span class="number">2</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="多边形"><a href="#多边形" class="headerlink" title="多边形"></a>多边形</h3><h4 id="三角形四心"><a href="#三角形四心" class="headerlink" title="三角形四心"></a>三角形四心</h4><ul>
<li><strong>外心</strong>：三边中垂线交点，到三角形三个顶点距离相同（外接圆圆心）</li>
<li><strong>内心</strong>：角平分线的交点，到三角形三边的距离相同（内切圆圆心）</li>
<li><strong>垂心</strong>：三条垂线的交点</li>
<li><strong>重心</strong>：三条中线的交点，到三角形三顶点距离的平方和最小的点，三角形内到三边距离之积最大的点</li>
</ul>
<h4 id="重心"><a href="#重心" class="headerlink" title="重心"></a>重心</h4><p>$$\left (\frac{ x1+x2+x3}{3} ,\frac{y1+y2+y3}{3}\right )$$</p>
<h4 id="垂心-getcircle"><a href="#垂心-getcircle" class="headerlink" title="垂心 getcircle"></a>垂心 getcircle</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> Circle <span class="title">getcircle</span><span class="params">(Point A,Point B,Point C)</span></span>&#123;</span><br><span class="line">    Point P1=(A+B)*<span class="number">0.5</span>,P2=(A+C)*<span class="number">0.5</span>;</span><br><span class="line">    Point O=<span class="built_in">cross_LL</span>(P1,P1+<span class="built_in">Normal</span>(B-A),P2,P2+<span class="built_in">Normal</span>(C-A));</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Circle</span>(O,<span class="built_in">Len</span>(A-O));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="三角形面积并"><a href="#三角形面积并" class="headerlink" title="三角形面积并"></a>三角形面积并</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxn = <span class="number">110</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> x first</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> y second</span></span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="type">double</span>, <span class="type">double</span>&gt; PDD;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> eps = <span class="number">1e-8</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> pi = <span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> inf = <span class="number">1e12</span>;</span><br><span class="line">PDD tr[maxn][<span class="number">3</span>];</span><br><span class="line">PDD q[maxn];</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">sign</span><span class="params">(<span class="type">double</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">fabs</span>(x) &lt; eps) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(x &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dcmp</span><span class="params">(<span class="type">double</span> x, <span class="type">double</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">fabs</span>(x - y) &lt; eps) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(x &lt; y) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">PDD <span class="keyword">operator</span> + (PDD a, PDD b)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;a.x + b.x, a.y + b.y&#125;;</span><br><span class="line">&#125;</span><br><span class="line">PDD <span class="keyword">operator</span> - (PDD a, PDD b)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;a.x - b.x, a.y - b.y&#125;;</span><br><span class="line">&#125;</span><br><span class="line">PDD <span class="keyword">operator</span> * (PDD a, <span class="type">double</span> t)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;a.x * t, a.y * t&#125;;</span><br><span class="line">&#125;</span><br><span class="line">PDD <span class="keyword">operator</span> / (PDD a, <span class="type">double</span> t)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;a.x / t, a.y / t&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">double</span> <span class="keyword">operator</span> * (PDD a, PDD b)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> a.x * b.y - a.y * b.x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">double</span> <span class="keyword">operator</span> &amp; (PDD a, PDD b)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> a.x * b.x + a.y * b.y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">on_segment</span><span class="params">(PDD p, PDD a, PDD b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sign</span>((p - a) &amp; (p - b)) &lt;= <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">PDD <span class="title">get_line_intersection</span><span class="params">(PDD p, PDD v, PDD q, PDD w)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">sign</span>(v * w)) <span class="keyword">return</span> &#123;inf, inf&#125;;</span><br><span class="line">    <span class="keyword">auto</span> u = p - q;</span><br><span class="line">    <span class="type">double</span> t = w * u / (v * w);</span><br><span class="line">    <span class="keyword">auto</span> o = p + v * t;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">on_segment</span>(o, p, p + v) || !<span class="built_in">on_segment</span>(o, q, q + w)) <span class="keyword">return</span> &#123;inf, inf&#125;;</span><br><span class="line">    <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">line_range</span><span class="params">(<span class="type">double</span> a, <span class="type">int</span> side)</span>  <span class="comment">// 求区间上线段并集长度，side用于区分左右</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++)&#123;</span><br><span class="line">        <span class="keyword">auto</span> t = tr[i];</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">dcmp</span>(t[<span class="number">0</span>].x, a) &gt; <span class="number">0</span> || <span class="built_in">dcmp</span>(t[<span class="number">2</span>].x, a) &lt; <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">dcmp</span>(t[<span class="number">0</span>].x, a) &amp;&amp; !<span class="built_in">dcmp</span>(t[<span class="number">1</span>].x, a))&#123;  <span class="comment">// 特判一下左边和直线重合的情况</span></span><br><span class="line">            <span class="keyword">if</span>(side)&#123;</span><br><span class="line">                q[cnt ++] = &#123;t[<span class="number">0</span>].y ,t[<span class="number">1</span>].y&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(!<span class="built_in">dcmp</span>(t[<span class="number">2</span>].x, a) &amp;&amp; !<span class="built_in">dcmp</span>(t[<span class="number">1</span>].x, a))&#123;  <span class="comment">// 特判一下右边和直线重合的情况</span></span><br><span class="line">            <span class="keyword">if</span>(!side)&#123;</span><br><span class="line">                q[cnt ++] = &#123;t[<span class="number">2</span>].y, t[<span class="number">1</span>].y&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="type">double</span> d[<span class="number">3</span>];</span><br><span class="line">            <span class="type">int</span> u = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j ++)&#123;</span><br><span class="line">                <span class="keyword">auto</span> o = <span class="built_in">get_line_intersection</span>(t[j], t[(j + <span class="number">1</span>) % <span class="number">3</span>] - t[j], &#123;a, -inf&#125;, &#123;<span class="number">0</span>, inf * <span class="number">2</span>&#125;);</span><br><span class="line">                <span class="keyword">if</span>(<span class="built_in">dcmp</span>(o.x, inf)) d[u ++] = o.y;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(u)&#123;</span><br><span class="line">                <span class="built_in">sort</span>(d, d + u);</span><br><span class="line">                q[cnt ++] = &#123;d[<span class="number">0</span>], d[u - <span class="number">1</span>]&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!cnt) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; cnt; i ++)&#123;  <span class="comment">// 确保小的在下方，大的在上方</span></span><br><span class="line">        <span class="keyword">if</span>(q[i].x &gt; q[i].y) <span class="built_in">swap</span>(q[i].x, q[i].y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(q, q + cnt);  <span class="comment">// 求一遍区间合并</span></span><br><span class="line">    <span class="type">double</span> res = <span class="number">0</span>, st = q[<span class="number">0</span>].x, ed = q[<span class="number">0</span>].y;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; cnt; i ++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(q[i].x &lt;= ed) ed = <span class="built_in">max</span>(ed, q[i].y);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            res += ed - st;</span><br><span class="line">            st = q[i].x, ed = q[i].y;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    res += ed - st;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">range_area</span><span class="params">(<span class="type">double</span> a, <span class="type">double</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">line_range</span>(a, <span class="number">1</span>) + <span class="built_in">line_range</span>(b, <span class="number">0</span>)) * (b - a) / <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    vector&lt;<span class="type">double</span>&gt; v;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j ++)&#123;</span><br><span class="line">            cin &gt;&gt; tr[i][j].x &gt;&gt; tr[i][j].y;</span><br><span class="line">            v.<span class="built_in">push_back</span>(tr[i][j].x);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sort</span>(tr[i], tr[i] + <span class="number">3</span>);  <span class="comment">// 排序后，方便求交点</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++)&#123;  <span class="comment">// 求每两条边的交点</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j ++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> x = <span class="number">0</span>; x &lt; <span class="number">3</span>; x ++)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> y = <span class="number">0</span>; y &lt; <span class="number">3</span>; y ++)&#123;</span><br><span class="line">                    <span class="keyword">auto</span> o = <span class="built_in">get_line_intersection</span>(tr[i][x], tr[i][(x + <span class="number">1</span>) % <span class="number">3</span>] - tr[i][x],</span><br><span class="line">                                        tr[j][y], tr[j][(y + <span class="number">1</span>) % <span class="number">3</span>] - tr[j][y]);</span><br><span class="line">                    <span class="keyword">if</span>(<span class="built_in">dcmp</span>(o.x, inf)) v.<span class="built_in">push_back</span>(o.x);  <span class="comment">// 如果存在交点</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>());</span><br><span class="line">    v.<span class="built_in">erase</span>(<span class="built_in">unique</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>()), v.<span class="built_in">end</span>());</span><br><span class="line">    <span class="type">double</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; v.<span class="built_in">size</span>() - <span class="number">1</span>; i ++)&#123;</span><br><span class="line">        res += <span class="built_in">range_area</span>(v[i], v[i + <span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.2lf\n&quot;</span>, res);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="凸多边形面积-convex-polygon-area"><a href="#凸多边形面积-convex-polygon-area" class="headerlink" title="凸多边形面积 convex_polygon_area"></a>凸多边形面积 convex_polygon_area</h4><p>叉积的几何意义就是三角形有向面积的二倍，所以这里要除以二</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">double</span> <span class="title">convex_polygon_area</span><span class="params">(Point* p, <span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">double</span> area = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n - <span class="number">2</span>; ++ i)</span><br><span class="line">        area += <span class="built_in">Cross</span>(p[i] - p[<span class="number">0</span>], p[i + <span class="number">1</span>] - p[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">return</span> area / <span class="number">2</span>;</span><br><span class="line">    <span class="comment">//return fabs(area / 2);//不加的话求的是有向面积，逆时针为负，顺时针为正</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="非凸多边形面积-polyg-on-area"><a href="#非凸多边形面积-polyg-on-area" class="headerlink" title="非凸多边形面积 polyg_on_area"></a>非凸多边形面积 polyg_on_area</h4><p>我们叉积求得的三角形面积是有向的，在外面的面积可以正负抵消掉，<br>因此非凸多边形也适用，可以从任意点出发划分<br>可以取原点为起点，减少叉乘次数</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">double</span> <span class="title">polyg_on_area</span><span class="params">(Point* p, <span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">double</span> area = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n - <span class="number">2</span>; ++ i)</span><br><span class="line">        area += <span class="built_in">Cross</span>(p[i] - p[<span class="number">0</span>], p[i + <span class="number">1</span>] - p[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">return</span> area / <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="判断点在多边形内-is-point-in-polygon"><a href="#判断点在多边形内-is-point-in-polygon" class="headerlink" title="判断点在多边形内 is_point_in_polygon"></a>判断点在多边形内 is_point_in_polygon</h4><p>若点在多边形内返回1，在多边形外部返回0，在多边形上返回-1</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">is_point_in_polygon</span><span class="params">(Point p, vector&lt;Point&gt; poly)</span></span>&#123;<span class="comment">//待判断的点和该多边形的所有点的合集</span></span><br><span class="line">    <span class="type">int</span> wn = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> n = poly.<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">OnSegment</span>(p, poly[i], poly[(i<span class="number">+1</span>)%n])) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="type">int</span> k = <span class="built_in">sgn</span>(<span class="built_in">Cross</span>(poly[(i<span class="number">+1</span>)%n] - poly[i], p - poly[i]));</span><br><span class="line">        <span class="type">int</span> d1 = <span class="built_in">sgn</span>(poly[i].y - p.y);</span><br><span class="line">        <span class="type">int</span> d2 = <span class="built_in">sgn</span>(poly[(i<span class="number">+1</span>)%n].y - p.y);</span><br><span class="line">        <span class="keyword">if</span>(k &gt; <span class="number">0</span> &amp;&amp; d1 &lt;= <span class="number">0</span> &amp;&amp; d2 &gt; <span class="number">0</span>) wn++;</span><br><span class="line">        <span class="keyword">if</span>(k &lt; <span class="number">0</span> &amp;&amp; d2 &lt;= <span class="number">0</span> &amp;&amp; d1 &gt; <span class="number">0</span>) wn--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(wn != <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="判断点在凸多边形内-ToLeftTest"><a href="#判断点在凸多边形内-ToLeftTest" class="headerlink" title="判断点在凸多边形内 ToLeftTest"></a>判断点在凸多边形内 ToLeftTest</h4><p>只需要判断点是否在所有边的左边（按逆时针顺序排列的顶点集）可以使用ToLeftTest ，O ( n ) </p>
<p>判断折线（向量）bc是不是向（向量）ab的逆时针方向（左边）转向(ToLeftTest)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">ToLeftTest</span><span class="params">(Point a, Point b, Point c)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Cross</span>(b - a, c - b) &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="圆"><a href="#圆" class="headerlink" title="圆"></a>圆</h3><p>定义</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Circle</span></span><br><span class="line">&#123;</span><br><span class="line">	Point c;</span><br><span class="line">	<span class="type">double</span> r;</span><br><span class="line">	<span class="built_in">Circle</span>(Point c=<span class="built_in">Point</span>(),<span class="type">double</span> r=<span class="number">0</span>):<span class="built_in">c</span>(c),<span class="built_in">r</span>(r)&#123;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> Point <span class="title">point</span><span class="params">(<span class="type">double</span> a)</span><span class="comment">//通过圆心角求坐标</span></span></span><br><span class="line"><span class="function">	</span>&#123; <span class="keyword">return</span> <span class="built_in">Point</span>(c.x+<span class="built_in">cos</span>(a)*r,c.y+<span class="built_in">sin</span>(a)*r); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//读入圆</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> Circle <span class="title">read_circle</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Circle C;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%lf%lf%lf&quot;</span>,&amp;C.c.x,&amp;C.c.y,&amp;C.r);</span><br><span class="line">	<span class="keyword">return</span> C;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//xmult函数只在圆中有应用并不常见</span></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">xmult</span><span class="params">(Point p1,Point p2,Point p0)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> (p<span class="number">1.</span>x-p<span class="number">0.</span>x)*(p<span class="number">2.</span>y-p<span class="number">0.</span>y)-(p<span class="number">2.</span>x-p<span class="number">0.</span>x)*(p<span class="number">1.</span>y-p<span class="number">0.</span>y);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<h4 id="圆与直线交点-getLineCircleIntersection"><a href="#圆与直线交点-getLineCircleIntersection" class="headerlink" title="圆与直线交点 getLineCircleIntersection"></a>圆与直线交点 getLineCircleIntersection</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">getLineCircleIntersection</span><span class="params">(Line L, Circle C, <span class="type">double</span>&amp; t1, <span class="type">double</span>&amp; t2, vector&lt;Point&gt;&amp; sol)</span> </span>&#123;</span><br><span class="line">    <span class="type">double</span> a = L.v.x, b = L.p.x - C.c.x, c = L.v.y, d = L.p.y - C.c.y;</span><br><span class="line">    <span class="type">double</span> e = a * a + c * c, f = <span class="number">2</span> * (a * b + c * d), g = b * b + d * d - C.r * C.r;</span><br><span class="line">    <span class="type">double</span> delta = f * f - <span class="number">4</span> * e * g;<span class="comment">//判别式</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">sgn</span>(delta) &lt; <span class="number">0</span>)<span class="comment">//相离</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">sgn</span>(delta) == <span class="number">0</span>) &#123;<span class="comment">//相切</span></span><br><span class="line">        t1 = t2 = -f / (<span class="number">2</span> * e);</span><br><span class="line">        sol.<span class="built_in">push_back</span>(L.<span class="built_in">get_point_in_line</span>(t1));<span class="comment">//sol存放交点本身</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//相交</span></span><br><span class="line">    t1 = (-f - <span class="built_in">sqrt</span>(delta)) / (<span class="number">2</span> * e);</span><br><span class="line">    sol.<span class="built_in">push_back</span>(L.<span class="built_in">get_point_in_line</span>(t1));</span><br><span class="line">    t2 = (-f + <span class="built_in">sqrt</span>(delta)) / (<span class="number">2</span> * e);</span><br><span class="line">    sol.<span class="built_in">push_back</span>(L.<span class="built_in">get_point_in_line</span>(t2));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="求两圆交点-get-circle-circle-intersection"><a href="#求两圆交点-get-circle-circle-intersection" class="headerlink" title="求两圆交点 get_circle_circle_intersection"></a>求两圆交点 get_circle_circle_intersection</h4><p>两圆相交保存所有交点返回交点个数（至多两个）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">get_circle_circle_intersection</span><span class="params">(Circle c1, Circle c2, vector&lt;Point&gt;&amp; sol)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">double</span> d = <span class="built_in">Length</span>(c<span class="number">1.</span>c - c<span class="number">2.</span>c);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">sgn</span>(d) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">sgn</span>(c<span class="number">1.</span>r - c<span class="number">2.</span>r) == <span class="number">0</span>)<span class="keyword">return</span> <span class="number">-1</span>;<span class="comment">//两圆重合</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">sgn</span>(c<span class="number">1.</span>r + c<span class="number">2.</span>r - d) &lt; <span class="number">0</span>)<span class="keyword">return</span> <span class="number">0</span>;<span class="comment">//相离</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">sgn</span>(<span class="built_in">fabs</span>(c<span class="number">1.</span>r - c<span class="number">2.</span>r) - d) &gt; <span class="number">0</span>)<span class="keyword">return</span> <span class="number">0</span>;<span class="comment">//在另一个圆的内部</span></span><br><span class="line"> </span><br><span class="line">    <span class="type">double</span> a = <span class="built_in">Polar_angle</span>(c<span class="number">2.</span>c - c<span class="number">1.</span>c);<span class="comment">//向量c1c2的极角</span></span><br><span class="line">    <span class="type">double</span> da = <span class="built_in">acos</span>((c<span class="number">1.</span>r * c<span class="number">1.</span>r + d * d - c<span class="number">2.</span>r * c<span class="number">2.</span>r) / (<span class="number">2</span> * c<span class="number">1.</span>r * d));</span><br><span class="line">    <span class="comment">//c1c2到c1p1的角</span></span><br><span class="line">    Point p1 = c<span class="number">1.</span><span class="built_in">point</span>(a - da), p2 = c<span class="number">1.</span><span class="built_in">point</span>(a + da);</span><br><span class="line">    sol.<span class="built_in">push_back</span>(p1);</span><br><span class="line">    <span class="keyword">if</span> (p1 == p2)<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    sol.<span class="built_in">push_back</span>(p2);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="点到圆的切线-get-tangents"><a href="#点到圆的切线-get-tangents" class="headerlink" title="点到圆的切线 get_tangents"></a>点到圆的切线 get_tangents</h4><p>过点p到圆c的切线，v[i]是第i条切线， 返回切线的条数</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">get_tangents</span><span class="params">(Point p, Circle C, Vector* v)</span> </span>&#123;</span><br><span class="line">    Vector u = C.c - p;</span><br><span class="line">    <span class="type">double</span> dist = <span class="built_in">Length</span>(u);</span><br><span class="line">    <span class="keyword">if</span> (dist &lt; C.r)<span class="keyword">return</span> <span class="number">0</span>;<span class="comment">//点在内部，没有切线</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">sgn</span>(dist - C.r) == <span class="number">0</span>) &#123;<span class="comment">//p在圆上，只有一条切线</span></span><br><span class="line">        v[<span class="number">0</span>] = <span class="built_in">Rotate</span>(u, PI / <span class="number">2</span>);<span class="comment">//切线就是垂直嘛</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;<span class="comment">//否则是两条切线</span></span><br><span class="line">        <span class="type">double</span> ang = <span class="built_in">asin</span>(C.r / dist);</span><br><span class="line">        v[<span class="number">0</span>] = <span class="built_in">Rotate</span>(u, -ang);</span><br><span class="line">        v[<span class="number">1</span>] = <span class="built_in">Rotate</span>(u, +ang);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="两圆的公切线-get-tangents"><a href="#两圆的公切线-get-tangents" class="headerlink" title="两圆的公切线 get_tangents"></a>两圆的公切线 get_tangents</h4><p>根据两圆的圆心距从小到大排列，一共有6种情况。<br>情况一：两圆完全重合。有无数条公切线。<br>情况二：两圆内含，没有公共点。没有公切线。<br>情况三：两圆内切。有1条外公切线。<br>情况四：两圆相交。有2条外公切线。<br>情况五：两圆外切。有3条公切线，其中一条内公切线，两条外公切线。<br>情况六：两圆相离。有4条公切线，其中内公切线两条，外公切线两条。<br>可以根据圆心距和半径的关系辨别出这6种情况，然后逐一求解。<br>情况一和情况二没什么需要求的，情况三和情况五中的内公切线都对应<br>于“过圆上一点求圆的切线”，只需连接圆心和切点，旋转90°后即可知道<br>切线的方向向量。这样，问题的关键是求出情况四、五中的外公切线和<br>情况六中的内公切线。</p>
<p>返回切线的条数，-1表示无穷条切线<br>a[i]和b[i] 分别是第i条切线在圆A和圆B上的切点</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">get_tangents</span><span class="params">(Circle A, Circle B, Point* a, Point* b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(A.r &lt; B.r)<span class="built_in">swap</span>(A, B), <span class="built_in">swap</span>(a, b);</span><br><span class="line">    <span class="type">int</span> d2 = (A.x - B.x) * (A.x - B.x) + (A.y - B.y) * (A.y - B.y);</span><br><span class="line">    <span class="type">int</span> rdiff = A.r - B.r;</span><br><span class="line">    <span class="type">int</span> rsum = A.r + B.r;</span><br><span class="line">    <span class="keyword">if</span>(d2 &lt; rdiff * rdiff)<span class="keyword">return</span> <span class="number">0</span>;<span class="comment">//内含</span></span><br><span class="line">    <span class="type">double</span> base = <span class="built_in">atan2</span>(B.y - A.y, B.x - A.x);</span><br><span class="line">    <span class="keyword">if</span>(d2 == <span class="number">0</span> &amp;&amp; A.r == B.r)<span class="keyword">return</span> <span class="number">-1</span>;<span class="comment">//无限多条切线</span></span><br><span class="line">    <span class="keyword">if</span>(d2 == rdiff * rdiff)&#123;<span class="comment">//内切，1条切线</span></span><br><span class="line">        a[cnt] = A.<span class="built_in">point</span>(base);</span><br><span class="line">        b[cnt] = B.<span class="built_in">point</span>(base); cnt ++ ;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//有外共切线</span></span><br><span class="line">    <span class="type">double</span> ang = <span class="built_in">acos</span>((A.r - B.r) / <span class="built_in">sqrt</span>(d2));</span><br><span class="line">    a[cnt] = A.<span class="built_in">point</span>(base + ang);b[cnt] = B.<span class="built_in">point</span>(base + ang);cnt ++;</span><br><span class="line">    a[cnt] = A.<span class="built_in">point</span>(base - ang);b[cnt] = B.<span class="built_in">point</span>(base - ang);cnt ++;</span><br><span class="line">    <span class="keyword">if</span>(d2 == rsum * rsum)&#123;<span class="comment">//一条内公切线</span></span><br><span class="line">        a[cnt] = A.<span class="built_in">point</span>(base);b[cnt] = B.<span class="built_in">point</span>(PI + base); cnt ++ ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(d2 &gt; rsum * rsum)&#123;<span class="comment">//两条内公切线</span></span><br><span class="line">        <span class="type">double</span> ang = <span class="built_in">acos</span>((A.r + B.r) / <span class="built_in">sqrt</span>(d2));</span><br><span class="line">        a[cnt] = A.<span class="built_in">point</span>(base + ang); b[cnt] = B.<span class="built_in">point</span>(PI + base + ang); cnt ++ ;</span><br><span class="line">        a[cnt] = A.<span class="built_in">point</span>(base - ang); b[cnt] = B.<span class="built_in">point</span>(PI + base - ang); cnt ++ ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cnt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="两圆相交面积-AreaOfOverlap"><a href="#两圆相交面积-AreaOfOverlap" class="headerlink" title="两圆相交面积 AreaOfOverlap"></a>两圆相交面积 AreaOfOverlap</h4><p>通过计算两个圆相交所构成的两个扇形面积和减去其构成的筝形的面积</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">double</span> <span class="title">AreaOfOverlap</span><span class="params">(Point c1, <span class="type">double</span> r1, Point c2, <span class="type">double</span> r2)</span></span>&#123;</span><br><span class="line">    <span class="type">double</span> d = <span class="built_in">Length</span>(c1 - c2);</span><br><span class="line">    <span class="keyword">if</span>(r1 + r2 &lt; d + eps)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0.0</span>;</span><br><span class="line">    <span class="keyword">if</span>(d &lt; <span class="built_in">fabs</span>(r1 - r2) + eps)&#123;</span><br><span class="line">        <span class="type">double</span> r = <span class="built_in">min</span>(r1, r2);</span><br><span class="line">        <span class="keyword">return</span> PI*r*r;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">double</span> x = (d*d + r1*r1 - r2*r2)/(<span class="number">2.0</span>*d);</span><br><span class="line">    <span class="type">double</span> p = (r1 + r2 + d)/<span class="number">2.0</span>;</span><br><span class="line">    <span class="type">double</span> t1 = <span class="built_in">acos</span>(x/r1);</span><br><span class="line">    <span class="type">double</span> t2 = <span class="built_in">acos</span>((d - x)/r2);</span><br><span class="line">    <span class="type">double</span> s1 = r1*r1*t1;</span><br><span class="line">    <span class="type">double</span> s2 = r2*r2*t2;</span><br><span class="line">    <span class="type">double</span> s3 = <span class="number">2</span>*<span class="built_in">sqrt</span>(p*(p - r1)*(p - r2)*(p - d));</span><br><span class="line">    <span class="keyword">return</span> s1 + s2 - s3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="判直线和圆是否相交-包括相切-intersect-line-circle"><a href="#判直线和圆是否相交-包括相切-intersect-line-circle" class="headerlink" title="判直线和圆是否相交,包括相切 intersect_line_circle"></a>判直线和圆是否相交,包括相切 intersect_line_circle</h4><p>需要计算点到直线距离函数</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">intersect_line_circle</span><span class="params">(Point c, <span class="type">double</span> r, Point l1, Point l2)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Distance_point_to_line</span>(c, l1, l2) &lt; r + eps;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="判线段和圆相交-包括端点和相切-intersect-seg-circle"><a href="#判线段和圆相交-包括端点和相切-intersect-seg-circle" class="headerlink" title="判线段和圆相交,包括端点和相切 intersect_seg_circle"></a>判线段和圆相交,包括端点和相切 intersect_seg_circle</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">intersect_seg_circle</span><span class="params">(Point c, <span class="type">double</span> r, Point l1, Point l2)</span> </span>&#123;</span><br><span class="line">    <span class="type">double</span> t1 = <span class="built_in">dis</span>(c, l1) - r, t2 = <span class="built_in">dis</span>(c, l2) - r;</span><br><span class="line">    Point t = c;</span><br><span class="line">    <span class="keyword">if</span> (t1 &lt; eps || t2 &lt; eps)</span><br><span class="line">        <span class="keyword">return</span> t1 &gt; -eps || t2 &gt; -eps;</span><br><span class="line">    t.x += l<span class="number">1.</span>y - l<span class="number">2.</span>y;</span><br><span class="line">    t.y += l<span class="number">2.</span>x - l<span class="number">1.</span>x;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">xmult</span>(l1, c, t) * <span class="built_in">xmult</span>(l2, c, t) &lt; eps &amp;&amp; <span class="built_in">Distance_point_to_line</span>(c, l1, l2) - r &lt; eps;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="判圆和圆相交-包括相切-intersect-circle-circle"><a href="#判圆和圆相交-包括相切-intersect-circle-circle" class="headerlink" title="判圆和圆相交,包括相切 intersect_circle_circle"></a>判圆和圆相交,包括相切 intersect_circle_circle</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">intersect_circle_circle</span><span class="params">(Point c1, <span class="type">double</span> r1, Point c2, <span class="type">double</span> r2)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dis</span>(c1, c2) &lt; r1 + r2 + eps &amp;&amp; <span class="built_in">dis</span>(c1, c2) &gt; <span class="built_in">fabs</span>(r1 - r2) - eps;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="计算圆上到点p最近点-如p与圆心重合-返回p本身-dot-to-circle"><a href="#计算圆上到点p最近点-如p与圆心重合-返回p本身-dot-to-circle" class="headerlink" title="计算圆上到点p最近点,如p与圆心重合,返回p本身 dot_to_circle"></a>计算圆上到点p最近点,如p与圆心重合,返回p本身 dot_to_circle</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Point <span class="title">dot_to_circle</span><span class="params">(Point c, <span class="type">double</span> r, Point p)</span> </span>&#123;</span><br><span class="line">    Point u, v;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">dis</span>(p, c) &lt; eps)</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    u.x = c.x + r * <span class="built_in">fabs</span>(c.x - p.x) / <span class="built_in">dis</span>(c, p);</span><br><span class="line">    u.y = c.y + r * <span class="built_in">fabs</span>(c.y - p.y) / <span class="built_in">dis</span>(c, p) * ((c.x - p.x) * (c.y - p.y) &lt; <span class="number">0</span> ? <span class="number">-1</span> : <span class="number">1</span>);</span><br><span class="line">    v.x = c.x - r * <span class="built_in">fabs</span>(c.x - p.x) / <span class="built_in">dis</span>(c, p);</span><br><span class="line">    v.y = c.y - r * <span class="built_in">fabs</span>(c.y - p.y) / <span class="built_in">dis</span>(c, p) * ((c.x - p.x) * (c.y - p.y) &lt; <span class="number">0</span> ? <span class="number">-1</span> : <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dis</span>(u, p) &lt; <span class="built_in">dis</span>(v, p) ? u : v;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="计算直线与圆的交点-保证直线与圆有交点-intersection-line-circle"><a href="#计算直线与圆的交点-保证直线与圆有交点-intersection-line-circle" class="headerlink" title="计算直线与圆的交点,保证直线与圆有交点 intersection_line_circle"></a>计算直线与圆的交点,保证直线与圆有交点 intersection_line_circle</h4><p>传进来的是直线上两点</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">intersection_line_circle</span><span class="params">(Point c, <span class="type">double</span> r, Point l1, Point l2, Point&amp; p1, Point&amp; p2)</span> </span>&#123;</span><br><span class="line">    Point p = c;</span><br><span class="line">    <span class="type">double</span> t;</span><br><span class="line">    p.x += l<span class="number">1.</span>y - l<span class="number">2.</span>y;</span><br><span class="line">    p.y += l<span class="number">2.</span>x - l<span class="number">1.</span>x;</span><br><span class="line">    p = <span class="built_in">Get_line_intersection</span>(p, c - p, l1, l2 - l1);</span><br><span class="line">    t = <span class="built_in">sqrt</span>(r * r - <span class="built_in">dis</span>(p, c) * <span class="built_in">dis</span>(p, c)) / <span class="built_in">dis</span>(l1, l2);</span><br><span class="line">    p<span class="number">1.</span>x = p.x + (l<span class="number">2.</span>x - l<span class="number">1.</span>x) * t;</span><br><span class="line">    p<span class="number">1.</span>y = p.y + (l<span class="number">2.</span>y - l<span class="number">1.</span>y) * t;</span><br><span class="line">    p<span class="number">2.</span>x = p.x - (l<span class="number">2.</span>x - l<span class="number">1.</span>x) * t;</span><br><span class="line">    p<span class="number">2.</span>y = p.y - (l<span class="number">2.</span>y - l<span class="number">1.</span>y) * t;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="计算圆与圆的交点-保证圆与圆有交点-圆心不重合-intersection-circle-circle"><a href="#计算圆与圆的交点-保证圆与圆有交点-圆心不重合-intersection-circle-circle" class="headerlink" title="计算圆与圆的交点,保证圆与圆有交点,圆心不重合 intersection_circle_circle"></a>计算圆与圆的交点,保证圆与圆有交点,圆心不重合 intersection_circle_circle</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">intersection_circle_circle</span><span class="params">(Point c1, <span class="type">double</span> r1, Point c2, <span class="type">double</span> r2, Point&amp; p1, Point&amp; p2)</span> </span>&#123;</span><br><span class="line">    Point u, v;</span><br><span class="line">    <span class="type">double</span> t;</span><br><span class="line">    t = (<span class="number">1</span> + (r1 * r1 - r2 * r2) / <span class="built_in">dis</span>(c1, c2) / <span class="built_in">dis</span>(c1, c2)) / <span class="number">2</span>;</span><br><span class="line">    u.x = c<span class="number">1.</span>x + (c<span class="number">2.</span>x - c<span class="number">1.</span>x) * t;</span><br><span class="line">    u.y = c<span class="number">1.</span>y + (c<span class="number">2.</span>y - c<span class="number">1.</span>y) * t;</span><br><span class="line">    v.x = u.x + c<span class="number">1.</span>y - c<span class="number">2.</span>y;</span><br><span class="line">    v.y = u.y - c<span class="number">1.</span>x + c<span class="number">2.</span>x;</span><br><span class="line">    <span class="built_in">intersection_line_circle</span>(c1, r1, u, v, p1, p2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="求圆外一点对圆-o-r-的两个切点-TangentPoint-PC"><a href="#求圆外一点对圆-o-r-的两个切点-TangentPoint-PC" class="headerlink" title="求圆外一点对圆(o,r)的两个切点 TangentPoint_PC"></a>求圆外一点对圆(o,r)的两个切点 TangentPoint_PC</h4><p>poi为圆外的那个点</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">TangentPoint_PC</span><span class="params">(Point poi, Point o, <span class="type">double</span> r, Point&amp; result1, Point&amp; result2)</span> </span>&#123;</span><br><span class="line">    <span class="type">double</span> line = <span class="built_in">sqrt</span>((poi.x - o.x) * (poi.x - o.x) + (poi.y - o.y) * (poi.y - o.y));</span><br><span class="line">    <span class="type">double</span> angle = <span class="built_in">acos</span>(r / line);</span><br><span class="line">    Point unitvector, lin;</span><br><span class="line">    lin.x = poi.x - o.x;</span><br><span class="line">    lin.y = poi.y - o.y;</span><br><span class="line">    unitvector.x = lin.x / <span class="built_in">sqrt</span>(lin.x * lin.x + lin.y * lin.y) * r;</span><br><span class="line">    unitvector.y = lin.y / <span class="built_in">sqrt</span>(lin.x * lin.x + lin.y * lin.y) * r;</span><br><span class="line">    result1 = <span class="built_in">Rotate</span>(unitvector, -angle);</span><br><span class="line">    result2 = <span class="built_in">Rotate</span>(unitvector, angle);</span><br><span class="line">    result<span class="number">1.</span>x += o.x;</span><br><span class="line">    result<span class="number">1.</span>y += o.y;</span><br><span class="line">    result<span class="number">2.</span>x += o.x;</span><br><span class="line">    result<span class="number">2.</span>y += o.y;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="求外接圆-get-circumcircle"><a href="#求外接圆-get-circumcircle" class="headerlink" title="求外接圆 get_circumcircle"></a>求外接圆 get_circumcircle</h4><p>可以解决三点定圆问题</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Circle <span class="title">get_circumcircle</span><span class="params">(Point p1, Point p2, Point p3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">double</span> Bx = p<span class="number">2.</span>x - p<span class="number">1.</span>x, By = p<span class="number">2.</span>y - p<span class="number">1.</span>y;</span><br><span class="line">    <span class="type">double</span> Cx = p<span class="number">3.</span>x - p<span class="number">1.</span>x, Cy = p<span class="number">3.</span>y - p<span class="number">1.</span>y;</span><br><span class="line">    <span class="type">double</span> D = <span class="number">2</span> * (Bx * Cy - By * Cx);</span><br><span class="line">    <span class="type">double</span> ansx = (Cy * (Bx * Bx + By * By) - By * (Cx * Cx + Cy * Cy)) / D + p<span class="number">1.</span>x;</span><br><span class="line">    <span class="type">double</span> ansy = (Bx * (Cx * Cx + Cy * Cy) - Cx * (Bx * Bx + By * By)) / D + p<span class="number">1.</span>y;</span><br><span class="line">    <span class="function">Point <span class="title">p</span><span class="params">(ansx, ansy)</span></span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Circle</span>(p, <span class="built_in">Length</span>(p1 - p));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="求内切圆-get-incircle"><a href="#求内切圆-get-incircle" class="headerlink" title="求内切圆 get_incircle"></a>求内切圆 get_incircle</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Circle <span class="title">get_incircle</span><span class="params">(Point p1, Point p2, Point p3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">double</span> a = <span class="built_in">Length</span>(p2 - p3);</span><br><span class="line">    <span class="type">double</span> b = <span class="built_in">Length</span>(p3 - p1);</span><br><span class="line">    <span class="type">double</span> c = <span class="built_in">Length</span>(p1 - p2);</span><br><span class="line">    Point p = (p1 * a + p2 * b + p3 * c) / (a + b + c);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Circle</span>(p, <span class="built_in">Distance_point_to_line</span>(p, p1, p2));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="判断两圆关系-relationcircle"><a href="#判断两圆关系-relationcircle" class="headerlink" title="判断两圆关系 relationcircle"></a>判断两圆关系 relationcircle</h4><p>5 相离<br>4 外切<br>3 相交<br>2 内切<br>1 内含</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">relationcircle</span><span class="params">(Circle v, Circle p)</span> </span>&#123;</span><br><span class="line">    <span class="type">double</span> d = <span class="built_in">dis</span>(p.c, v.c);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">sgn</span>(d - p.r - v.r) &gt; <span class="number">0</span>)<span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">sgn</span>(d - p.r - v.r) == <span class="number">0</span>)<span class="keyword">return</span> <span class="number">4</span>;</span><br><span class="line">    <span class="type">double</span> l = <span class="built_in">fabs</span>(p.r - v.r</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">sgn</span>(d - p.r - v.r) &lt; <span class="number">0</span> &amp;&amp; <span class="built_in">sgn</span>(d - l) &gt; <span class="number">0</span>)<span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">sgn</span>(d - l) == <span class="number">0</span>)<span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">sgn</span>(d - l) &lt; <span class="number">0</span>)<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="求球面上两个点的最短距离"><a href="#求球面上两个点的最短距离" class="headerlink" title="求球面上两个点的最短距离"></a>求球面上两个点的最短距离</h4><p>只允许在球面上走，设两个点的距离为d，球半径为r，则距离为2asin(d&#x2F;2r)r</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ans = <span class="built_in">asin</span>(d / (<span class="number">2</span> * r)) * r * <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<h4 id="最小圆覆盖-min-cover-circle"><a href="#最小圆覆盖-min-cover-circle" class="headerlink" title="最小圆覆盖 min_cover_circle"></a>最小圆覆盖 min_cover_circle</h4><p>p为点集，n为数量，注意从0开始</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Circle <span class="title">min_cover_circle</span><span class="params">(Point p[], <span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">random_shuffle</span>(p, p + n);</span><br><span class="line">    Circle c = &#123; p[<span class="number">0</span>],<span class="number">0</span> &#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">sgn</span>(<span class="built_in">dis</span>(p[i], c.c) - c.r) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            c = &#123; p[i],<span class="number">0</span> &#125;;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; i; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">sgn</span>(<span class="built_in">dis</span>(p[j], c.c) - c.r) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    c.c.x = (p[i].x + p[j].x) / <span class="number">2</span>;</span><br><span class="line">                    c.c.y = (p[i].y + p[j].y) / <span class="number">2</span>;</span><br><span class="line">                    c.r = <span class="built_in">dis</span>(p[j], c.c);</span><br><span class="line">                    <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; j; k++) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="built_in">sgn</span>(<span class="built_in">dis</span>(p[k], c.c) - c.r) &gt; <span class="number">0</span>) c = <span class="built_in">get_circumcircle</span>(p[i], p[j], p[k]);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="圆的面积并"><a href="#圆的面积并" class="headerlink" title="圆的面积并"></a>圆的面积并</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxn = <span class="number">1010</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> eps = <span class="number">1e-8</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> pi = <span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> x first</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> y second</span></span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="type">double</span>, <span class="type">double</span>&gt; PDD;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">node</span></span><br><span class="line">&#123;</span><br><span class="line">    PDD r;</span><br><span class="line">    <span class="type">double</span> R;</span><br><span class="line">&#125;Circle;</span><br><span class="line">Circle a[maxn];</span><br><span class="line">PDD q[maxn];</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dcmp</span><span class="params">(<span class="type">double</span> x, <span class="type">double</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">fabs</span>(x - y) &lt; eps) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(x &lt; y) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">f</span><span class="params">(<span class="type">double</span> x)</span>  <span class="comment">// 所有圆和X = x这条直线交集的长度</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++)&#123;</span><br><span class="line">        <span class="keyword">auto</span> X = <span class="built_in">fabs</span>(a[i].r.x - x), R = a[i].R;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">dcmp</span>(X, R) &lt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">auto</span> Y = <span class="built_in">sqrt</span>(R * R - X * X);</span><br><span class="line">            q[cnt ++] = &#123;a[i].r.y - Y, a[i].r.y + Y&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!cnt) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">sort</span>(q, q + cnt); <span class="comment">// 区间合并</span></span><br><span class="line">    <span class="type">double</span> res = <span class="number">0</span>, st = q[<span class="number">0</span>].x, ed = q[<span class="number">0</span>].y;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; cnt; i ++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(q[i].x &lt;= ed) ed = <span class="built_in">max</span>(ed, q[i].y);</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            res += ed - st;</span><br><span class="line">            st = q[i].x, ed = q[i].y;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    res += ed - st;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">simpson</span><span class="params">(<span class="type">double</span> l, <span class="type">double</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> mid = (l + r) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">return</span> (r - l) * (<span class="built_in">f</span>(l) + <span class="number">4</span> * <span class="built_in">f</span>(mid) + <span class="built_in">f</span>(r)) / <span class="number">6</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">asr</span><span class="params">(<span class="type">double</span> l, <span class="type">double</span> r, <span class="type">double</span> s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">double</span> mid = (l + r) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">auto</span> left = <span class="built_in">simpson</span>(l, mid), right = <span class="built_in">simpson</span>(mid, r);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">fabs</span>(left + right - s) &lt; eps) <span class="keyword">return</span> left + right;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">asr</span>(l, mid, left) + <span class="built_in">asr</span>(mid, r, right);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">get_area</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="type">double</span> l = <span class="number">2000</span>, r = <span class="number">-2000</span>; <span class="comment">// 积分范围，根据题意来定</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++)&#123;</span><br><span class="line">        cin &gt;&gt; a[i].r.x &gt;&gt; a[i].r.y &gt;&gt; a[i].R;</span><br><span class="line">        l = <span class="built_in">min</span>(l, a[i].r.x - a[i].R), r = <span class="built_in">max</span>(r, a[i].r.x + a[i].R);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.3lf\n&quot;</span>, <span class="built_in">asr</span>(l - <span class="number">100</span>, r + <span class="number">100</span>, <span class="built_in">simpson</span>(l, r)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="圆和多边形的面积并"><a href="#圆和多边形的面积并" class="headerlink" title="圆和多边形的面积并"></a>圆和多边形的面积并</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 求任意多边形和圆形面积交集的面积</span></span><br><span class="line"><span class="comment">// 利用三角剖分，将圆心和每条边的两个点连线，每次求三角形和原型交集的面积，累加求和即可。</span></span><br><span class="line"><span class="comment">// 要进行五种情况的分类讨论</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 求三角形oab和圆面积交集的面积，圆心处于原点</span></span><br><span class="line">PDD r;</span><br><span class="line"><span class="type">double</span> R;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">get_circle_triangle_area</span><span class="params">(PDD a, PDD b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> da = <span class="built_in">get_dist</span>(r, a), db = <span class="built_in">get_dist</span>(r, b);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">dcmp</span>(R, da) &gt;= <span class="number">0</span> &amp;&amp; <span class="built_in">dcmp</span>(R, db) &gt;= <span class="number">0</span>) <span class="keyword">return</span> a * b / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">sign</span>(a * b)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    PDD pa, pb;</span><br><span class="line">    <span class="keyword">auto</span> min_d = <span class="built_in">get_line_circle_intersection</span>(a, b, pa, pb);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">dcmp</span>(R, min_d) &lt;= <span class="number">0</span>) <span class="keyword">return</span> <span class="built_in">get_sector</span>(a, b);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">dcmp</span>(R, da) &gt;= <span class="number">0</span>) <span class="keyword">return</span> <span class="built_in">get_sector</span>(pb, b) + a * pb / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">dcmp</span>(R, db) &gt;= <span class="number">0</span>) <span class="keyword">return</span> <span class="built_in">get_sector</span>(a, pa) + pa * b / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">get_sector</span>(a, pa) + pa * pb / <span class="number">2</span> + <span class="built_in">get_sector</span>(pb, b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 求面积，时间复杂度O(n)</span></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">work</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">double</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++)&#123;</span><br><span class="line">        res += <span class="built_in">get_circle_triangle_area</span>(q[i], q[(i + <span class="number">1</span>) % n]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">fabs</span>(res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="常用二维计算几何"><a href="#常用二维计算几何" class="headerlink" title="常用二维计算几何"></a>常用二维计算几何</h3><h4 id="凸包-ConvexHull"><a href="#凸包-ConvexHull" class="headerlink" title="凸包 ConvexHull"></a>凸包 ConvexHull</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">ConvexHull</span><span class="params">(Point* p, <span class="type">int</span> n, Point* ch)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(p, p + n);</span><br><span class="line">    <span class="type">int</span> m = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;<span class="comment">//下凸包</span></span><br><span class="line">        <span class="keyword">while</span> (m &gt; <span class="number">1</span> &amp;&amp; <span class="built_in">Cross</span>(ch[m - <span class="number">1</span>] - ch[m - <span class="number">2</span>], p[i] - ch[m - <span class="number">2</span>]) &lt;= <span class="number">0</span>)m--;</span><br><span class="line">        ch[m++] = p[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> k = m;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = n - <span class="number">2</span>; i &gt;= <span class="number">0</span>; --i) &#123;<span class="comment">//上凸包</span></span><br><span class="line">        <span class="keyword">while</span> (m &gt; k &amp;&amp; <span class="built_in">Cross</span>(ch[m - <span class="number">1</span>] - ch[m - <span class="number">2</span>], p[i] - ch[m - <span class="number">2</span>]) &lt;= <span class="number">0</span>)m--;</span><br><span class="line">        ch[m++] = p[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">1</span>) m--;</span><br><span class="line">    <span class="keyword">return</span> m;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="判断点是否在凸包内"><a href="#判断点是否在凸包内" class="headerlink" title="判断点是否在凸包内"></a>判断点是否在凸包内</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">inHull</span><span class="params">(Point A, <span class="type">int</span> n, Point ch[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> l = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> r = n - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (r - l &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="type">int</span> mid = ((r - l) &gt;&gt; <span class="number">1</span>) + l;</span><br><span class="line">        <span class="type">double</span> a1 = <span class="built_in">Cross</span>(ch[mid] - ch[<span class="number">0</span>], A - ch[<span class="number">0</span>]);</span><br><span class="line">        <span class="type">double</span> a2 = <span class="built_in">Cross</span>(ch[mid + <span class="number">1</span>] - ch[<span class="number">0</span>], A - ch[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">sgn</span>(a1) &gt;= <span class="number">0</span> &amp;&amp; <span class="built_in">sgn</span>(a2) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">sgn</span>(<span class="built_in">Cross</span>(ch[mid + <span class="number">1</span>] - ch[mid], A - ch[mid])) &gt;= <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">sgn</span>(a1) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            r = mid;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            l = mid;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="旋转卡壳-Rotating-calipers"><a href="#旋转卡壳-Rotating-calipers" class="headerlink" title="旋转卡壳 Rotating_calipers"></a>旋转卡壳 Rotating_calipers</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Point p[N], con[N];</span><br><span class="line"><span class="type">int</span> n;<span class="comment">//凸包返回的点数</span></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">Rotating_calipers</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> op = <span class="number">1</span>;</span><br><span class="line">    <span class="type">double</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">H</span>(A[i], A[i + <span class="number">1</span>], A[p % n + <span class="number">1</span>]) &gt;= <span class="built_in">H</span>(A[i], A[i + <span class="number">1</span>], A[p])) p = (p + <span class="number">1</span>) % n;</span><br><span class="line">        <span class="comment">//H()为所求的接踵点对条件的计算，这里只卡了一个点可以卡多个点，后续根据实际题目写代码</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>求凸包直径</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Point p[N], con[N];</span><br><span class="line"><span class="type">int</span> con_num;<span class="comment">//凸包返回的点数</span></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">Rotating_calipers</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> op = <span class="number">1</span>;</span><br><span class="line">    <span class="type">double</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; con_num; ++i) &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">Cross</span>((con[i] - con[op]), (con[i + <span class="number">1</span>] - con[i])) &lt; <span class="built_in">Cross</span>((con[i] - con[op + <span class="number">1</span>]), (con[i + <span class="number">1</span>] - con[i])))</span><br><span class="line">            op = (op + <span class="number">1</span>) % con_num;</span><br><span class="line">        ans = <span class="built_in">max</span>(ans, <span class="built_in">max</span>(<span class="built_in">dis</span>(con[i], con[op]), <span class="built_in">dis</span>(con[i + <span class="number">1</span>], con[op])));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="最小矩形覆盖"><a href="#最小矩形覆盖" class="headerlink" title="最小矩形覆盖"></a>最小矩形覆盖</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//计算ac在ab上的投影长度</span></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">project</span><span class="params">(Vector a, Vector b, Vector c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Dot</span>(b - a, c - a) / <span class="built_in">Length</span>(b - a);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ac</span><span class="params">(<span class="type">int</span> n, Point *p, Point *rec, <span class="type">double</span> &amp;ans)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>, a = <span class="number">2</span>, b = <span class="number">1</span>, c = <span class="number">2</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">auto</span> d = p[i], e = p[i + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">sgn</span>(<span class="built_in">Area2</span>(d, e, p[a]) - <span class="built_in">Area2</span>(d, e, p[a + <span class="number">1</span>])) &lt; <span class="number">0</span>) a = (a + <span class="number">1</span>) % n;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">sgn</span>(<span class="built_in">project</span>(d, e, p[b]) - <span class="built_in">project</span>(d, e, p[b + <span class="number">1</span>])) &lt; <span class="number">0</span>) b = (b + <span class="number">1</span>) % n;</span><br><span class="line">        <span class="keyword">if</span> (!i) c = a;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">sgn</span>(<span class="built_in">project</span>(d, e, p[c]) - <span class="built_in">project</span>(d, e, p[c + <span class="number">1</span>])) &gt; <span class="number">0</span>) c = (c + <span class="number">1</span>) % n;</span><br><span class="line">        <span class="keyword">auto</span> x = p[a], y = p[b], z = p[c];</span><br><span class="line">        <span class="keyword">auto</span> h = <span class="built_in">Area2</span>(d, e, x) / <span class="built_in">Length</span>(e - d);</span><br><span class="line">        <span class="keyword">auto</span> w = <span class="built_in">Dot</span>(y - z, e - d) / <span class="built_in">Length</span>(e - d);</span><br><span class="line">        <span class="keyword">if</span> (h * w &lt; ans) &#123;</span><br><span class="line">            ans = h * w;</span><br><span class="line">            rec[<span class="number">0</span>] = d + (e - d) / <span class="built_in">Length</span>(e - d) * <span class="built_in">project</span>(d, e, y);</span><br><span class="line">            rec[<span class="number">3</span>] = d + (e - d) / <span class="built_in">Length</span>(e - d) * <span class="built_in">project</span>(d, e, z);</span><br><span class="line">            <span class="keyword">auto</span> u = <span class="built_in">Normal</span>(e - d);</span><br><span class="line">            rec[<span class="number">1</span>] = rec[<span class="number">0</span>] + u * h;</span><br><span class="line">            rec[<span class="number">2</span>] = rec[<span class="number">3</span>] + u * h;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    printf(&quot;%.5Lf\n&quot;, ans);//ans为面积</span></span><br><span class="line"><span class="comment">    for (int i = 0; i &lt; 4; i++) &#123;</span></span><br><span class="line"><span class="comment">        if (sgn(rec[i].x) == 0) rec[i].x = 0;</span></span><br><span class="line"><span class="comment">        if (sgn(rec[i].y) == 0) rec[i].y = 0;</span></span><br><span class="line"><span class="comment">        printf(&quot;%.5Lf %.5Lf\n&quot;, rec[i].x, rec[i].y);</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h4 id="闵可夫斯基和"><a href="#闵可夫斯基和" class="headerlink" title="闵可夫斯基和"></a>闵可夫斯基和</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Vector V1[N], V2[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Mincowski</span><span class="params">(Point *P1, <span class="type">int</span> n, Point *P2, <span class="type">int</span> m, Vector *V)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 【闵可夫斯基和】求两个凸包&#123;P1&#125;, &#123;P2&#125;的向量集合&#123;V&#125; = &#123;P1 + P2&#125;构成的凸包</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) V1[i] = P1[(i + <span class="number">1</span>) % n] - P1[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; ++i) V2[i] = P2[(i + <span class="number">1</span>) % m] - P2[i];</span><br><span class="line">    <span class="type">int</span> t = <span class="number">0</span>, i = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">    V[t++] = P1[<span class="number">0</span>] + P2[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">while</span> (i &lt; n &amp;&amp; j &lt; m) V[t++] = V[t - <span class="number">1</span>] + (<span class="built_in">sgn</span>(<span class="built_in">Cross</span>(V1[i], V2[j])) &gt; <span class="number">0</span> ? V1[i++] : V2[j++]);</span><br><span class="line">    <span class="keyword">while</span> (i &lt; n) V[t++] = V[t - <span class="number">1</span>] + V1[i++];</span><br><span class="line">    <span class="keyword">while</span> (j &lt; m) V[t++] = V[t - <span class="number">1</span>] + V2[j++];</span><br><span class="line">    <span class="keyword">return</span> t;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="半平面交"><a href="#半平面交" class="headerlink" title="半平面交"></a>半平面交</h4><p>最好使用scanf和printf进行输入输出</p>
<p>所用直线（有向） </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//切记使用方法，半平面交为向量左侧，向Line中赋值时需要使用Line结构体</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Line L[100];</span></span><br><span class="line"><span class="comment">L[i]=Line(a,a-b);//前一个为点，后一个为向量，向量方向为箭头坐标减去箭尾坐标</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Line</span> &#123;</span><br><span class="line">    Point P;</span><br><span class="line">    Vector v;</span><br><span class="line">    <span class="type">double</span> deg;</span><br><span class="line">    <span class="built_in">Line</span>() &#123;&#125;</span><br><span class="line">    <span class="built_in">Line</span>(Point P, Vector v) :<span class="built_in">P</span>(P), <span class="built_in">v</span>(v) &#123; deg = <span class="built_in">atan2</span>(v.y, v.x); &#125;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> Line&amp; L)<span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> deg &lt; L.deg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//注意这里的Line定义不同于基础函数中Line的定义使用时需删除基础定义</span></span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">on_left</span><span class="params">(Line L, Point P)</span> </span>&#123;<span class="comment">//注意题目是否包含等号</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sgn</span>(<span class="built_in">Cross</span>(L.v, P - L.P)) &gt;= <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Point <span class="title">get_intersection</span><span class="params">(Line a, Line b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Vector u = a.P - b.P;</span><br><span class="line">    <span class="type">double</span> t = <span class="built_in">Cross</span>(b.v, u) / <span class="built_in">Cross</span>(a.v, b.v);</span><br><span class="line">    <span class="keyword">return</span> a.P + a.v * t;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">half_plane_intersection</span><span class="params">(Line* L, <span class="type">int</span> n, Point* poly)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(L, L + n);</span><br><span class="line">    <span class="type">int</span> first, last;</span><br><span class="line">    Point* p = <span class="keyword">new</span> Point[n];</span><br><span class="line">    Line* q = <span class="keyword">new</span> Line[n];</span><br><span class="line">    q[first = last = <span class="number">0</span>] = L[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="keyword">while</span> (first &lt; last &amp;&amp; !<span class="built_in">on_left</span>(L[i], p[last - <span class="number">1</span>]))last--;</span><br><span class="line">        <span class="keyword">while</span> (first &lt; last &amp;&amp; !<span class="built_in">on_left</span>(L[i], p[first]))first++;</span><br><span class="line">        q[++last] = L[i];</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">fabs</span>(<span class="built_in">Cross</span>(q[last].v, q[last - <span class="number">1</span>].v)) &lt; eps) &#123;</span><br><span class="line">            last--;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">on_left</span>(q[last], L[i].P))q[last] = L[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (first &lt; last)p[last - <span class="number">1</span>] = <span class="built_in">get_intersection</span>(q[last - <span class="number">1</span>], q[last]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (first &lt; last &amp;&amp; !<span class="built_in">on_left</span>(q[first], p[last - <span class="number">1</span>]))last--;</span><br><span class="line">    <span class="keyword">if</span> (last - first &lt;= <span class="number">1</span>)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    p[last] = <span class="built_in">get_intersection</span>(q[last], q[first]);</span><br><span class="line">    <span class="type">int</span> m = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = first; i &lt;= last; ++i)poly[m++] = p[i];</span><br><span class="line">    <span class="keyword">return</span> m;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>二分半平面交</p>
<p>eg：给出一个凸多边形海岛求，海岛上距离海最远的距离</p>
<p>进行二分半平面交，二分对象为是否有这个点到各个边的距离是mid，二分半平面需要额外使用Normal函数求法向量</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Line</span> &#123;</span><br><span class="line">    Point P;</span><br><span class="line">    Vector v;</span><br><span class="line">    <span class="type">double</span> deg;</span><br><span class="line">    <span class="built_in">Line</span>() &#123;&#125;</span><br><span class="line">    <span class="built_in">Line</span>(Point P, Vector v) :<span class="built_in">P</span>(P), <span class="built_in">v</span>(v) &#123; deg = <span class="built_in">atan2</span>(v.y, v.x); &#125;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> Line&amp; L)<span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> deg &lt; L.deg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">on_left</span><span class="params">(Line L, Point P)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">Cross</span>(L.v, P - L.P) &gt; <span class="number">0</span>; &#125;</span><br><span class="line"><span class="function">Point <span class="title">get_intersection</span><span class="params">(Line a, Line b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Vector u = a.P - b.P;</span><br><span class="line">    <span class="type">double</span> t = <span class="built_in">Cross</span>(b.v, u) / <span class="built_in">Cross</span>(a.v, b.v);</span><br><span class="line">    <span class="keyword">return</span> a.P + a.v * t;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">half_plane_intersection</span><span class="params">(Line* L, <span class="type">int</span> n, Point* poly)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(L, L + n);</span><br><span class="line">    <span class="type">int</span> first, last;</span><br><span class="line">    Point* p = <span class="keyword">new</span> Point[n];</span><br><span class="line">    Line* q = <span class="keyword">new</span> Line[n];</span><br><span class="line">    q[first = last = <span class="number">0</span>] = L[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="keyword">while</span> (first &lt; last &amp;&amp; !<span class="built_in">on_left</span>(L[i], p[last - <span class="number">1</span>]))last--;</span><br><span class="line">        <span class="keyword">while</span> (first &lt; last &amp;&amp; !<span class="built_in">on_left</span>(L[i], p[first]))first++;</span><br><span class="line">        q[++last] = L[i];</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">fabs</span>(<span class="built_in">Cross</span>(q[last].v, q[last - <span class="number">1</span>].v)) &lt; eps) &#123;</span><br><span class="line">            last--;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">on_left</span>(q[last], L[i].P))q[last] = L[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (first &lt; last)p[last - <span class="number">1</span>] = <span class="built_in">get_intersection</span>(q[last - <span class="number">1</span>], q[last]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (first &lt; last &amp;&amp; !<span class="built_in">on_left</span>(q[first], p[last - <span class="number">1</span>]))last--;</span><br><span class="line">    <span class="keyword">if</span> (last - first &lt;= <span class="number">1</span>)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    p[last] = <span class="built_in">get_intersection</span>(q[last], q[first]);</span><br><span class="line">    <span class="type">int</span> m = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = first; i &lt;= last; ++i)poly[m++] = p[i];</span><br><span class="line">    <span class="keyword">return</span> m;</span><br><span class="line">&#125;</span><br><span class="line">Line L[N];</span><br><span class="line">Point poly[N];</span><br><span class="line">Point p[N];</span><br><span class="line">Vector v[N], v1[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lf %lf&quot;</span>, &amp;p[i].x, &amp;p[i].y);</span><br><span class="line">    &#125;</span><br><span class="line">    p[n] = p[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        v[i] = p[i + <span class="number">1</span>] - p[i];</span><br><span class="line">        v1[i] = <span class="built_in">Normal</span>(v[i]);<span class="comment">//单位法向量，即v[i]向左旋转90</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">double</span> l = <span class="number">0</span>, r = <span class="number">20000</span>;</span><br><span class="line">    <span class="keyword">while</span> (r - l &gt; eps) &#123;</span><br><span class="line">        <span class="type">double</span> mid = l + (r - l) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            L[i] = <span class="built_in">Line</span>(p[i] + v1[i] * mid, v[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> m = <span class="built_in">half_plane_intersection</span>(L, n, poly);</span><br><span class="line">        <span class="keyword">if</span> (!m) r = mid;</span><br><span class="line">        <span class="keyword">else</span> l = mid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.6lf\n&quot;</span>, l);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="平面最近点对"><a href="#平面最近点对" class="headerlink" title="平面最近点对"></a>平面最近点对</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">4e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> DINF = <span class="number">1e18</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">  <span class="type">double</span> x, y;</span><br><span class="line">  <span class="built_in">Point</span>(<span class="type">double</span> x = <span class="number">0</span>, <span class="type">double</span> y = <span class="number">0</span>) : <span class="built_in">x</span>(x), <span class="built_in">y</span>(y) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line">Point p[N];</span><br><span class="line"><span class="type">int</span> tmp[N], n;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(<span class="type">const</span> Point &amp;a, <span class="type">const</span> Point &amp;b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (a.x == b.x)<span class="keyword">return</span> a.y &lt; b.y;</span><br><span class="line">    <span class="keyword">return</span> a.x &lt; b.x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmps</span><span class="params">(<span class="type">const</span> <span class="type">int</span> &amp;a, <span class="type">const</span> <span class="type">int</span> &amp;b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> p[a].y &lt; p[b].y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">dis</span><span class="params">(Point p, Point q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (p.x - q.x) * (p.x - q.x) + (p.y - q.y) * (p.y - q.y);</span><br><span class="line">&#125;</span><br><span class="line">Point q[N];</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">merge</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">double</span> d = DINF;</span><br><span class="line">    <span class="keyword">if</span> (l == r) <span class="keyword">return</span> d;</span><br><span class="line">    <span class="type">int</span> mid = (l + r) / <span class="number">2</span>;</span><br><span class="line">    <span class="type">double</span> midx = p[mid].x;</span><br><span class="line">    d = <span class="built_in">min</span>(<span class="built_in">merge</span>(l, mid), <span class="built_in">merge</span>(mid + <span class="number">1</span>, r));</span><br><span class="line">    <span class="type">int</span> p1 = l, p2 = mid + <span class="number">1</span>, tot = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (p1 &lt;= mid || p2 &lt;= r) &#123;</span><br><span class="line">        <span class="keyword">if</span> (p1 &lt;= mid &amp;&amp; (p2 &gt; r || p[p1].y &lt; p[p2].y)) &#123;</span><br><span class="line">            q[++tot] = p[p1++];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            q[++tot] = p[p2++];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= tot; i++) &#123;</span><br><span class="line">        p[l + i - <span class="number">1</span>] = q[i];</span><br><span class="line">    &#125;</span><br><span class="line">    tot = <span class="number">0</span>;</span><br><span class="line">    <span class="type">double</span> dd = d;</span><br><span class="line">    d = <span class="built_in">sqrt</span>(dd);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = l; i &lt;= r; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">abs</span>(p[i].x - midx) &lt;= d) q[++tot] = p[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= tot; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = i - <span class="number">1</span>; j &gt;= <span class="number">1</span> &amp;&amp; q[i].y - q[j].y &lt;= d; j--) &#123;</span><br><span class="line">            dd = <span class="built_in">min</span>(dd, <span class="built_in">dis</span>(q[i], q[j]));</span><br><span class="line">            d = <span class="built_in">sqrt</span>(dd);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dd;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lf%lf&quot;</span>, &amp;p[i].x, &amp;p[i].y);</span><br><span class="line">    <span class="built_in">sort</span>(p + <span class="number">1</span>, p + <span class="number">1</span> + n, cmp);</span><br><span class="line">    <span class="type">double</span> ans = <span class="built_in">merge</span>(<span class="number">1</span>, n);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.0lf\n&quot;</span>, ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="三角剖分-CulArea"><a href="#三角剖分-CulArea" class="headerlink" title="三角剖分 CulArea"></a>三角剖分 CulArea</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">double</span> <span class="title">CulArea</span><span class="params">(Point A, Point B, Circle C)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Vector OA = A - C.c, OB = B - C.c;</span><br><span class="line">    Vector BA = A - B, BC = C.c - B;</span><br><span class="line">    Vector AB = B - A, AC = C.c - A;</span><br><span class="line">    <span class="type">double</span> DOA = <span class="built_in">Length</span>(OA), DOB = <span class="built_in">Length</span>(OB), DAB = <span class="built_in">Length</span>(AB), r = C.r;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">sgn</span>(<span class="built_in">Cross</span>(OA, OB)) == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">sgn</span>(DOA - C.r) &lt; <span class="number">0</span> &amp;&amp; <span class="built_in">sgn</span>(DOB - C.r) &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="built_in">Cross</span>(OA, OB) * <span class="number">0.5</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (DOB &lt; r &amp;&amp; DOA &gt;= r) &#123;</span><br><span class="line">        <span class="type">double</span> x = (<span class="built_in">Dot</span>(BA, BC) + <span class="built_in">sqrtl</span>(r * r * DAB * DAB - <span class="built_in">Cross</span>(BA, BC) * <span class="built_in">Cross</span>(BA, BC))) / DAB;</span><br><span class="line">        <span class="type">double</span> TS = <span class="built_in">Cross</span>(OA, OB) * <span class="number">0.5</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">asinl</span>(TS * (<span class="number">1</span> - x / DAB) * <span class="number">2</span> / r / DOA) * r * r * <span class="number">0.5</span> + TS * x / DAB;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (DOB &gt;= r &amp;&amp; DOA &lt; r) &#123;</span><br><span class="line">        <span class="type">double</span> y = (<span class="built_in">Dot</span>(AB, AC) + <span class="built_in">sqrtl</span>(r * r * DAB * DAB - <span class="built_in">Cross</span>(AB, AC) * <span class="built_in">Cross</span>(AB, AC))) / DAB;</span><br><span class="line">        <span class="type">double</span> TS = <span class="built_in">Cross</span>(OA, OB) * <span class="number">0.5</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">asinl</span>(TS * (<span class="number">1</span> - y / DAB) * <span class="number">2</span> / r / DOB) * r * r * <span class="number">0.5</span> + TS * y / DAB;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">fabs</span>(<span class="built_in">Cross</span>(OA, OB)) &gt;= r * DAB || <span class="built_in">Dot</span>(AB, AC) &lt;= <span class="number">0</span> || <span class="built_in">Dot</span>(BA, BC) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">Dot</span>(OA, OB) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">Cross</span>(OA, OB) &lt; <span class="number">0</span>) <span class="built_in">return</span> (-<span class="built_in">acosl</span>(<span class="number">-1.0</span>) - <span class="built_in">asinl</span>(<span class="built_in">Cross</span>(OA, OB) / DOA / DOB)) * r * r * <span class="number">0.5</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">return</span> (<span class="built_in">acosl</span>(<span class="number">-1.0</span>) - <span class="built_in">asinl</span>(<span class="built_in">Cross</span>(OA, OB) / DOA / DOB)) * r * r * <span class="number">0.5</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">asinl</span>(<span class="built_in">Cross</span>(OA, OB) / DOA / DOB) * r * r * <span class="number">0.5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">double</span> x = (<span class="built_in">Dot</span>(BA, BC) + <span class="built_in">sqrtl</span>(r * r * DAB * DAB - <span class="built_in">Cross</span>(BA, BC) * <span class="built_in">Cross</span>(BA, BC))) / DAB;</span><br><span class="line">        <span class="type">double</span> y = (<span class="built_in">Dot</span>(AB, AC) + <span class="built_in">sqrtl</span>(r * r * DAB * DAB - <span class="built_in">Cross</span>(AB, AC) * <span class="built_in">Cross</span>(AB, AC))) / DAB;</span><br><span class="line">        <span class="type">double</span> TS = <span class="built_in">Cross</span>(OA, OB) * <span class="number">0.5</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">asinl</span>(TS * (<span class="number">1</span> - x / DAB) * <span class="number">2</span> / r / DOA) + <span class="built_in">asinl</span>(TS * (<span class="number">1</span> - y / DAB) * <span class="number">2</span> / r / DOB)) * r * r * <span class="number">0.5</span> + TS * ((x + y) / DAB - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    double res = 0;</span></span><br><span class="line"><span class="comment">    for(int i = 0; i &lt; n; i ++)&#123;</span></span><br><span class="line"><span class="comment">        res += CulArea(p[i], p[(i + 1) % n], C);</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    cout &lt;&lt; fabs(res) &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h2 id="三维计算几何"><a href="#三维计算几何" class="headerlink" title="三维计算几何"></a>三维计算几何</h2><h3 id="基础函数"><a href="#基础函数" class="headerlink" title="基础函数"></a>基础函数</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">double</span> EPS = <span class="number">0.000001</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">Point3</span> &#123;</span><br><span class="line">    <span class="type">double</span> x, y, z;</span><br><span class="line">    <span class="built_in">Point3</span>(<span class="type">double</span> x = <span class="number">0</span>, <span class="type">double</span> y = <span class="number">0</span>, <span class="type">double</span> z = <span class="number">0</span>) : <span class="built_in">x</span>(x), <span class="built_in">y</span>(y), <span class="built_in">z</span>(z) &#123;&#125;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> == (<span class="type">const</span> Point3&amp; A) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x==A.x &amp;&amp; y==A.y &amp;&amp; z==A.z;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">typedef</span> Point3 Vector3;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Line3</span>   <span class="comment">//空间直线</span></span><br><span class="line">&#123;</span><br><span class="line">    Point3 a, b;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Plane3</span>   <span class="comment">//空间平面</span></span><br><span class="line">&#123;</span><br><span class="line">    Point3 a, b, c;</span><br><span class="line">    <span class="built_in">Plane3</span>() &#123;&#125;</span><br><span class="line">    <span class="built_in">Plane3</span>(Point3 a, Point3 b, Point3 c) :</span><br><span class="line">        <span class="built_in">a</span>(a), <span class="built_in">b</span>(b), <span class="built_in">c</span>(c) &#123; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="function">Point3 <span class="title">read_Point3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">double</span> x, y, z;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lf%lf%lf&quot;</span>, &amp;x, &amp;y, &amp;z);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Point3</span>(x, y, z);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">Vector3 <span class="keyword">operator</span> + (<span class="type">const</span> Vector3&amp; A, <span class="type">const</span> Vector3&amp; B) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Vector3</span>(A.x + B.x, A.y + B.y, A.z + B.z);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">Vector3 <span class="keyword">operator</span> - (<span class="type">const</span> Point3&amp; A, <span class="type">const</span> Point3&amp; B) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Vector3</span>(A.x - B.x, A.y - B.y, A.z - B.z);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">Vector3 <span class="keyword">operator</span> * (<span class="type">const</span> Vector3&amp; A, <span class="type">double</span> p) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Vector3</span>(A.x * p, A.y * p, A.z * p);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">Vector3 <span class="keyword">operator</span> / (<span class="type">const</span> Vector3&amp; A, <span class="type">double</span> p) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Vector3</span>(A.x / p, A.y / p, A.z / p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">Dot</span><span class="params">(Vector3 A, Vector3 B)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> A.x * B.x + A.y * B.y + A.z * B.z;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">Length</span><span class="params">(Vector3 A)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">sqrt</span>(<span class="built_in">Dot</span>(A, A)); &#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">Angle</span><span class="params">(Vector3 A, Vector3 B)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">acos</span>(<span class="built_in">Dot</span>(A, B) / <span class="built_in">Length</span>(A) / <span class="built_in">Length</span>(B)); &#125;</span><br><span class="line"><span class="comment">//叉积</span></span><br><span class="line"><span class="function">Vector3 <span class="title">Cross</span><span class="params">(<span class="type">const</span> Vector3&amp; A, <span class="type">const</span> Vector3&amp; B)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Vector3</span>(A.y * B.z - A.z * B.y, A.z * B.x - A.x * B.z, A.x * B.y - A.y * B.x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 三角形abc面积的两倍</span></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">Area2</span><span class="params">(<span class="type">const</span> Point3&amp; A, <span class="type">const</span> Point3&amp; B, <span class="type">const</span> Point3&amp; C)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Length</span>(<span class="built_in">Cross</span>(B - A, C - A));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="矢量差-Subt"><a href="#矢量差-Subt" class="headerlink" title="矢量差 Subt"></a>矢量差 Subt</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Point3 <span class="title">Subt</span><span class="params">( Point3 u, Point3 v )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Point3 ret;</span><br><span class="line">    ret.x = u.x - v.x;</span><br><span class="line">    ret.y = u.y - v.y;</span><br><span class="line">    ret.z = u.z - v.z;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="平面法向量-NormalVector"><a href="#平面法向量-NormalVector" class="headerlink" title="平面法向量 NormalVector"></a>平面法向量 NormalVector</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Point3 <span class="title">NormalVector</span><span class="params">( Plane3 s )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Cross</span>( <span class="built_in">Subt</span>( s.a, s.b ), <span class="built_in">Subt</span>( s.b, s.c ) );</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Point3 <span class="title">NormalVector</span><span class="params">( Point3 a, Point3 b, Point3 c )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Cross</span>( <span class="built_in">Subt</span>( a, b ), <span class="built_in">Subt</span>( b, c ) );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="两点距离-TwoPointDistance"><a href="#两点距离-TwoPointDistance" class="headerlink" title="两点距离 TwoPointDistance"></a>两点距离 TwoPointDistance</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">double</span> <span class="title">TwoPointDistance</span><span class="params">( Point3 p1, Point3 p2 )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sqrt</span>( (p<span class="number">1.</span>x - p<span class="number">2.</span>x)*(p<span class="number">1.</span>x - p<span class="number">2.</span>x) + (p<span class="number">1.</span>y - p<span class="number">2.</span>y)*(p<span class="number">1.</span>y - p<span class="number">2.</span>y) + (p<span class="number">1.</span>z - p<span class="number">2.</span>z)*(p<span class="number">1.</span>z - p<span class="number">2.</span>z) );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="点p到平面的距离-DistanceToPlane"><a href="#点p到平面的距离-DistanceToPlane" class="headerlink" title="点p到平面的距离 DistanceToPlane"></a>点p到平面的距离 DistanceToPlane</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 点p到平面p0-n的距离。n必须为单位向量</span></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">DistanceToPlane</span><span class="params">(<span class="type">const</span> Point3&amp; p, <span class="type">const</span> Point3&amp; p0, <span class="type">const</span> Vector3&amp; n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">fabs</span>(<span class="built_in">Dot</span>(p - p0, n)); <span class="comment">// 如果不取绝对值，得到的是有向距离</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="点p在平面上的投影-GetPlaneProjection"><a href="#点p在平面上的投影-GetPlaneProjection" class="headerlink" title="点p在平面上的投影 GetPlaneProjection"></a>点p在平面上的投影 GetPlaneProjection</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 点p在平面p0-n上的投影。n必须为单位向量(如果不是单位向量就/Length(n)嘛)</span></span><br><span class="line"><span class="function">Point3 <span class="title">GetPlaneProjection</span><span class="params">(<span class="type">const</span> Point3&amp; p, <span class="type">const</span> Point3&amp; p0, <span class="type">const</span> Vector3&amp; n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> p - n * <span class="built_in">Dot</span>(p - p0, n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="直线与平面的交点-LinePlaneIntersection"><a href="#直线与平面的交点-LinePlaneIntersection" class="headerlink" title="直线与平面的交点 LinePlaneIntersection"></a>直线与平面的交点 LinePlaneIntersection</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//直线p1-p2 与平面p0-n的交点</span></span><br><span class="line"><span class="function">Point3 <span class="title">LinePlaneIntersection</span><span class="params">(Point3 p1, Point3 p2, Point3 p0, Vector3 n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Vector3 v = p2 - p1;</span><br><span class="line">    <span class="type">double</span> t = (<span class="built_in">Dot</span>(n, p0 - p1) / <span class="built_in">Dot</span>(n, p2 - p1)); <span class="comment">//分母为0，直线与平面平行或在平面上</span></span><br><span class="line">    <span class="keyword">return</span> p1 + v * t; <span class="comment">//如果是线段 判断t是否在0~1之间</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="空间直线距离-LineToLine"><a href="#空间直线距离-LineToLine" class="headerlink" title="空间直线距离 LineToLine"></a>空间直线距离 LineToLine</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//空间直线距离,tmp为两直线的公共法向量</span></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">LineToLine</span><span class="params">(Line3 u, Line3 v, Point3&amp; tmp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    tmp = <span class="built_in">Cross</span>(<span class="built_in">Subt</span>(u.a, u.b), <span class="built_in">Subt</span>(v.a, v.b));</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">fabs</span>(<span class="built_in">Dot</span>(<span class="built_in">Subt</span>(u.a, v.a), tmp)) / <span class="built_in">Length</span>(tmp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="点到直线的距离-DistanceToLine"><a href="#点到直线的距离-DistanceToLine" class="headerlink" title="点到直线的距离 DistanceToLine"></a>点到直线的距离 DistanceToLine</h3><p>点p到平面AB距离</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">double</span> <span class="title">DistanceToLine</span><span class="params">(<span class="type">const</span> Point3&amp; P, <span class="type">const</span> Point3&amp; A, <span class="type">const</span> Point3&amp; B)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Vector3 v1 = B - A, v2 = P - A;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Length</span>(<span class="built_in">Cross</span>(v1, v2)) / <span class="built_in">Length</span>(v1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="点到线段的距离-DistanceToSeg"><a href="#点到线段的距离-DistanceToSeg" class="headerlink" title="点到线段的距离 DistanceToSeg"></a>点到线段的距离 DistanceToSeg</h3><p>p到AB</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">double</span> <span class="title">DistanceToSeg</span><span class="params">(Point3 p, Point3 a, Point3 b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (a == b)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Length</span>(p - a);</span><br><span class="line">    Vector3 v1 = b - a, v2 = p - a, v3 = p - b;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Dot</span>(v1, v2) + EPS &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Length</span>(v2);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">Dot</span>(v1, v3) - EPS &gt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Length</span>(v3);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Length</span>(<span class="built_in">Cross</span>(v1, v2)) / <span class="built_in">Length</span>(v1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="求异面直线与的公垂线对应的s-LineDistance3D"><a href="#求异面直线与的公垂线对应的s-LineDistance3D" class="headerlink" title="求异面直线与的公垂线对应的s LineDistance3D"></a>求异面直线与的公垂线对应的s LineDistance3D</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//求异面直线 p1+s*u与p2+t*v的公垂线对应的s 如果平行|重合，返回false,相交true</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">LineDistance3D</span><span class="params">(Point3 p1, Vector3 u, Point3 p2, Vector3 v, <span class="type">double</span>&amp; s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">double</span> b = <span class="built_in">Dot</span>(u, u) * <span class="built_in">Dot</span>(v, v) - <span class="built_in">Dot</span>(u, v) * <span class="built_in">Dot</span>(u, v);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">abs</span>(b) &lt;= EPS)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="type">double</span> a = <span class="built_in">Dot</span>(u, v) * <span class="built_in">Dot</span>(v, p1 - p2) - <span class="built_in">Dot</span>(v, v) * <span class="built_in">Dot</span>(u, p1 - p2);</span><br><span class="line">    s = a / b;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="p1和p2是否在线段a-b的同侧-SameSide"><a href="#p1和p2是否在线段a-b的同侧-SameSide" class="headerlink" title="p1和p2是否在线段a-b的同侧 SameSide"></a>p1和p2是否在线段a-b的同侧 SameSide</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">SameSide</span><span class="params">(<span class="type">const</span> Point3&amp; p1, <span class="type">const</span> Point3&amp; p2, <span class="type">const</span> Point3&amp; a, <span class="type">const</span> Point3&amp; b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Dot</span>(<span class="built_in">Cross</span>(b - a, p1 - a), <span class="built_in">Cross</span>(b - a, p2 - a)) - EPS &gt;= <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="判断点P是否在三角形中-PointInTri"><a href="#判断点P是否在三角形中-PointInTri" class="headerlink" title="判断点P是否在三角形中 PointInTri"></a>判断点P是否在三角形中 PointInTri</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">PointInTri</span><span class="params">(<span class="type">const</span> Point3&amp; P, <span class="type">const</span> Point3&amp; P0, <span class="type">const</span> Point3&amp; P1, <span class="type">const</span> Point3&amp; P2)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">SameSide</span>(P, P0, P1, P2) &amp;&amp; <span class="built_in">SameSide</span>(P, P1, P0, P2) &amp;&amp; <span class="built_in">SameSide</span>(P, P2, P0, P1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="判断P是否在三角形A-B-C中，并且到三条边的距离都至少为mindist-InsideWithMinDistance"><a href="#判断P是否在三角形A-B-C中，并且到三条边的距离都至少为mindist-InsideWithMinDistance" class="headerlink" title="判断P是否在三角形A, B, C中，并且到三条边的距离都至少为mindist InsideWithMinDistance"></a>判断P是否在三角形A, B, C中，并且到三条边的距离都至少为mindist InsideWithMinDistance</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">InsideWithMinDistance</span><span class="params">(<span class="type">const</span> Point3&amp; P, <span class="type">const</span> Point3&amp; A, <span class="type">const</span> Point3&amp; B, <span class="type">const</span> Point3&amp; C, <span class="type">double</span> mindist)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">PointInTri</span>(P, A, B, C))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">DistanceToLine</span>(P, A, B) &lt; mindist)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">DistanceToLine</span>(P, B, C) &lt; mindist)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">DistanceToLine</span>(P, C, A) &lt; mindist)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="判断P是否在凸四边形中，并且到四条边的距离都至少为mindist-InsideWithMinDistance"><a href="#判断P是否在凸四边形中，并且到四条边的距离都至少为mindist-InsideWithMinDistance" class="headerlink" title="判断P是否在凸四边形中，并且到四条边的距离都至少为mindist InsideWithMinDistance"></a>判断P是否在凸四边形中，并且到四条边的距离都至少为mindist InsideWithMinDistance</h3><p>凸四边形ABCD（顺时针或逆时针）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">InsideWithMinDistance</span><span class="params">(<span class="type">const</span> Point3&amp; P, <span class="type">const</span> Point3&amp; A, <span class="type">const</span> Point3&amp; B, <span class="type">const</span> Point3&amp; C, <span class="type">const</span> Point3&amp; D, <span class="type">double</span> mindist)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">PointInTri</span>(P, A, B, C))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">PointInTri</span>(P, C, D, A))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">DistanceToLine</span>(P, A, B) &lt; mindist)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">DistanceToLine</span>(P, B, C) &lt; mindist)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">DistanceToLine</span>(P, C, D) &lt; mindist)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">DistanceToLine</span>(P, D, A) &lt; mindist)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="三角形P0、P1、P2是否和线段AB相交-TriSegIntersection"><a href="#三角形P0、P1、P2是否和线段AB相交-TriSegIntersection" class="headerlink" title="三角形P0、P1、P2是否和线段AB相交 TriSegIntersection"></a>三角形P0、P1、P2是否和线段AB相交 TriSegIntersection</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">TriSegIntersection</span><span class="params">(<span class="type">const</span> Point3&amp; P0, <span class="type">const</span> Point3&amp; P1, <span class="type">const</span> Point3&amp; P2, <span class="type">const</span> Point3&amp; A, <span class="type">const</span> Point3&amp; B, Point3&amp; P)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Vector3 n = <span class="built_in">Cross</span>(P1 - P0, P2 - P0);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">abs</span>(<span class="built_in">Dot</span>(n, B - A)) &lt;= EPS)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;    <span class="comment">// 线段A-B和平面P0P1P2平行或共面</span></span><br><span class="line">    <span class="keyword">else</span>   <span class="comment">// 平面A和直线P1-P2有惟一交点</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">double</span> t = <span class="built_in">Dot</span>(n, P0 - A) / <span class="built_in">Dot</span>(n, B - A);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (t + EPS &lt; <span class="number">0</span> || t - <span class="number">1</span> - EPS &gt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;    <span class="comment">// 不在线段AB上 </span></span><br><span class="line">        P = A + (B - A) * t; <span class="comment">// 交点</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">PointInTri</span>(P, P0, P1, P2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="空间两三角形是否相交-TriTriIntersection"><a href="#空间两三角形是否相交-TriTriIntersection" class="headerlink" title="空间两三角形是否相交 TriTriIntersection"></a>空间两三角形是否相交 TriTriIntersection</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">TriTriIntersection</span><span class="params">(Point3* T1, Point3* T2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Point3 P;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">TriSegIntersection</span>(T1[<span class="number">0</span>], T1[<span class="number">1</span>], T1[<span class="number">2</span>], T2[i], T2[(i + <span class="number">1</span>) % <span class="number">3</span>], P))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">TriSegIntersection</span>(T2[<span class="number">0</span>], T2[<span class="number">1</span>], T2[<span class="number">2</span>], T1[i], T1[(i + <span class="number">1</span>) % <span class="number">3</span>], P))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="空间两直线上最近点对-SegSegDistance"><a href="#空间两直线上最近点对-SegSegDistance" class="headerlink" title="空间两直线上最近点对 SegSegDistance"></a>空间两直线上最近点对 SegSegDistance</h3><p>返回最近距离</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">double</span> <span class="title">SegSegDistance</span><span class="params">(Point3 a1, Point3 b1, Point3 a2, Point3 b2, Point3&amp; ans1, Point3&amp; ans2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Vector3 v1 = (a1 - b1), v2 = (a2 - b2);</span><br><span class="line">    Vector3 N = <span class="built_in">Cross</span>(v1, v2);</span><br><span class="line">    Vector3 ab = (a1 - a2);</span><br><span class="line">    <span class="type">double</span> ans = <span class="built_in">Dot</span>(N, ab) / <span class="built_in">Length</span>(N);</span><br><span class="line">    Point3 p1 = a1, p2 = a2;</span><br><span class="line">    Vector3 d1 = b1 - a1, d2 = b2 - a2;</span><br><span class="line">    <span class="type">double</span> t1, t2;</span><br><span class="line">    t1 = <span class="built_in">Dot</span>((<span class="built_in">Cross</span>(p2 - p1, d2)), <span class="built_in">Cross</span>(d1, d2));</span><br><span class="line">    t2 = <span class="built_in">Dot</span>((<span class="built_in">Cross</span>(p2 - p1, d1)), <span class="built_in">Cross</span>(d1, d2));</span><br><span class="line">    <span class="type">double</span> dd = <span class="built_in">Length</span>((<span class="built_in">Cross</span>(d1, d2)));</span><br><span class="line">    t1 /= dd * dd;</span><br><span class="line">    t2 /= dd * dd;</span><br><span class="line">    ans1 = (a1 + (b1 - a1) * t1);</span><br><span class="line">    ans2 = (a2 + (b2 - a2) * t2);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">fabs</span>(ans);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ab，ac，ad的混合积-四面体体积-Volume6"><a href="#ab，ac，ad的混合积-四面体体积-Volume6" class="headerlink" title="ab，ac，ad的混合积&amp;四面体体积 Volume6"></a>ab，ac，ad的混合积&amp;四面体体积 Volume6</h3><p>四面体(三角形体)abcd的有向体积的6倍(六面体(正方形体)的体积)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">double</span> <span class="title">Volume6</span><span class="params">(<span class="type">const</span> Point3&amp; A, <span class="type">const</span> Point3&amp; B, <span class="type">const</span> Point3&amp; C, <span class="type">const</span> Point3&amp; D)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Dot</span>(D - A, <span class="built_in">Cross</span>(B - A, C - A));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="四面体的重心-Centroid"><a href="#四面体的重心-Centroid" class="headerlink" title="四面体的重心 Centroid"></a>四面体的重心 Centroid</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Point3 <span class="title">Centroid</span><span class="params">(<span class="type">const</span> Point3&amp; A, <span class="type">const</span> Point3&amp; B, <span class="type">const</span> Point3&amp; C, <span class="type">const</span> Point3&amp; D)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (A + B + C + D) / <span class="number">4.0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="凸多面体的重心"><a href="#凸多面体的重心" class="headerlink" title="凸多面体的重心"></a>凸多面体的重心</h3><p>设vi表示第i个四面体的体积，ai表示重心，则多面体的重心为：$$\frac{\sum_{i&#x3D;1}^{n}a_{i}\times v_{i}}{\sum_{i&#x3D;1}^{n}v_{i}}$$</p>
<h3 id="球的体积交and并"><a href="#球的体积交and并" class="headerlink" title="球的体积交and并"></a>球的体积交and并</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">double</span> <span class="title">pow2</span><span class="params">(<span class="type">double</span> x)</span> </span>&#123; <span class="keyword">return</span> x * x; &#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">pow3</span><span class="params">(<span class="type">double</span> x)</span> </span>&#123; <span class="keyword">return</span> x * x * x; &#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">dis</span><span class="params">(Point3 x,Point3 y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow2</span>(x.x - y.x) + <span class="built_in">pow2</span>(x.y - y.y) + <span class="built_in">pow2</span>(x.z - y.z);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">cos</span><span class="params">(<span class="type">double</span> a, <span class="type">double</span> b, <span class="type">double</span> c)</span> </span>&#123; <span class="keyword">return</span> (b * b + c * c - a * a) / (<span class="number">2</span> * b * c); &#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">cap</span><span class="params">(<span class="type">double</span> r, <span class="type">double</span> h)</span> </span>&#123; <span class="keyword">return</span> PI * (r * <span class="number">3</span> - h) * h * h / <span class="number">3</span>; &#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 2球体积交</span></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">sphere_intersect</span><span class="params">(Point3 x, <span class="type">double</span> r1, Point3 y, <span class="type">double</span> r2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">double</span> d = <span class="built_in">dis</span>(x, y);</span><br><span class="line">    <span class="comment">// 相离</span></span><br><span class="line">    <span class="keyword">if</span> (d &gt;= <span class="built_in">pow2</span>(r1 + r2))</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 包含</span></span><br><span class="line">    <span class="keyword">if</span> (d &lt;= <span class="built_in">pow2</span>(r1 - r2))</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">pow3</span>(<span class="built_in">min</span>(r1, r2)) * <span class="number">4</span> * PI / <span class="number">3</span>;</span><br><span class="line">    <span class="comment">// 相交</span></span><br><span class="line">    <span class="type">double</span> h1 = r1 - r1 * <span class="built_in">cos</span>(r2, r1, <span class="built_in">sqrt</span>(d)), h2 = r2 - r2 * <span class="built_in">cos</span>(r1, r2, <span class="built_in">sqrt</span>(d));</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">cap</span>(r1, h1) + <span class="built_in">cap</span>(r2, h2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 2球体积并</span></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">sphere_union</span><span class="params">(Point3 x, <span class="type">double</span> r1, Point3 y, <span class="type">double</span> r2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">double</span> d = <span class="built_in">dis</span>(x, y);</span><br><span class="line">    <span class="comment">// 相离</span></span><br><span class="line">    <span class="keyword">if</span> (d &gt;= <span class="built_in">pow2</span>(r1 + r2))</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">pow3</span>(r1) + <span class="built_in">pow3</span>(r2)) * <span class="number">4</span> * PI / <span class="number">3</span>;</span><br><span class="line">    <span class="comment">// 包含</span></span><br><span class="line">    <span class="keyword">if</span> (d &lt;= <span class="built_in">pow2</span>(r1 - r2))</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">pow3</span>(<span class="built_in">max</span>(r1, r2)) * <span class="number">4</span> * PI / <span class="number">3</span>;</span><br><span class="line">    <span class="comment">// 相交</span></span><br><span class="line">    <span class="type">double</span> h1 = r1 + r1 * <span class="built_in">cos</span>(r2, r1, <span class="built_in">sqrt</span>(d)), h2 = r2 + r2 * <span class="built_in">cos</span>(r1, r2, <span class="built_in">sqrt</span>(d));</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">cap</span>(r1, h1) + <span class="built_in">cap</span>(r2, h2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="三维凸包"><a href="#三维凸包" class="headerlink" title="三维凸包"></a>三维凸包</h3><h4 id="凸多面体-ConvexPolyhedron"><a href="#凸多面体-ConvexPolyhedron" class="headerlink" title="凸多面体 ConvexPolyhedron"></a>凸多面体 ConvexPolyhedron</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ConvexPolyhedron</span> &#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    vector&lt;Point3&gt; P, P2;</span><br><span class="line">    vector&lt;Face&gt; faces;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">read</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n) != <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        P.<span class="built_in">resize</span>(n);</span><br><span class="line">        P<span class="number">2.</span><span class="built_in">resize</span>(n);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            P[i] = <span class="built_in">read_Point3</span>();</span><br><span class="line">            P2[i] = <span class="built_in">add_noise</span>(P[i]);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        faces = <span class="built_in">CH3D</span>(P2);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//三维凸包重心</span></span><br><span class="line">    <span class="function">Point3 <span class="title">centroid</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Point3 C = P[<span class="number">0</span>];</span><br><span class="line">        <span class="type">double</span> totv = <span class="number">0</span>;</span><br><span class="line">        <span class="function">Point3 <span class="title">tot</span><span class="params">(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; faces.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            Point3 p1 = P[faces[i].v[<span class="number">0</span>]], p2 = P[faces[i].v[<span class="number">1</span>]], p3 = P[faces[i].v[<span class="number">2</span>]];</span><br><span class="line">            <span class="type">double</span> v = -<span class="built_in">Volume6</span>(p1, p2, p3, C);</span><br><span class="line">            totv += v;</span><br><span class="line">            tot = tot + <span class="built_in">Centroid</span>(p1, p2, p3, C) * v;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> tot / totv;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//凸包重心到表面最近距离</span></span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">mindist</span><span class="params">(Point3 C)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">double</span> ans = <span class="number">1e30</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; faces.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            Point3 p1 = P[faces[i].v[<span class="number">0</span>]], p2 = P[faces[i].v[<span class="number">1</span>]], p3 = P[faces[i].v[<span class="number">2</span>]];</span><br><span class="line">            ans = <span class="built_in">min</span>(ans, <span class="built_in">fabs</span>(-<span class="built_in">Volume6</span>(p1, p2, p3, C) / <span class="built_in">Area2</span>(p1, p2, p3)));</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="凸包的定义-Face"><a href="#凸包的定义-Face" class="headerlink" title="凸包的定义 Face"></a>凸包的定义 Face</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Face</span> &#123;</span><br><span class="line">    <span class="type">int</span> v[<span class="number">3</span>];</span><br><span class="line">    <span class="built_in">Face</span>(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c)</span><br><span class="line">    &#123;</span><br><span class="line">        v[<span class="number">0</span>] = a;</span><br><span class="line">        v[<span class="number">1</span>] = b;</span><br><span class="line">        v[<span class="number">2</span>] = c;</span><br><span class="line">    &#125;<span class="comment">//逆时针旋转</span></span><br><span class="line">    <span class="function">Vector3 <span class="title">Normal</span><span class="params">(<span class="type">const</span> vector&lt;Point3&gt;&amp; P)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Cross</span>(P[v[<span class="number">1</span>]] - P[v[<span class="number">0</span>]], P[v[<span class="number">2</span>]] - P[v[<span class="number">0</span>]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// f是否能看见P[i]</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">CanSee</span><span class="params">(<span class="type">const</span> vector&lt;Point3&gt;&amp; P, <span class="type">int</span> i)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Dot</span>(P[i] - P[v[<span class="number">0</span>]], <span class="built_in">Normal</span>(P)) &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="加干扰防止多点共面-add-noise"><a href="#加干扰防止多点共面-add-noise" class="headerlink" title="加干扰防止多点共面 add_noise"></a>加干扰防止多点共面 add_noise</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">double</span> <span class="title">rand01</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">rand</span>() / (<span class="type">double</span>)RAND_MAX;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">randeps</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">rand01</span>() - <span class="number">0.5</span>) * EPS;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Point3 <span class="title">add_noise</span><span class="params">(<span class="type">const</span> Point3&amp; p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Point3</span>(p.x + <span class="built_in">randeps</span>(), p.y + <span class="built_in">randeps</span>(), p.z + <span class="built_in">randeps</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="增量法求三维凸包-CH3D"><a href="#增量法求三维凸包-CH3D" class="headerlink" title="增量法求三维凸包 CH3D"></a>增量法求三维凸包 CH3D</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注意：没有考虑各种特殊情况（如四点共面）。实践中，请在调用前对输入点进行微小扰动</span></span><br><span class="line"><span class="comment">//vector&lt;Face&gt;CH3D(Point_3D* p, int n)//所有面的点集和点数</span></span><br><span class="line"><span class="function">vector&lt;Face&gt; <span class="title">CH3D</span><span class="params">(<span class="type">const</span> vector&lt;Point3&gt;&amp; P)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n = P.<span class="built_in">size</span>();</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt; &gt; <span class="built_in">vis</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        vis[i].<span class="built_in">resize</span>(n);</span><br><span class="line">    &#125;</span><br><span class="line">    vector&lt;Face&gt; cur;</span><br><span class="line">    cur.<span class="built_in">push_back</span>(<span class="built_in">Face</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>)); <span class="comment">// 由于已经进行扰动，前三个点不共线</span></span><br><span class="line">    cur.<span class="built_in">push_back</span>(<span class="built_in">Face</span>(<span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>));</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">3</span>; i &lt; n; i++) &#123;</span><br><span class="line">        vector&lt;Face&gt; next;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; cur.<span class="built_in">size</span>(); j++) &#123;</span><br><span class="line">            Face&amp; f = cur[j];</span><br><span class="line">            <span class="type">int</span> res = f.<span class="built_in">CanSee</span>(P, i);</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span> (!res) &#123;</span><br><span class="line">                next.<span class="built_in">push_back</span>(f);</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; <span class="number">3</span>; k++) &#123;</span><br><span class="line">                vis[f.v[k]][f.v[(k + <span class="number">1</span>) % <span class="number">3</span>]] = res;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; cur.<span class="built_in">size</span>(); j++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; <span class="number">3</span>; k++) &#123;</span><br><span class="line">                <span class="type">int</span> a = cur[j].v[k], b = cur[j].v[(k + <span class="number">1</span>) % <span class="number">3</span>];</span><br><span class="line"> </span><br><span class="line">                <span class="keyword">if</span> (vis[a][b] != vis[b][a] &amp;&amp; vis[a][b]) <span class="comment">// (a,b)是分界线，左边对P[i]可见</span></span><br><span class="line">                &#123;</span><br><span class="line">                    next.<span class="built_in">push_back</span>(<span class="built_in">Face</span>(a, b, i));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">        cur = next;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> cur;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="三维凸包模板合集"><a href="#三维凸包模板合集" class="headerlink" title="三维凸包模板合集"></a>三维凸包模板合集</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">550</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> eps=<span class="number">1e-8</span>; </span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">double</span> x,y,z;</span><br><span class="line">    <span class="built_in">Point</span>()&#123;&#125;</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">Point</span>(<span class="type">double</span> xx,<span class="type">double</span> yy,<span class="type">double</span> zz):<span class="built_in">x</span>(xx),<span class="built_in">y</span>(yy),<span class="built_in">z</span>(zz)&#123;&#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//两向量之差</span></span><br><span class="line">    Point <span class="keyword">operator</span> -(<span class="type">const</span> Point p1)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Point</span>(x-p<span class="number">1.</span>x,y-p<span class="number">1.</span>y,z-p<span class="number">1.</span>z);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//两向量之和</span></span><br><span class="line">    Point <span class="keyword">operator</span> +(<span class="type">const</span> Point p1)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Point</span>(x+p<span class="number">1.</span>x,y+p<span class="number">1.</span>y,z+p<span class="number">1.</span>z);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//叉乘</span></span><br><span class="line">    Point <span class="keyword">operator</span> *(<span class="type">const</span> Point p)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Point</span>(y*p.z-z*p.y,z*p.x-x*p.z,x*p.y-y*p.x);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    Point <span class="keyword">operator</span> *(<span class="type">double</span> d)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Point</span>(x*d,y*d,z*d);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    Point <span class="keyword">operator</span> / (<span class="type">double</span> d)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Point</span>(x/d,y/d,z/d);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//点乘</span></span><br><span class="line">    <span class="type">double</span>  <span class="keyword">operator</span> ^(Point p)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> (x*p.x+y*p.y+z*p.z);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CH3D</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">face</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//表示凸包一个面上的三个点的编号</span></span><br><span class="line">        <span class="type">int</span> a,b,c;</span><br><span class="line">        <span class="comment">//表示该面是否属于最终凸包上的面</span></span><br><span class="line">        <span class="type">bool</span> ok;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//初始顶点数</span></span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="comment">//初始顶点</span></span><br><span class="line">    Point P[MAXN];</span><br><span class="line">    <span class="comment">//凸包表面的三角形数</span></span><br><span class="line">    <span class="type">int</span> num;</span><br><span class="line">    <span class="comment">//凸包表面的三角形</span></span><br><span class="line">    face F[<span class="number">8</span>*MAXN];</span><br><span class="line">    <span class="comment">//凸包表面的三角形</span></span><br><span class="line">    <span class="type">int</span> g[MAXN][MAXN];</span><br><span class="line">    <span class="comment">//向量长度</span></span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">vlen</span><span class="params">(Point a)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sqrt</span>(a.x*a.x+a.y*a.y+a.z*a.z);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//叉乘</span></span><br><span class="line">    <span class="function">Point <span class="title">cross</span><span class="params">(<span class="type">const</span> Point &amp;a,<span class="type">const</span> Point &amp;b,<span class="type">const</span> Point &amp;c)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Point</span>((b.y-a.y)*(c.z-a.z)-(b.z-a.z)*(c.y-a.y),</span><br><span class="line">                     (b.z-a.z)*(c.x-a.x)-(b.x-a.x)*(c.z-a.z),</span><br><span class="line">                     (b.x-a.x)*(c.y-a.y)-(b.y-a.y)*(c.x-a.x)</span><br><span class="line">                     );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//三角形面积*2</span></span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">area</span><span class="params">(Point a,Point b,Point c)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">vlen</span>((b-a)*(c-a));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//四面体有向体积*6</span></span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">volume</span><span class="params">(Point a,Point b,Point c,Point d)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (b-a)*(c-a)^(d-a);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//正：点在面同向</span></span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">dblcmp</span><span class="params">(Point &amp;p,face &amp;f)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Point m=P[f.b]-P[f.a];</span><br><span class="line">        Point n=P[f.c]-P[f.a];</span><br><span class="line">        Point t=p-P[f.a];</span><br><span class="line">        <span class="keyword">return</span> (m*n)^t;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">deal</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> a,<span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> f=g[a][b];<span class="comment">//搜索与该边相邻的另一个平面</span></span><br><span class="line">        face add;</span><br><span class="line">        <span class="keyword">if</span>(F[f].ok)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">dblcmp</span>(P[p],F[f])&gt;eps)</span><br><span class="line">              <span class="built_in">dfs</span>(p,f);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                add.a=b;</span><br><span class="line">                add.b=a;</span><br><span class="line">                add.c=p;<span class="comment">//这里注意顺序，要成右手系</span></span><br><span class="line">                add.ok=<span class="literal">true</span>;</span><br><span class="line">                g[p][b]=g[a][p]=g[b][a]=num;</span><br><span class="line">                F[num++]=add;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> now)</span><span class="comment">//递归搜索所有应该从凸包内删除的面</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">         F[now].ok=<span class="number">0</span>;</span><br><span class="line">         <span class="built_in">deal</span>(p,F[now].b,F[now].a);</span><br><span class="line">         <span class="built_in">deal</span>(p,F[now].c,F[now].b);</span><br><span class="line">         <span class="built_in">deal</span>(p,F[now].a,F[now].c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">same</span><span class="params">(<span class="type">int</span> s,<span class="type">int</span> t)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Point &amp;a=P[F[s].a];</span><br><span class="line">        Point &amp;b=P[F[s].b];</span><br><span class="line">        Point &amp;c=P[F[s].c];</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">fabs</span>(<span class="built_in">volume</span>(a,b,c,P[F[t].a]))&lt;eps &amp;&amp;</span><br><span class="line">               <span class="built_in">fabs</span>(<span class="built_in">volume</span>(a,b,c,P[F[t].b]))&lt;eps &amp;&amp;</span><br><span class="line">               <span class="built_in">fabs</span>(<span class="built_in">volume</span>(a,b,c,P[F[t].c]))&lt;eps;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//构建三维凸包</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">create</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> i,j,tmp;</span><br><span class="line">        face add;</span><br><span class="line"> </span><br><span class="line">        num=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(n&lt;<span class="number">4</span>)<span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">//**********************************************</span></span><br><span class="line">        <span class="comment">//此段是为了保证前四个点不共面</span></span><br><span class="line">        <span class="type">bool</span> flag=<span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">1</span>;i&lt;n;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">vlen</span>(P[<span class="number">0</span>]-P[i])&gt;eps)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">swap</span>(P[<span class="number">1</span>],P[i]);</span><br><span class="line">                flag=<span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(flag)<span class="keyword">return</span>;</span><br><span class="line">        flag=<span class="literal">true</span>;</span><br><span class="line">        <span class="comment">//使前三个点不共线</span></span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">2</span>;i&lt;n;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">vlen</span>((P[<span class="number">0</span>]-P[<span class="number">1</span>])*(P[<span class="number">1</span>]-P[i]))&gt;eps)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">swap</span>(P[<span class="number">2</span>],P[i]);</span><br><span class="line">                flag=<span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(flag)<span class="keyword">return</span>;</span><br><span class="line">        flag=<span class="literal">true</span>;</span><br><span class="line">        <span class="comment">//使前四个点不共面</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">3</span>;i&lt;n;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">fabs</span>((P[<span class="number">0</span>]-P[<span class="number">1</span>])*(P[<span class="number">1</span>]-P[<span class="number">2</span>])^(P[<span class="number">0</span>]-P[i]))&gt;eps)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">swap</span>(P[<span class="number">3</span>],P[i]);</span><br><span class="line">                flag=<span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(flag)<span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">//*****************************************</span></span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            add.a=(i<span class="number">+1</span>)%<span class="number">4</span>;</span><br><span class="line">            add.b=(i<span class="number">+2</span>)%<span class="number">4</span>;</span><br><span class="line">            add.c=(i<span class="number">+3</span>)%<span class="number">4</span>;</span><br><span class="line">            add.ok=<span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">dblcmp</span>(P[i],add)&gt;<span class="number">0</span>)<span class="built_in">swap</span>(add.b,add.c);</span><br><span class="line">            g[add.a][add.b]=g[add.b][add.c]=g[add.c][add.a]=num;</span><br><span class="line">            F[num++]=add;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">4</span>;i&lt;n;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;num;j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(F[j].ok&amp;&amp;<span class="built_in">dblcmp</span>(P[i],F[j])&gt;eps)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">dfs</span>(i,j);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        tmp=num;</span><br><span class="line">        <span class="keyword">for</span>(i=num=<span class="number">0</span>;i&lt;tmp;i++)</span><br><span class="line">          <span class="keyword">if</span>(F[i].ok)</span><br><span class="line">            F[num++]=F[i];</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//表面积</span></span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">area</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">double</span> res=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(n==<span class="number">3</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Point p=<span class="built_in">cross</span>(P[<span class="number">0</span>],P[<span class="number">1</span>],P[<span class="number">2</span>]);</span><br><span class="line">            res=<span class="built_in">vlen</span>(p)/<span class="number">2.0</span>;</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;num;i++)</span><br><span class="line">          res+=<span class="built_in">area</span>(P[F[i].a],P[F[i].b],P[F[i].c]);</span><br><span class="line">        <span class="keyword">return</span> res/<span class="number">2.0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">volume</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">double</span> res=<span class="number">0</span>;</span><br><span class="line">        <span class="function">Point <span class="title">tmp</span><span class="params">(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;num;i++)</span><br><span class="line">           res+=<span class="built_in">volume</span>(tmp,P[F[i].a],P[F[i].b],P[F[i].c]);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">fabs</span>(res/<span class="number">6.0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//表面三角形个数</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">triangle</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> num;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//表面多边形个数</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">polygon</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> i,j,res,flag;</span><br><span class="line">        <span class="keyword">for</span>(i=res=<span class="number">0</span>;i&lt;num;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            flag=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;i;j++)</span><br><span class="line">              <span class="keyword">if</span>(<span class="built_in">same</span>(i,j))</span><br><span class="line">              &#123;</span><br><span class="line">                  flag=<span class="number">0</span>;</span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">              &#125;</span><br><span class="line">            res+=flag;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//三维凸包重心</span></span><br><span class="line">    <span class="function">Point <span class="title">barycenter</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="function">Point <span class="title">ans</span><span class="params">(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)</span>,<span class="title">o</span><span class="params">(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)</span></span>;</span><br><span class="line">        <span class="type">double</span> all=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;num;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">double</span> vol=<span class="built_in">volume</span>(o,P[F[i].a],P[F[i].b],P[F[i].c]);</span><br><span class="line">            ans=ans+(o+P[F[i].a]+P[F[i].b]+P[F[i].c])/<span class="number">4.0</span>*vol;</span><br><span class="line">            all+=vol;</span><br><span class="line">        &#125;</span><br><span class="line">        ans=ans/all;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//点到面的距离</span></span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">ptoface</span><span class="params">(Point p,<span class="type">int</span> i)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">fabs</span>(<span class="built_in">volume</span>(P[F[i].a],P[F[i].b],P[F[i].c],p)/<span class="built_in">vlen</span>((P[F[i].b]-P[F[i].a])*(P[F[i].c]-P[F[i].a])));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">CH3D hull;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;hull.n)==<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;hull.n;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%lf%lf%lf&quot;</span>,&amp;hull.P[i].x,&amp;hull.P[i].y,&amp;hull.P[i].z);</span><br><span class="line">        &#125;</span><br><span class="line">        hull.<span class="built_in">create</span>();</span><br><span class="line">        Point p=hull.<span class="built_in">barycenter</span>();<span class="comment">//求重心</span></span><br><span class="line">        <span class="type">double</span> ans1=<span class="number">1e20</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;hull.num;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            ans1=<span class="built_in">min</span>(ans1,hull.<span class="built_in">ptoface</span>(p,i));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%.3f\n&quot;</span>,ans1);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h1><h2 id="对拍"><a href="#对拍" class="headerlink" title="对拍"></a>对拍</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">srand</span>(<span class="built_in">time</span>(<span class="number">0</span>));</span><br><span class="line">    <span class="function">ofstream <span class="title">fout</span><span class="params">(<span class="string">&quot;input.txt&quot;</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    fout.<span class="built_in">close</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;; i++) &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;test: &quot;</span> &lt;&lt; i &lt;&lt; endl;</span><br><span class="line">        <span class="built_in">init</span>();</span><br><span class="line">        <span class="built_in">system</span>(<span class="string">&quot;t.exe &lt;input.txt&gt; tout.txt&quot;</span>);</span><br><span class="line">        <span class="built_in">system</span>(<span class="string">&quot;p.exe &lt;input.txt&gt; pout.txt&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">system</span>(<span class="string">&quot;fc tout.txt pout.txt&quot;</span>)) &#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;WA!!&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="输出运行时间"><a href="#输出运行时间" class="headerlink" title="输出运行时间"></a>输出运行时间</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">clock_t</span> start_time, end_time;</span><br><span class="line">start_time = <span class="built_in">clock</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//coder</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">end_time = <span class="built_in">clock</span>();</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Total time: &quot;</span> &lt;&lt; (<span class="type">double</span>) (end_time - start_time) / CLOCKS_PER_SEC &lt;&lt; <span class="string">&quot;s&quot;</span> &lt;&lt; endl;</span><br></pre></td></tr></table></figure>

<h2 id="输入输出到文件"><a href="#输入输出到文件" class="headerlink" title="输入输出到文件"></a>输入输出到文件</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">freopen</span>(<span class="string">&quot;in.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin);</span><br><span class="line"><span class="built_in">freopen</span>(<span class="string">&quot;out.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout);</span><br></pre></td></tr></table></figure>

<h3 id="cmake配置"><a href="#cmake配置" class="headerlink" title="cmake配置"></a>cmake配置</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cmake_minimum_required</span>(VERSION <span class="number">3.29</span>)</span><br><span class="line"><span class="built_in">project</span>(geometry)</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span>(CMAKE_CXX_STANDARD <span class="number">17</span>)</span><br><span class="line"></span><br><span class="line"># 有什么文件就在后面加什么，这里还有tt.<span class="function">cpp</span></span><br><span class="line"><span class="function"><span class="title">add_executable</span><span class="params">(geometry main.cpp tt.cpp)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">target_compile_definitions</span><span class="params">(geometry PRIVATE -Dstavage)</span></span></span><br></pre></td></tr></table></figure>


    </div>
</article>


                </div>
                <aside class="col-md-4 gal-left" id="sidebar">
    <!-- 此为sidebar的搜索框, 非搜索结果页面 -->
<aside id="sidebar-search">
    <div class="search hidden-xs" data-aos="fade-up" data-aos-duration="2000">
        <form class="form-inline clearfix" id="search-form" method="get"
              action="/search/index.html">
            <input type="text" name="s" class="form-control" id="searchInput" placeholder="搜索文章~" autocomplete="off">
            <button class="btn btn-danger btn-gal" type="submit">
                <i class="fa fa-search"></i>
            </button>
        </form>
    </div>
</aside>
    <aside id="sidebar-author">
    <div class="panel panel-gal" data-aos="flip-right" data-aos-duration="3000">
        <div class="panel-heading" style="text-align: center">
            <i class="fa fa-quote-left"></i>
            Stavage
            <i class="fa fa-quote-right"></i>
        </div>
        <div class="author-panel text-center">
            <img src="/imgs/avatar.jpg" width="140" height="140"
                 alt="个人头像" class="author-image">
            <p class="author-description"><p>My personal blog</p>
</p>
        </div>
    </div>
</aside>
    
    <!-- 要配置好leancloud才能开启此小工具 -->
    
    
    <aside id="sidebar-recent_posts">
    <div class="panel panel-gal recent hidden-xs" data-aos="fade-up" data-aos-duration="2000">
        <div class="panel-heading">
            <i class="fa fa-refresh"></i>
            近期文章
            <i class="fa fa-times-circle panel-remove"></i>
            <i class="fa fa-chevron-circle-up panel-toggle"></i>
        </div>
        <ul class="list-group list-group-flush">
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2025/04/15/%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95/">软件测试</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2025/03/30/%E9%9D%A2%E8%AF%95/">面试</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2025/03/09/%E5%B8%B8%E7%94%A8%E7%BB%84%E4%BB%B6/">常用组件</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2025/02/25/redis%E5%90%AF%E5%8A%A8/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/08/%E8%BD%AF%E4%BB%B6%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/">软件体系结构</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/04/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/">计算机组成原理</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/01/%E7%B3%BB%E7%BB%9F%E5%88%86%E6%9E%90%E4%B8%8E%E8%AE%BE%E8%AE%A1/">系统分析与设计</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/11/26/Web%E5%89%8D%E7%AB%AF/">Web前端</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/11/25/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/11/14/Atcoder/">Atcoder</a>
                </span>
            </li>
            
        </ul>
    </div>
</aside>
    
    
    <aside id="sidebar-rand_posts">
    <div class="panel panel-gal recent hidden-xs" data-aos="fade-up" data-aos-duration="2000">
        <div class="panel-heading">
            <i class="fa fa-refresh"></i>
            随机文章
            <i class="fa fa-times-circle panel-remove"></i>
            <i class="fa fa-chevron-circle-up panel-toggle"></i>
        </div>
        <ul class="list-group list-group-flush">
            
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/11/14/Atcoder/">Atcoder</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/11/25/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/11/26/Web%E5%89%8D%E7%AB%AF/">Web前端</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/01/%E7%B3%BB%E7%BB%9F%E5%88%86%E6%9E%90%E4%B8%8E%E8%AE%BE%E8%AE%A1/">系统分析与设计</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/04/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/">计算机组成原理</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/08/%E8%BD%AF%E4%BB%B6%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/">软件体系结构</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2025/03/09/%E5%B8%B8%E7%94%A8%E7%BB%84%E4%BB%B6/">常用组件</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2025/02/25/redis%E5%90%AF%E5%8A%A8/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2025/03/30/%E9%9D%A2%E8%AF%95/">面试</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2025/04/15/%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95/">软件测试</a>
                </span>
            </li>
            
        </ul>
    </div>
</aside>
    
    
    <aside id="gal-sets">
        <div class="panel panel-gal hidden-xs" data-aos="fade-up" data-aos-duration="2000">
            <ul class="nav nav-pills pills-gal">

                
                <li>
                    <a href="/2024/11/08/%E7%AE%97%E6%B3%95/index.html#sidebar-tags" data-toggle="tab" id="tags-tab">热门标签</a>
                </li>
                
                
                <li>
                    <a href="/2024/11/08/%E7%AE%97%E6%B3%95/index.html#sidebar-friend-links" data-toggle="tab" id="friend-links-tab">友情链接</a>
                </li>
                
                
                <li>
                    <a href="/2024/11/08/%E7%AE%97%E6%B3%95/index.html#sidebar-links" data-toggle="tab" id="links-tab">个人链接</a>
                </li>
                
            </ul>
            <div class="tab-content">
                
                <div class="cloud-tags tab-pane nav bs-sidenav fade" id="sidebar-tags">
    
    <a href="/tags/Tset/" style="font-size: 19.197510926156994px;" class="tag-cloud-link">Tset</a>
    
    <a href="/tags/%E6%A8%A1%E6%9D%BF/" style="font-size: 18.626392516393913px;" class="tag-cloud-link">模板</a>
    
    <a href="/tags/%E4%BB%8B%E7%BB%8D/" style="font-size: 19.434998033362767px;" class="tag-cloud-link">介绍</a>
    
    <a href="/tags/%E7%AC%94%E8%AE%B0/" style="font-size: 11.546411545428299px;" class="tag-cloud-link">笔记</a>
    
    <a href="/tags/%E5%90%8E%E7%AB%AF%E5%B8%B8%E7%94%A8/" style="font-size: 18.60547497553066px;" class="tag-cloud-link">后端常用</a>
    
    <a href="/tags/%E9%A1%B9%E7%9B%AE/" style="font-size: 9.646591008369896px;" class="tag-cloud-link">项目</a>
    
</div>
                
                
                <div class="friend-links tab-pane nav bs-sidenav fade" id="sidebar-friend-links">
    
    <li>
        <a href="http://www.gal123.com/" target="_blank">绅士导航♂</a>
    </li>
    
</div>
                
                
                <div class="links tab-pane nav bs-sidenav fade" id="sidebar-links">
    
    <li>
        <a href="https://github.com/StavageKnight/" target="_blank">Github</a>
    </li>
    
    <li>
        <a href="https://blog.csdn.net/m0_73635984?type=blog" target="_blank">CSDN</a>
    </li>
    
</div>
                
            </div>
        </div>
    </aside>
    
</aside>
            </div>
        </div>
    </div>
    <footer id="gal-footer">
    <div class="container">
        Copyright © 2018 Stavage Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>.&nbsp;Theme by <a href="https://github.com/ZEROKISEKI" target="_blank">AONOSORA</a>
    </div>
</footer>

<!-- 回到顶端 -->
<div id="gal-gotop">
    <i class="fa fa-angle-up"></i>
</div>
</body>

<script src="/js/activate-power-mode.js"></script>

<script>

    // 配置highslide
	hs.graphicsDir = '/js/highslide/graphics/'
    hs.outlineType = "rounded-white";
    hs.dimmingOpacity = 0.8;
    hs.outlineWhileAnimating = true;
    hs.showCredits = false;
    hs.captionEval = "this.thumb.alt";
    hs.numberPosition = "caption";
    hs.align = "center";
    hs.transitions = ["expand", "crossfade"];
    hs.lang.number = '共%2张图, 当前是第%1张';
    hs.addSlideshow({
      interval: 5000,
      repeat: true,
      useControls: true,
      fixedControls: "fit",
      overlayOptions: {
        opacity: 0.75,
        position: "bottom center",
        hideOnMouseOut: true
      }
    })

    // 初始化aos
    AOS.init({
      duration: 1000,
      delay: 0,
      easing: 'ease-out-back'
    });

</script>
<script>
	POWERMODE.colorful = 'true';    // make power mode colorful
	POWERMODE.shake = 'true';       // turn off shake
	// TODO 这里根据具体情况修改
	document.body.addEventListener('input', POWERMODE);
</script>
<script>
    window.slideConfig = {
      prefix: '/imgs/slide/background',
      ext: 'jpg',
      maxCount: '6'
    }
</script>

<script src="/js/hs.js"></script>
<script src="/js/blog.js"></script>



<script src="/js/oni.js"></script>




</html>